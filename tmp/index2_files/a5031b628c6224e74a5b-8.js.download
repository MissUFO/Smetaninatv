webpackJsonp([8],{147:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(2619);o.n(i);Jane.module("todo.js",function(){o(2620),o(2621),o(2622),o(2623),o(2625),o(2626),o(2651)})},2619:function(t,e){},2620:function(t,e){Daria.Todo={},Daria.Todo.init=function(){var t=["todo-lists","todo-web-settings","todo-items","todo-timestamp","todo-fsm"];return ns.forcedRequest(t,{"list-external-id":"today"}).then(function(){var t={execFlag:ns.U.EXEC.PARALLEL},e=ns.View.create("todo-wrap");e.updateByLayout("todo-wrap",{},t).then(function(){$(".js-mail-App").append(e.$node),$(".js-page").addClass("mail-Page_with_Todo");var o=Daria.Todo.getParamsForInit();o.renderTodo=!0,e.updateByLayout("todo-wrap",o,t)})},function(){Jane.ErrorLog.send({errorType:"todo_init.handlers"})})},Daria.Todo.getParamsForInit=function(){var t={},e=ns.Model.get("todo-web-settings").getStateInfo();if(e&&e.state){var o=ns.Model.get("todo-fsm");if("todo-lists"===e.state)return o.setState("todo-lists"),_.extend(t,{"list-external-id":""});"todo-item"===e.state&&(e.state="todo-item-edit"),"todo-items"!==e.state&&(e.state="todo-items");var i=e["list-external-id"],n=["week","today","completed"],s=ns.Model.get("todo-lists");if("todo-items"===e.state&&i&&(_.contains(n,i)||s.hasList(i)))return _.extend(t,{"list-external-id":i})}return _.extend(t,{"list-external-id":ns.Model.get("todo-lists").getDefaultListId()})},Daria.Todo.createHandlerWrapper=function(t,e){return ns.forcedRequest([{id:t,params:e},{id:"todo-items",params:{"list-external-id":"today"}}])},Daria.Todo.getExternalId=function(){for(var t="",e=0;e<5;e++)t+=Math.floor(256*Math.random()).toString(16);return t+"yandex.ru"}},2621:function(t,e){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t,i){function s(t){var i=d[u];return u++,e(t,(void 0===i?"undefined":o(i))!=$.UNDEF?i:n)}var d=i,a=arguments,l=a.length;if(l>2){d=[];for(var r=1;r<l;r++)d.push(a[r])}else"object"!=(void 0===i?"undefined":o(i))&&(d=[i]);var u=0;return t.replace(/%(s|\d*d)/g,s).replace(/%%/g,"%")}function e(t,e){e=e.toString();var o=/^%(0?)(\d+)d$/.exec(t);if(o){return i(o[1]||s,parseInt(o[2],10)-e.length)+e}return e}function i(t,e){return e<1?"":new Array(e+1).join(t)}var n="",s=" ",d=/\%e[^\%]*\%B/,a={};$.each(["Y","y","m","n","B","b","d","e","H","M","S"],function(t,e){a[e]=new RegExp("%"+e,"g")});var l=i18n("%@months_short_capital"),r=i18n("%@months_genitive"),u=i18n("%@months_nominative");Daria.Todo.Date={},Daria.Todo.Date.format=function(e,o){for(var i,n=d.test(o)?r:u,s=[[a.Y,"%04d",e.getFullYear()],[a.y,"%02d",e.getFullYear()%100],[a.m,"%02d",e.getMonth()+1],[a.n,"%d",e.getMonth()+1],[a.d,"%02d",e.getDate()],[a.e,"%d",e.getDate()],[a.H,"%02d",e.getHours()],[a.M,"%02d",e.getMinutes()],[a.S,"%02d",e.getSeconds()],[a.B,"%s",n[e.getMonth()]],[a.b,"%s",l[e.getMonth()]]],m=s.length,c=0;c<m;c++)i=s[c],o=o.replace(i[0],t(i[1],[i[2]]));return s=null,o},Daria.Todo.Date.daysBetween=function(t,e){return t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),((e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))-t)/864e5},Daria.Todo.Date.truncate=function(t,e){e=Math.min(void 0===e?"3":e,7);for(var o=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],i=[],n=0;n<o.length;n++){var s="get"+o[n],d=n<e?t[s]():0;i.push(d)}return new Date(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])},Daria.Todo.Date.parse=function(t){var e=t.split("-");return new Date(e[0],e[1]-1,e[2])},Daria.Todo.Date.parseDateTime=function(t){var e=(t||"").match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):\d{2}$/);if(e)return new Date(e[1],e[2]-1,e[3],e[4],e[5],0)},Daria.Todo.Date.formatNotificationDateTime=function(t){return Daria.Todo.Date.format(t,"%Y-%m-%dT%H:%M:00")},Daria.Todo.Date.formatDueDate=function(t){return Daria.Todo.Date.format(t,"%Y-%m-%d")}}()},2622:function(t,e){Daria.Todo.Autocompleter={email:function(){return this._emailAutocompleter||(this._emailAutocompleter=Daria.Autocompleter.getEmailAutocompleter(),this._emailAutocompleter.setOptions({hideOnScroll:!0}),this._emailAutocompleter.sections[0].extraParams.climit=3),this._emailAutocompleter}}},2623:function(t,e,o){o(2624)},2624:function(t,e){ns.action.define("todo.change-state",function(t,e){var o=e.block;delete e.block,ns.Model.get("todo-fsm").setState(o,e)})},2625:function(t,e){!function(){var t=function(t){var e=t["list-external-id"];return e&&"today"!==e&&"week"!==e&&"completed"!==e?{"todo-statusline":{}}:null},e={"todo-items-wrap&":{"todo-minimizer":{},"todo-items":{},"todo-statusline-box@":t}},o={todo:{"todo-lists-box@":function(){return ns.Model.get("todo-state").hasPrevListId()?e:{"todo-lists-wrap":{"todo-minimizer":{},"todo-lists&":{}}}},"todo-items-box@":function(o){return ns.Model.get("todo-state").hasPrevListId()?null:"completed"===o["list-external-id"]?{"todo-completed-wrap&":{"todo-minimizer":{},"todo-completed-months":{},"todo-statusline-box@":t}}:e},"todo-item-edit-box@":function(t){return t["todo-external-id"]?{"todo-item-edit":{"todo-minimizer":{}}}:null},"todo-email-box@":function(t){return t["list-external-id"]?{"todo-email":{"todo-minimizer":{}}}:null}}};ns.layout.define("todo-wrap",{"todo-wrap":{"todo-wrap-box@":function(t){return t.renderTodo?o:null}}}),ns.layout.define("todo",o),ns.layout.define("todo-statusline-today",{"todo-statusline-inner-box@":{"todo-statusline-today":{}}}),ns.layout.define("todo-statusline-notify",{"todo-statusline-inner-box@":{"todo-item":{}}}),ns.layout.define("todo-statusline-empty",{"todo-statusline-inner-box@":{}}),ns.layout.define("todo-completed-month-layout",{"todo-completed-month":{"todo-completed-month-items":{}}})}()},2626:function(t,e,o){o(2627),o(2628),o(2629),o(2630),o(2631),o(2632),o(2633),o(2634),o(2635),o(2636),o(2637),o(2638),o(2639),o(2640),o(2641),o(2642),o(2643),o(2644),o(2645),o(2646),o(2647),o(2648),o(2649),o(2650)},2627:function(t,e){ns.Model.define("todo-fsm",{methods:{start:"todo-items",transitions:{"todo-lists":["todo-items","todo-item-edit"],"todo-items":["todo-item-edit","todo-lists","todo-email"],"todo-item-edit":["todo-items","todo-lists"],"todo-email":["todo-items"]}}},ns.ModelFsm)},2628:function(t,e){ns.Model.define("todo-state",{events:{"ns-model-init":"_onInit"},methods:{_onInit:function(){this.setData({"prev-list-id":null})},hasPrevListId:function(){return Boolean(this.getPrevListId())},getPrevListId:function(){return this.get(".prev-list-id")},setPrevListId:function(t){this.set(".prev-list-id",t)}}},ns.ModelStatic)},2629:function(t,e){ns.Model.define("todo-lists-scroller",{events:{"ns-model-init":"clean"},methods:{EVENT_NAME:"daria:vTodoListsScroller:scroll",_getScroller:function(){return $(".js-todo-lists-scroll-area")}}},"scroller-common")},2630:function(t,e){ns.Model.define("todo-items-scroller",{events:{"ns-model-init":"clean"},methods:{EVENT_NAME:"daria:vTodoItemsScroller:scroll",_getScroller:function(){return $(".js-content")}}},"scroller-common")},2631:function(t,e){ns.Model.define("todo-items-completed-scroller",{events:{"ns-model-init":"clean"},methods:{EVENT_NAME:"daria:vTodoItemsCompletedScroller:scroll",_getScroller:function(){return $(".js-content")}}},"scroller-common")},2632:function(t,e){ns.Model.define("todo-web-settings",{methods:{preprocessData:function(t){return t.settings=ns.parseQuery(t.settings),t},isSet:function(t){return t in this.get(".settings")},getSetting:function(t){return this.get(".settings")[t]},getStateInfo:function(){var t=this.getSetting("state");return t?ns.parseQuery(t):null},updateSetting:function(t,e){this.set(".settings."+t,e),this.saveSettings()},saveSettings:function(){ns.forcedRequest(["do-todo-web-settings"],{settings:ns.params2query(this.get(".settings"))})},isClosedStatusline:function(){var t=this.getSetting("hide-notification-till");return!!t&&t>Daria.Todo.Date.truncate(new Date,5).getTime()}}})},2633:function(t,e){ns.Model.define("todo-lists",{split:{items:".",params:{"list-external-id":".external-id"},model_id:"todo-lists-item"},methods:{defaultItems:[{"external-id":"today",title:i18n("%Todo_Сегодня"),"default-item":!0},{"external-id":"week",title:i18n("%Todo_На_этой_неделе"),"default-item":!0},{"external-id":"completed",title:i18n("%Todo_Выполненные_дела"),"default-item":!0}],preprocessData:function(t){return this._totalCount=_.reduce(t,function(t,e){return t+(parseInt(e["todo-items-count"],10)||0)},0),t.concat(this.defaultItems)},hasList:function(t){return _.some(this.models,function(e){return e.get(".external-id")===t})},getTotalCount:function(){return this._totalCount},getDefaultListId:function(){var t=_.find(this.models,function(t){return"true"===t.get(".default")});return t?t.get(".external-id"):""},shiftTotalCount:function(t){return this._totalCount+=t,this._totalCount},getListById:function(t){return _.find(this.models,function(e){return e.get(".id")===t})}}})},2634:function(t,e){ns.Model.define("todo-lists-item",{params:{"list-external-id":null}})},2635:function(t,e){ns.Model.define("todo-items",{split:{items:".",params:{"todo-external-id":".external-id"},model_id:"todo-item"},events:{"ns-model-changed":"onModelChanged"},params:{"list-external-id":null},methods:{getCount:function(){return this.models.length},insert:function(t){this.preprocessTodoItem(t.getData());var e=this.getCount();if(t.get(".due-ts")&&0!==e){var o,i=0,n=t.get(".positionWeight");do{o=this.models[i].get(".positionWeight")}while(n<o&&++i<e);this.super_.insert.call(this,t,i)}else this.super_.insert.call(this,t)},preprocessData:function(t){t.forEach(this.preprocessTodoItem);var e=[],o=[],i=[];return t.forEach(function(t){t["due-date-postponed"]?e.push(t):t["is-today"]?o.push(t):i.push(t)}),[].concat(e,o,i)},preprocessTodoItem:function(t){delete t["is-today"],delete t["is-this-week"];var e=t["due-date"],o=!1;if(e){var i=e.split("-"),n=new Date(i[0],i[1]-1,i[2]);t["due-ts"]||(t["due-ts"]=n.getTime()),t["due-date-short"]=Daria.Todo.Date.format(n,"%e %b").toLowerCase();var s=Daria.Todo.Date.daysBetween(n,new Date);s>0?(t["due-date-postponed"]=!0,o=!0):0===s&&(t["is-today"]=!0)}var d,a=t["notification-date-time"];if(a&&(d=Daria.Todo.Date.parseDateTime(a))){var l=d.getMinutes();0!==l&&30!==l&&(l<15?d.setMinutes(0):d.setMinutes(30)),t["notification-time"]=Daria.Todo.Date.format(d,"%H:%M"),!o&&d<new Date&&(t["due-date-postponed"]=!0)}var r=0;t["due-date-postponed"]&&(r+=1e3),!t["due-date-postponed"]&&t["is-today"]&&(r+=500),t.positionWeight=r},onModelChanged:function(t,e){var o=e.jpath,i=e.model;i&&".isNew"===o&&(this.remove(i),this.insert(i))},getItemsWithNotification:function(){return _.filter(this.models,function(t){return t.get(".notification-date-time")})},getNotificationItemId:function(){for(var t=this.getItemsWithNotification(),e=t.length,o=0;o<e;o++){var i=t[o],n=Daria.Todo.Date.parseDateTime(i.get(".notification-date-time"));if(n){if(n-(new Date).getTime()<24e4)return i.get(".external-id")}}return null},isTodoInList:function(t){return _.some(this.models,function(e){return e.get(".external-id")===t})}}})},2636:function(t,e){ns.Model.define("todo-item",{params:{"todo-external-id":null},methods:{preprocessData:function(t){return t["todo-external-id"]||(t["todo-external-id"]=t["external-id"]),t},hasDueDate:function(){return Boolean(this.get(".due-date"))},toggleCompleteState:function(){var t="true"===this.get(".completed")?"false":"true";return this.set(".completed",t),t},save:function(){var t,e=this.getData(),o=ns.Model.get("todo-lists").getTotalCount();0!==o||e["due-date"]||(t=new Date($.now()+864e5),e["due-date"]=Daria.Todo.Date.formatDueDate(t),t.setHours(12),t.setMinutes(0),e["notification-date-time"]=Daria.Todo.Date.formatNotificationDateTime(t));var i=this.get(".isNew"),n=i?"do-todo-create":"do-todo-update";return Daria.Todo.createHandlerWrapper(n,e).then(function(){i&&this.set(".isNew",!1)},this)},remove:function(){return Daria.Todo.createHandlerWrapper(["do-todo-delete"],{"todo-external-ids":this.params["todo-external-id"]})}}})},2637:function(t,e){ns.Model.define("todo-timestamp",{methods:{TIMEOUT_BEFORE_REQUEST:5*Jane.Date.MINUTE,preprocessData:function(t){return this.updateByTimeout(),t},updateByTimeout:function(){window.clearTimeout(this._updateTimer),this._updateTimer=window.setTimeout(function(){ns.forcedRequest(["todo-timestamp"])},this.TIMEOUT_BEFORE_REQUEST)}}})},2638:function(t,e){ns.Model.define("todo-list-completed",{split:{items:".months",params:{"month-id":".value"},model_id:"todo-list-completed-month"},methods:{preprocessData:function(t){return _.forEach(t.months,function(t){var e=t.value.split("-"),o=new Date(e[0],e[1]-1,1);t.title=Daria.Todo.Date.format(o,"%B %Y"),t["todo-items"]=_.flatten(_.map(t.days,function(t){return t["todo-items"]})),delete t.days}),t}}})},2639:function(t,e){ns.Model.define("todo-list-completed-month",{split:{items:".todo-items",params:{"todo-external-id":".external-id"},model_id:"todo-item"},params:{"month-id":null},methods:{}})},2640:function(t,e){ns.Model.define("todo-time",{events:{"ns-model-init":"_onInit"},methods:{_onInit:function(){for(var t=[""],e=0;e<48;e++){var o=30*e+480,i=Math.floor(o/60)%24;t.push((i<10?"0"+i:i)+":"+(o%60==0?"00":"30"))}this.setData(t)}}},ns.ModelStatic)},2641:function(t,e){ns.Model.define("do-todo-web-settings",{params:{settings:null}})},2642:function(t,e){ns.Model.define("do-todo-create",{params:{"due-date":null,"list-external-id":null,title:null,"notification-date-time":null,"todo-external-id":null}})},2643:function(t,e){ns.Model.define("do-todo-update",{params:{"due-date":null,"list-external-id":null,completed:null,title:null,"notification-date-time":null,"todo-external-id":null}})},2644:function(t,e){ns.Model.define("do-todo-delete",{params:{"todo-external-ids":null}})},2645:function(t,e){ns.Model.define("do-todo-restore",{params:{"list-external-id":null,"todo-external-ids":null}})},2646:function(t,e){ns.Model.define("do-todolist-create",{params:{title:null,"list-external-id":null}})},2647:function(t,e){ns.Model.define("do-todolist-update",{params:{title:null,"list-external-id":null}})},2648:function(t,e){ns.Model.define("do-todolist-delete",{params:{"list-external-id":null}})},2649:function(t,e){ns.Model.define("do-todolist-restore",{params:{"list-external-id":null}})},2650:function(t,e){ns.Model.define("do-todolist-send",{params:{"list-external-id":null,emails:null}})},2651:function(t,e,o){o(2652),o(2653),o(2654),o(2655),o(2656),o(2657),o(2658),o(2659),o(2660),o(2661),o(2662),o(2663),o(2664),o(2665),o(2666),o(2667),o(2668),o(2669)},2652:function(t,e){ns.View.define("todo-wrap",{yateModule:"todo"})},2653:function(t,e){ns.View.define("todo",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-htmldestroy":"onHtmlDestroy","ns-view-show":"onShow","ns-view-hide":"onHide","daria:vTodo:hideTodo@show":"hideWindow","daria:vTodo:showParanja@show":"showParanja","daria:vTodo:hideParanja@show":"hideParanja","daria:vTodo:showSplash@show":"showSplash","daria:vTodo:showStatusline@show":"showStatusline","daria:vTodo:hideStatusline@show":"hideStatusline","daria:vTodo:showLoader@show":"showLoader","daria:vTodo:hideLoader@show":"hideLoader","daria:vApp:changeAppWidth@show":"setPosition","mouseenter .js-todo-splash":"removeSplashTimer","mouseleave .js-todo-splash":"setSplashTimer","click .js-todo-restore":"restoreListOrItem","click .js-todo-placeholder-wrap":"openWindow"},models:{"todo-web-settings":"keepValid","todo-timestamp":{"ns-model-changed":"onTimestampUpdate"},"todo-fsm":{"ns-model-changed":"keepValid","# *":"onChangeState"}},yateModule:"todo",methods:{NODE_CLASSES:["b-window_minimized-lessimportant","b-window_minimized-important","b-window_minimized-notify"],CLASS_MINIMIZED:"b-window_minimized",CLASS_PARANJA:"b-window_paranja",CLASS_SPLASH:"b-window_splash",CLASS_STATUSLINE:"b-window_statusline",todoTimestamp:null,UPDATE_INTERVAL:5,timer:null,classesForStates:{"todo-lists":"b-window_c1","todo-items":"b-window_c2","todo-item-edit":"b-window_c3","todo-email":"b-window_c2 b-window_r-2-slidedown"},classesForSplash:{error:"b-window_splash_error",email:"b-window_splash_email",list:"b-window_splash_list",task:"b-window_splash_task"},onHtmlInit:function(){var t=this.getModel("todo-fsm").getState(),e=this;this.$node.addClass(this.classesForStates[t]),this.todoTimestamp=this.getModel("todo-timestamp").getData(),$(document).on("mousedown.todo",function(t){0===$(t.target).closest(e.$node).length&&e.hideWindow()})},onHtmlDestroy:function(){$(document).off(".todo")},onShow:function(){this.setPosition(),this.updateMinimizeModeInfo()},onHide:function(){this.stopUpdateByTimeout()},onChangeState:function(t,e){var o=this,i={execFlag:ns.U.EXEC.PARALLEL};this.hideStatusline(),this.updateByLayout("todo",e.data,i).then(function(){$(document).trigger("hide-calendar"),Daria.Dialog.close();var t=o.classesForStates[e.from],i=o.classesForStates[e.to],n={state:e.to,"list-external-id":e.data["list-external-id"]};o.$node.toggleClass(t+" "+i),"todo-item-edit"===n.state&&(n.state="todo-item"),o.getModel("todo-web-settings").updateSetting("state",ns.params2query(n)),o.hideLoader()})},hideStatusline:function(){this.$node.removeClass(this.CLASS_STATUSLINE)},showStatusline:function(){this.$node.addClass(this.CLASS_STATUSLINE)},onClick:function(t){$(t.target).is("button, input, a, .daria-action, .b-window__row")||this.hideWindow()},hideLoader:function(){return this.$node.find(".js-todo-loader").addClass("g-hidden"),this},showLoader:function(){return this.$node.find(".js-todo-loader").removeClass("g-hidden"),this},showParanja:function(){this.$node.addClass(this.CLASS_PARANJA)},hideParanja:function(){this.$node.removeClass(this.CLASS_PARANJA)},hideWindow:function(){this.isOpen()&&(this.isOpened=!1,$(document).trigger("hide-calendar"),Daria.Dialog.close(),this.setMinimizedClass(),this.setPlaceholder(),this.updateOpenStateInSettings())},openWindow:function(){return this.isOpened=!0,this.updateOpenStateInSettings(),this.$node.css("width","").removeClass(this.CLASS_MINIMIZED+" "+this.NODE_CLASSES.join(" ")),this},setMinimizedClass:function(){this.$node.removeClass(this.NODE_CLASSES.join(" "));var t=this._notificationType;this.NODE_CLASSES[t]&&this.$node.addClass(this.NODE_CLASSES[t])},calPlaceholderWidth:function(){var t=this.$node.find(".js-todo-placeholder").clone().css({visibility:"hidden"}).appendTo(this.$node),e=t.width();if(t.remove(),t=null,0!==e){var o=Math.min(e+55,300);o=Math.max(o,190),this.$node.css("width",o).addClass(this.CLASS_MINIMIZED)}},setPlaceholder:function(t,e){if(!t){var o=ns.Model.get("todo-lists").getTotalCount();o>0?(e=0,t=i18n("%Todo_minimized",o)):(t=i18n("%Todo_Добавить_дело"),e=Number.POSITIVE_INFINITY)}this._notificationType=e||0,this.$node.find(".js-todo-placeholder").text(t),this.isOpen()||(this.setMinimizedClass(),this.calPlaceholderWidth())},showSplash:function(t,e){var o=[];_.forEach(this.classesForSplash,function(t){o.push(t)}),this.$node.removeClass(o.join(" ")).addClass(this.CLASS_SPLASH).addClass(this.classesForSplash[e.type]),this.setSplashTimer(2e3)},setSplashTimer:function(t){this.removeSplashTimer(),this._hideTimer=window.setTimeout(this.hideSplash.bind(this),t||1e3)},removeSplashTimer:function(){window.clearTimeout(this._hideTimer),this._hideTimer=null},hideSplash:function(){return this.$node.removeClass(this.CLASS_SPLASH),this.removeSplashTimer(),this.getModel("todo-fsm").set(".restore",null),this},updateOpenStateInSettings:function(){this.getModel("todo-web-settings").updateSetting("open",Number(this.isOpen()))},isOpen:function(){if(void 0===this.isOpened){var t=this.getModel("todo-web-settings"),e=t.getSetting("open");this.isOpened=!e||Boolean(parseInt(e,10))}return this.isOpened},restoreListOrItem:function(){var t=this.getModel("todo-fsm").get(".restore");if(t){var e,o={};"task"===t.type?(e=["do-todo-restore","todo-items"],o["todo-external-ids"]=t["todo-external-id"],o["list-external-id"]=t["list-external-id"]):(e=["do-todolist-restore","todo-lists"],o["list-external-id"]=t["list-external-id"]),ns.forcedRequest(e,o).then(function(){},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}),this.hideSplash()}},startUpdateByTimeout:function(){this.stopUpdateByTimeout();var t=Daria.Todo.Date.truncate(new Date,5),e=t.getMinutes(),o=e+this.UPDATE_INTERVAL-e%this.UPDATE_INTERVAL;t.setMinutes(o),this.timer=window.setTimeout(this.updateNotifyInfo.bind(this),t-new Date)},stopUpdateByTimeout:function(){window.clearTimeout(this.timer)},updateNotifyInfo:function(){var t=this,e={"list-external-id":"today"};ns.request(["todo-items"],e).then(function(){t.updateMinimizeModeInfo(),ns.events.trigger("daria:vTodoStatusline:update")})},updateMinimizeModeInfo:function(){this.startUpdateByTimeout();var t=ns.Model.get("todo-items",{"list-external-id":"today"});if(0===t.getCount())return void this.setPlaceholder();var e,o,i=t.getNotificationItemId();i?(e=ns.Model.get("todo-item",{"todo-external-id":i}).get(".title"),o=2):ns.Model.get("todo-web-settings").isClosedStatusline()||(e=i18n("%Todo_reminder_minimized",t.getCount()),o=1),this.setPlaceholder(e,o)},onTimestampUpdate:function(){var t=ns.Model.get("todo-timestamp").getData();this.todoTimestamp!==t&&(ns.events.trigger("daria:vTodoLists:update"),ns.events.trigger("daria:vTodoItems:update"),this.todoTimestamp=t)},setPosition:function(){var t=$(document).find(".js-mail-App"),e=t.find(".js-mail-layout"),o=t.width()-(e.width()+e.offset().left);this.$node.css("right",o)}}})},2654:function(t,e){ns.View.define("todo-wrap-view-mixin",{methods:{DELAY_BEFORE_INPUT_FOCUS:500,CLASS_FOR_FIXED_HEADER:"b-window__header_fixed",toggleFixedHeader:function(t){var e=this.$node.find(".js-todo-header"),o=t.getScrollTop();e.toggleClass(this.CLASS_FOR_FIXED_HEADER,o>0)},onFooterClick:function(t){($(t.target).is("form")||t.target===t.currentTarget)&&ns.events.trigger("daria:vTodo:hideTodo")},onMouseWheel:function(t){var e=t.originalEvent,o=0;e.deltaY&&(o=-e.deltaY),e.wheelDelta&&(o=e.wheelDelta/120),e.detail&&(o=-e.detail/3);var i=t.currentTarget,n=i.scrollHeight,s=i.offsetHeight,d=i.scrollTop;(d===n-s&&o<0||0===d&&o>0)&&t.preventDefault()},focusInput:function(){var t=this.$node.find(".js-todo-create-input");_.delay(function(){t.focus()},this.DELAY_BEFORE_INPUT_FOCUS)}}})},2655:function(t,e){ns.View.define("todo-lists-wrap",{events:{"ns-view-show":"onShow","daria:vTodoListsScroller:scroll@show":"onScroll","daria:layout-changed@show":"onScroll","click .js-todo-lists-footer":"onFooterClick","submit .js-todo-lists-form":"createList","wheel .js-todo-lists-scroll-area":"onMouseWheel"},models:{"todo-lists-scroller":"keepValid","todo-fsm":{"ns-model-changed":"keepValid","# todo-lists":"onTodoListsStateInit"}},yateModule:"todo",methods:{onShow:function(){this.getModel("todo-lists-scroller").init(),"todo-lists"===this.getModel("todo-fsm").getState()&&this.focusInput()},onTodoListsStateInit:function(){this.focusInput()},onScroll:function(){this.toggleFixedHeader(this.getModel("todo-lists-scroller"))},createList:function(t){t.preventDefault();var e=t.currentTarget,o=$(e),i=e.title,n=_.trim(i.value);if(n){o.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var s=Daria.Todo.getExternalId(),d={title:n,"list-external-id":s};ns.forcedRequest(["do-todolist-create","todo-lists","todo-items"],d).then(function(){ns.Model.get("todo-fsm").setState("todo-items",{"list-external-id":s})},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}).then(function(){o.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader"),i.value=""})}}}},"todo-wrap-view-mixin")},2656:function(t,e){ns.ViewCollection.define("todo-lists",{events:{"daria:vTodoLists:update@show":"onUpdate"},models:{"todo-lists":{"ns-model-changed":"update","ns-model-insert":"update","ns-model-remove":"update"}},split:{byModel:"todo-lists",intoViews:"todo-lists-item"},yateModule:"todo",methods:{onUpdate:function(){"todo-lists"===ns.Model.get("todo-fsm").getState()&&(this.getModel("todo-lists").invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL}))}}})},2657:function(t,e){ns.View.define("todo-lists-item",{events:{"click .js-todo-lists-item-edit":"openEdit","click .js-todo-lists-item-close-edit":"closeEdit","click .js-todo-lists-item-delete":"deleteList","click .js-todo-lists-item-go":"goToItems","submit .js-todo-lists-item-form":"saveList"},models:{"todo-lists-item":{"ns-model-changed":"forceUpdate"},"todo-fsm":{"ns-model-changed":"keepValid","# todo-lists":"onTodoListsStateInit"}},params:{"list-external-id":null},yateModule:"todo",methods:{EDIT_MODE_HEIGHT:68,CLASS_FOR_EDIT_MODE:"b-grid-item_task-list-settings",CLASS_FOR_CURRENT:"b-grid-item_task-list-current",CLASS_FOR_RECENT:"b-grid-item_task-list-recent",onTodoListsStateInit:function(t,e){ns.Model.get("todo-state").hasPrevListId()||this.highlight(e.data["list-external-id"])},highlight:function(t){if(t&&this.params["list-external-id"]===t){this.$node.addClass(this.CLASS_FOR_CURRENT);var e=this;window.setTimeout(function(){e.isVisible()&&(e.$node.removeClass(e.CLASS_FOR_CURRENT).addClass(e.CLASS_FOR_RECENT),window.setTimeout(function(){e.$node.removeClass(e.CLASS_FOR_RECENT)},1e3))},500)}},openEdit:function(){this.$node.addClass(this.CLASS_FOR_EDIT_MODE),this.scrollIntoView(),this.$node.find(".js-todo-lists-item-input input")[0].select(),this.$node.on("mousewheel",function(t){t.preventDefault(),t.stopPropagation()}),ns.events.trigger("daria:vTodo:showParanja")},scrollIntoView:function(){var t=ns.Model.get("todo-lists-scroller"),e=t.getScrollTop(),o=t.getHeight(),i=this.$node.position().top,n=null;if(i<0)n=e+i;else{var s=i+this.EDIT_MODE_HEIGHT-o;s>0&&(n=e+s)}null!==n&&t.setScrollTop(n,!0)},closeEdit:function(){this.$node.removeClass(this.CLASS_FOR_EDIT_MODE).off("mousewheel"),this.restoreTitle(),ns.events.trigger("daria:vTodo:hideParanja")},restoreTitle:function(){var t=nb.block(this.$node.find(".js-todo-lists-item-input")[0]),e=this.getModel("todo-lists-item").get(".title");t.setValue(e)},deleteList:function(){var t=this.$node.find(".js-todo-lists-item-form");t.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var e=this.params["list-external-id"],o={"list-external-id":e};ns.Model.get("todo-list-completed").invalidate(),ns.forcedRequest(["do-todolist-delete","todo-lists"],o).then(function(){ns.Model.get("todo-fsm").set(".restore",{"list-external-id":e,type:"list"}),ns.events.trigger("daria:vTodo:hideParanja"),ns.events.trigger("daria:vTodo:showSplash",{type:"list"})},function(){t.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}).then(function(){ns.events.trigger("daria:vTodo:hideLoader")})},saveList:function(t){t.preventDefault();var e=t.currentTarget,o=$(e),i=_.trim(e.title.value);if(i){o.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var n={title:i,"list-external-id":this.params["list-external-id"]},s=this;ns.forcedRequest(["do-todolist-update","todo-lists"],n).then(function(){s.closeEdit()},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}).then(function(){o.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader")})}},goToItems:function(){ns.Model.get("todo-fsm").setState("todo-items",{"list-external-id":this.params["list-external-id"]})}}})},2658:function(t,e){ns.View.define("todo-items-wrap",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","daria:vTodoItemsScroller:scroll@show":"onScroll","daria:layout-changed@show":"onScroll","click .js-todo-items-send":"goToSend","click .js-todo-items-back":"goBack","click .js-todo-items-footer":"onFooterClick","click .js-todo-item-goto-create":"onGotoCreateItem","submit .js-todo-item-form-create":"onCreateTodoItemFormSubmit","wheel .js-content":"onMouseWheel"},models:{"todo-lists":{"ns-model-changed":"invalidate"},"todo-items":{"ns-model-changed":"updateDummy","ns-model-insert":"updateDummy","ns-model-remove":"updateDummy"},"todo-items-scroller":"keepValid","todo-fsm":{"ns-model-changed":"keepValid","# todo-items":"onTodoItemsStateInit"}},params:function(t){return{"list-external-id":t["list-external-id"]||"today"}},yateModule:"todo",methods:{onHtmlInit:function(){this.$newItemTitle=this.$node.find(".js-todo-create-input"),this.$form=this.$node.find(".js-todo-item-form-create")},onShow:function(){this.getModel("todo-items-scroller").init(),"todo-items"===this.getModel("todo-fsm").getState()&&this.focusInput()},onTodoItemsStateInit:function(){this.focusInput()},onScroll:function(){this.toggleFixedHeader(this.getModel("todo-items-scroller"))},createParamsFromForm:function(t){var e=this.params["list-external-id"],o="week"===e||"today"===e,i={"todo-external-id":Daria.Todo.getExternalId(),"list-external-id":e,title:_.trim(t.title.value)};if(o){var n=new Date;"week"===e&&n.setDate(n.getDate()+(7-n.getDay())),i["due-date"]=Daria.Todo.Date.formatDueDate(n),delete i["list-external-id"]}return i},onCreateTodoItemFormSubmit:function(t){t.preventDefault();var e=$(t.currentTarget),o=this.createParamsFromForm(t.currentTarget);if(o.title){e.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var i=this,n=ns.Model.get("todo-item",{"todo-external-id":o["todo-external-id"]});o.isNew=!0,n.setData(o),n.save().then(function(){if(ns.Model.get("todo-lists").shiftTotalCount(1),i.getModel("todo-items").insert(n),"week"===i.params["list-external-id"]||"today"===i.params["list-external-id"]){var t=ns.Model.get("todo-lists").getDefaultListId();t&&ns.Model.get("todo-items",{"list-external-id":t}).isValid()&&ns.Model.get("todo-items",{"list-external-id":t}).insert(n)}e.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader"),i.$newItemTitle.val("").focus()},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}).then(function(){e.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader")})}},onGotoCreateItem:function(){var t=this.createParamsFromForm(this.$form[0]),e=ns.Model.get("todo-item",{"todo-external-id":t["todo-external-id"]});t.isNew=!0,e.setData(t),this.$newItemTitle.val(""),ns.Model.get("todo-fsm").setState("todo-item-edit",{"todo-external-id":t["todo-external-id"],"list-external-id":t["list-external-id"]})},goToSend:function(){ns.Model.get("todo-fsm").setState("todo-email",{"list-external-id":this.params["list-external-id"]})},goBack:function(){var t=this.params["list-external-id"],e="todo-lists",o=ns.Model.get("todo-state");o.hasPrevListId()&&(t=o.getPrevListId(),e="todo-items",o.setPrevListId(null)),this.getModel("todo-fsm").setState(e,{"list-external-id":t})},updateDummy:function(){var t=this.getModel("todo-items").getCount()>0;this.$node.find(".js-todo-items-wrap-dummy").toggleClass("is-hidden",t)}}},"todo-wrap-view-mixin")},2659:function(t,e){ns.ViewCollection.define("todo-items",{events:{"daria:vTodoItems:update@show":"onUpdate"},models:{"todo-items":{"ns-model-insert":"insertItem"},"todo-lists":"invalidate","todo-items-scroller":"keepValid"},split:{byModel:"todo-items",intoViews:function(t){return"true"!==t.get(".completed")&&"todo-item"}},params:function(t){return{"list-external-id":t["list-external-id"]||"today"}},yateModule:"todo",methods:{insertItem:function(t,e){this.update().then(function(){this.scrollToAddedItem(e[0])},this)},scrollToAddedItem:function(t){var e=this.params["list-external-id"];"today"===e||"week"===e?this.scrollToTop():t.hasDueDate()||this.scrollToBottom()},scrollToTop:function(){this.getModel("todo-items-scroller").setScrollTop(0)},scrollToBottom:function(){var t=this.getModel("todo-items-scroller");t.setScrollTop(t.getScrollHeight())},onUpdate:function(){"todo-items"===ns.Model.get("todo-fsm").getState()&&(this.getModel("todo-lists").hasList(this.params["list-external-id"])?(this.getModel("todo-items").invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})):ns.Model.get("todo-fsm").setState("todo-lists",{"list-external-id":this.params["list-external-id"]}))}}})},2660:function(t,e){ns.View.define("todo-item",{events:{"click .js-todo-item-toggle-complete":"toggleCompleteState","click .js-todo-item-goto-edit":"openEditItem"},models:{"todo-item":!0},params:function(t){return{"todo-external-id":t["statusline-todo-external-id"]||t["todo-external-id"],"list-external-id":t["list-external-id"]||"today"}},yateModule:"todo",methods:{CLASS_FOR_TASK_COMPLETED:"b-grid-item_task-completed",toggleCompleteState:function(t){t.preventDefault(),t.stopPropagation();var e=$(t.currentTarget),o=nb.block(t.currentTarget);o.toggle();var i=e.closest(".js-task").toggleClass(this.CLASS_FOR_TASK_COMPLETED),n=this.getModel("todo-item"),s=n.toggleCompleteState(),d=this;ns.events.trigger("daria:vTodo:showLoader"),n.save().then(function(){i.fadeOut(function(){$(this).remove()}),ns.Model.invalidate("todo-list-completed");var t=n.get(".list-external-id"),e=ns.Model.get("todo-lists");if(!t){t=e.getListById(n.get(".list-id")).get(".external-id")}var o=ns.Model.get("todo-items",{"list-external-id":t});"true"===s?(o.isValid()&&o.remove(n),e.shiftTotalCount(-1),ns.events.trigger("daria:vTodoStatusline:update")):(o.isValid()&&o.insert(n),e.shiftTotalCount(1),ns.events.trigger("daria:vTodoCompletedMonth:removeItem",n))},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"}),o.toggle(),i.toggleClass(d.CLASS_FOR_TASK_COMPLETED)}).then(function(){ns.events.trigger("daria:vTodo:hideLoader")})},openEditItem:function(t){t.stopPropagation();var e=this.getModel("todo-item");"true"!==e.get(".completed")&&ns.Model.get("todo-fsm").setState("todo-item-edit",{"todo-external-id":e.get(".todo-external-id"),"list-external-id":this.params["list-external-id"]})}}})},2661:function(t,e){ns.View.define("todo-completed-wrap",{events:{"ns-view-show":"onShow","daria:vTodoItemsCompletedScroller:scroll@show":"onScroll","daria:layout-changed@show":"onScroll","click .js-todo-back":"onBackClick","wheel .js-content":"onMouseWheel"},models:{"todo-list-completed":"forceUpdate","todo-items-completed-scroller":"keepValid"},yateModule:"todo",methods:{onShow:function(){this.getModel("todo-items-completed-scroller").init()},onBackClick:function(){ns.Model.get("todo-fsm").setState("todo-lists",{"list-external-id":"completed"})},onScroll:function(){this.toggleFixedHeader(this.getModel("todo-items-completed-scroller"))}}},"todo-wrap-view-mixin")},2662:function(t,e){ns.ViewCollection.define("todo-completed-months",{models:{"todo-list-completed":!0,"todo-web-settings":"invalidate"},split:{byModel:"todo-list-completed",intoLayouts:function(){return"todo-completed-month-layout"}},params:{},yateModule:"todo",methods:{}})},2663:function(t,e){ns.View.define("todo-completed-month",{events:{"daria:vTodoCompletedMonth:removeItem@show":"handleRemoveItem"},models:{"todo-list-completed-month":{"ns-model-remove":"hideTitle"},"todo-web-settings":"invalidate"},params:{"month-id":null},yateModule:"todo",methods:{handleRemoveItem:function(t,e){this.getModel("todo-list-completed-month").remove(e)},hideTitle:function(){this.getModel("todo-list-completed-month").models.length>0||this.$node.find(".js-group-title").addClass("is-hidden")}}})},2664:function(t,e){ns.ViewCollection.define("todo-completed-month-items",{models:{"todo-list-completed-month":!0,"todo-web-settings":"invalidate"},split:{byModel:"todo-list-completed-month",intoViews:"todo-item"},params:function(t){return t},yateModule:"todo",methods:{}})},2665:function(t,e){ns.View.define("todo-item-edit",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","click .js-todo-item-calendar-icon":"openCalendar","click .js-todo-item-edit-set-date":"onSetDateClick","click .js-todo-item-back":"onBackClick","click .js-todo-item-cancel":"onCancelClick","click .js-todo-item-delete":"onDeleteClick","click .js-date-select":"onDateSelectClick","input .js-date-select ._nb-input-controller":"onInputDate","submit .js-todo-item-form-update":"onUpdateTodoItemFormSubmit"},params:function(t){return{"todo-external-id":t["todo-external-id"],"list-external-id":t["list-external-id"]}},models:{"todo-item":"invalidate","todo-items":"keepValid","todo-time":"keepValid"},yateModule:"todo",methods:{onHtmlInit:function(){nb.init(this.$node),this.$form=this.$node.find(".js-todo-item-form-update"),this.$input=this.$node.find(".js-date-select"),nb.block(this.$input[0]).$control.date_input({zIndex:102,action:"click",hideOnScroll:!0,minDate:new Date,dateToString:function(t){return t.toString()},stringToDate:function(t){return t?Daria.Todo.Date.parse(t):null},keydownHandler:!1,getInputVal:function(){return this.$form[0]["due-date"].value}.bind(this),onSelect:function(t){var e=new Date(t);e&&e.getTime()&&this.setDate(e)}.bind(this)})},onShow:function(){var t=this;this.$form[0].title.select(),$(this.$form[0]["notification-time"]).on("change.todo-item-edit",function(){this.value&&""===this.form["due-date"].value&&t.setDate(new Date(Date.now()))})},onHide:function(){$(this.$form[0]["notification-time"]).off(".todo-item-edit")},onDateSelectClick:function(t){t.preventDefault()},setDate:function(t){var e=this.$form[0];nb.block(this.$input[0]).setValue(t?Daria.Todo.Date.format(t,"%e %b").toLowerCase():""),e["due-date"].value=t?Daria.Todo.Date.formatDueDate(t):"",t||(e["notification-time"].value="")},createParamsFromForm:function(t){var e,o=this.params["list-external-id"],i="week"===o||"today"===o,n={"todo-external-id":this.params["todo-external-id"],"list-external-id":o,title:$.trim(t.title.value),"due-date":t["due-date"]?t["due-date"].value:"","notification-date-time":""};if(t["notification-time"]&&t["notification-time"].value){e=Daria.Todo.Date.parse(n["due-date"]);var s=t["notification-time"].value.split(":");e.setHours(s[0]),e.setMinutes(s[1]),n["notification-date-time"]=Daria.Todo.Date.formatNotificationDateTime(e)}return i&&(n["due-date"]||(e=new Date,"week"===o&&e.setDate(e.getDate()+(7-e.getDay())),n["due-date"]=Daria.Todo.Date.formatDueDate(e)),delete n["list-external-id"]),n},onUpdateTodoItemFormSubmit:function(t){t.preventDefault();var e=this.createParamsFromForm(this.$form[0]);if(e.title){this.$form.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var o=ns.Model.get("todo-item",{"todo-external-id":e["todo-external-id"]}),i=o.get(".isNew"),n=this;e.isNew=i,o.setData(e),o.save().then(function(){ns.forcedRequest("todo-items",{"list-external-id":n.params["list-external-id"]}).then(function(){n.goBack()})},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"})}).then(function(){n.$form.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader")})}},onCancelClick:function(){this.invalidate(),this.update().then(function(){this.goBack()},this)},onDeleteClick:function(){this.$form.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var t=this.getModel("todo-item"),e=this;t.remove().then(function(){ns.Model.get("todo-lists").shiftTotalCount(-1),e._removeItemFromLists(t),ns.Model.get("todo-fsm").set(".restore",{"todo-external-id":e.params["todo-external-id"],"list-external-id":e.params["list-external-id"],type:"task"}),ns.events.trigger("daria:vTodo:showSplash",{type:"task"}),e.goBack()},function(){ns.events.trigger("daria:vTodo:showSplash",{type:"error"}),e.$form.removeClass("is-disabled")}).then(function(){ns.events.trigger("daria:vTodo:hideLoader")})},_removeItemFromLists:function(t){var e=ns.Model.get("todo-lists"),o=t.get(".list-id"),i=e.getListById(o),n=i.get(".external-id");this._removeItemFrom(t,n),n!==this.params["list-external-id"]&&this._removeItemFrom(t,this.params["list-external-id"]),this._removeItemFrom(t,"week"),this._removeItemFrom(t,"today"),this._removeItemFrom(t,"completed")},_removeItemFrom:function(t,e){ns.Model.get("todo-items",{"list-external-id":e}).remove(t)},openCalendar:function(t){t.preventDefault(),t.stopPropagation(),nb.block(this.$input[0]).$control.click()},onSetDateClick:function(t){t.preventDefault();var e=parseInt($(t.currentTarget).data("offset")||0,10),o=new Date($.now()+e);this.setDate(o)},onInputDate:function(t){""===t.target.value&&""!==this.$form[0]["due-date"].value&&this.setDate()},onBackClick:function(){this.invalidate(),this.update().then(function(){this.goBack()},this)},goBack:function(){var t,e;ns.Model.get("todo-state").hasPrevListId()?(t="todo-lists",e={"list-external-id":"today"}):(t="todo-items",e={"todo-external-id":this.params["todo-external-id"],"list-external-id":this.params["list-external-id"]}),ns.Model.get("todo-fsm").setState(t,e)}}})},2666:function(t,e){ns.View.define("todo-email",{events:{"ns-view-hide":"onHide","click .js-todo-email-cancel":"onCancelClick","submit .js-todo-email-form":"onSend","wheel .js-todo-email-input":"onMouseWheel"},models:{"todo-fsm":{"ns-model-changed":"keepValid","# todo-email":"onShow"}},params:{"list-external-id":null},yateModule:"todo",methods:{onShow:function(){var t=this.$node.find(".js-todo-email-form")[0];this.input=t.emails,this.input.value="",this.input.focus(),Daria.Todo.Autocompleter.email().bindField({field:this.input,focus:1}),$(this.input).on("result.todo-email",function(t){t.currentTarget.scrollTop=t.currentTarget.scrollHeight}),this.showError()},onHide:function(){$(this.input).off(".todo-email")},showError:function(t){var e=this.$node.find(".js-todo-email-error").addClass("g-hidden");return!!t&&(e.filter("."+t).removeClass("g-hidden"),!0)},onCancelClick:function(){ns.Model.get("todo-fsm").setState("todo-items",{"list-external-id":this.params["list-external-id"]})},onSend:function(t){t.preventDefault();var e,o=t.currentTarget,i=$(o),n=Jane.FormValidation.splitContacts(o.emails.value),s=n.length,d=[];n.length||(e="js-error-invalid");for(var a=0;a<s;a++){if(!Jane.FormValidation.checkEmail(n[a].email)){e="js-error-invalid";break}d.push(n[a].email)}if(!e&&d.length>10&&(e="js-error-limit"),!this.showError(e)){i.addClass("is-disabled"),ns.events.trigger("daria:vTodo:showLoader");var l={emails:d.join(","),"list-external-id":this.params["list-external-id"]},r=this;ns.forcedRequest(["do-todolist-send"],l).then(function(){ns.events.trigger("daria:vTodo:showSplash",{type:"email"}),ns.Model.get("todo-fsm").setState("todo-items",{"list-external-id":r.params["list-external-id"]})},function(){r.showError("js-error-unknown")}).then(function(){i.removeClass("is-disabled"),ns.events.trigger("daria:vTodo:hideLoader")})}}}},"todo-wrap-view-mixin")},2667:function(t,e){ns.View.define("todo-statusline",{events:{"daria:vTodoStatusline:update@show":"update"},models:{"todo-items":"keepValid","todo-web-settings":{"ns-model-changed":"keepValid","ns-model-changed.settings.hide-notification-till":"onClose"}},params:function(t){return{"list-external-id":t["list-external-id"]}},yateModule:"todo",methods:{patchLayout:function(t){var e=ns.Model.get("todo-items",{"list-external-id":"today"});if(!e.getCount())return ns.events.trigger("daria:vTodo:hideStatusline"),"todo-statusline-empty";var o=e.getNotificationItemId();return o&&!this.getModel("todo-items").isTodoInList(o)?(ns.events.trigger("daria:vTodo:showStatusline"),t["statusline-todo-external-id"]=o,"todo-statusline-notify"):this.getModel("todo-web-settings").isClosedStatusline()||this.allTodayItemsInCurrentList()?(ns.events.trigger("daria:vTodo:hideStatusline"),"todo-statusline-empty"):(ns.events.trigger("daria:vTodo:showStatusline"),"todo-statusline-today")},allTodayItemsInCurrentList:function(){var t=this.getModel("todo-items"),e=ns.Model.get("todo-items",{"list-external-id":"today"});return _.every(e.models,function(e){return _.contains(t.models,e)})},onClose:function(){ns.events.trigger("daria:vTodo:hideStatusline"),this.update()}}})},2668:function(t,e){ns.View.define("todo-statusline-today",{events:{"click .js-todo-statusline-today-link":"goTodayList","click .js-todo-statusline-close":"close"},models:{"todo-items":"forceUpdate"},params:function(t){return{"list-external-id":"today","current-list-id":t["list-external-id"]}},yateModule:"todo",methods:{close:function(){var t=Daria.Todo.Date.truncate(new Date,3);t.setDate(t.getDate()+1),t.setHours(9),ns.Model.get("todo-web-settings").updateSetting("hide-notification-till",t.getTime())},goTodayList:function(t){t.preventDefault(),ns.Model.get("todo-fsm").setState("todo-lists",{"list-external-id":"today"}),ns.Model.get("todo-state").setPrevListId(this.params["current-list-id"])}}})},2669:function(t,e){ns.View.define("todo-minimizer",{events:{click:"onClick"},yateModule:"todo",methods:{onClick:function(){ns.events.trigger("daria:vTodo:hideTodo")}}})}});