webpackJsonp([4],{135:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(2026);s.n(n);Jane.module("message.js",function(){s(2027),s(2028),s(2034),s(2038),s(2066),s(2085),s(2143)})},2026:function(e,t){},2027:function(e,t){!function(){Daria.MessageWidget={},Daria.MessageWidget._widgets={"message-widget-spam":"_checkShowSpam","message-widget-translate":"_checkShowTranslate","message-widget-noreply":"_checkShowNoreply","message-widget-imap-deleted":"_checkShowImapDeleted","message-widget-download-full":"_checkShowDownloadFull"},Daria.MessageWidget.creatingListOfWidgets=function(e){var t=_.clone(e.params),s=ns.Model.get("message-widget-state",t);for(var n in Daria.MessageWidget._widgets)if(!s.isViewUserClose(n)){var i=Daria.MessageWidget._widgets[n];(s.isShow(n)||Daria.MessageWidget[i](t))&&(s.show(n,{silent:!0}),e.insertWidget(n))}},Daria.MessageWidget._checkShowDownloadFull=function(e){var t=ns.Model.get("message-body",e),s=t.getFirstBody();return!(!s||!s.trimmed)},Daria.MessageWidget._checkShowIgnoreThread=function(e){var t=ns.Model.get("message",e),s=ns.Model.get("labels"),n=s.getMuteThreadLabel();return!(!n||!t.hasLabel(n.lid))},Daria.MessageWidget._checkShowImapDeleted=function(e){if(ns.Model.get("settings").isSet("hide-imap-deleted"))return!1;var t=ns.Model.get("message",e);return!(!t.hasLabelWithSymbolicName("deleted_label")&&!t.get(".flags.imap-deleted"))},Daria.MessageWidget._checkShowNoreply=function(e){var t=ns.Model.get("message",e),s=ns.Model.get("labels"),n=s.getWaitingForReplyLabel();return!(!n||!t.hasLabel(n.lid))},Daria.MessageWidget._checkShowTranslate=function(e){if(!ns.Model.get("settings").isSet("translate"))return!1;var t=Daria.Translate.getLangByMid(e.ids),s=Daria.Config.locale;if(!t||t===s)return!1;var n=ns.Model.get("message-body",e),i=n.getHTML();if(i.innerHTML.length>2e5)return Jane.c(71105,"msg.too_big"),!1;var a=$(i).text();return!!$.trim(a)},Daria.MessageWidget._checkShowSpam=function(e){var t=ns.Model.get("message",e);if(t.isYaSupport())return!1;var s=ns.Model.get("message-body",e),n=s.hasPhishingBody();if(!t.isSpam()&&!n)return!1;var i=s.getData();return i.hasOwnProperty("has-links")&&i.hasOwnProperty("has-img")||s.getHTML(),!(!i["has-links"]&&!i["has-img"])},Daria.MessageWidget._checkShowEvent=function(){return"RUS"===Daria.Config.product&&!Daria.IS_CORP}}()},2028:function(e,t,s){s(2029),s(2030),s(2031),s(2032),s(2033)},2029:function(e,t){!function(){var e=function(e){var t=e.parent();return e.offset().left+e.innerWidth()-11<t.offset().left+t.width()},t=null;ns.events.on("b-mail-dropdown-closed",function(){t&&(t.removeClass("b-yabble b-yabble_contact b-yabble_selected"),t=null)}),ns.action.define("message-head.dropdown",function(s,n,i,a){n=n||{};var o=$(a.currentTarget);if(e(o)&&!o.hasClass("b-message-head__contact_readonly")){var r=t&&t[0]===o[0],u=o.find(".b-message-head__contact__arrow"),d={id:n.id,value:{name:n.name,email:n.email},root:o,arrow:u,fromMessage:!0,delay:-1,my:n.my?"yes":"",cid:n.cid||o.data("cid")||""};Daria.YabbleDropdown.toggle(d),r||(o.addClass("b-yabble_selected"),t=o)}}),ns.action.define("message.add-contact",function(e,t){t=t||{};var s=ns.request("abook-contact",{email:t.email}).then(function(e){return e[0]},function(){return null});Jane.Services.runModules(["abook.js"],function(){s.then(function(e){var s=Boolean(e),n=s&&(e.isShared()||e.isSharedLocal()),i={mail_addr:t.email,first_name:t.name,shared:n};return s?ns.Model.get("abook-person-manager").updatePerson(e,i):ns.Model.get("abook-person-manager").addPerson(i)}).then(function(e){ns.Model.invalidateAll("abook-contacts");var s=e[0].get(".cid");$(".b-message-head__contact").each(function(e,n){var i=ns.action.getParams(n);i.email!==t.email||i.cid||$(n).data("cid",s)})})}),$(document).trigger("b-mail-dropdown-closeall")})}(),ns.action.define("message.counter-filters-create",function(){return!0}),ns.action.define("message.counter-properties",function(){return!0})},2030:function(e,t){ns.action.define("attachments.image-preview-next",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Jane.c("Просмотрщик картинок","Показ стрелок"),Jane.c("Просмотрщик картинок","Клик по стрелкам"),Daria.ImageViewer.next()}),ns.action.define("attachments.image-preview-prev",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Jane.c("Просмотрщик картинок","Показ стрелок"),Jane.c("Просмотрщик картинок","Клик по стрелкам"),Daria.ImageViewer.prev()}),ns.action.define("attachments.image-preview-print",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Jane.c("Просмотрщик картинок","Печать");var i=window.open();i.document.open(),i.document.write('<!doctype html><html><body><img src="'+t.src+'"></body></html>'),i.document.close(),i.onload=function(){try{i.focus(),i.print(),i.close()}catch(e){}}}),ns.action.define("attachments.image-preview-gallery",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Jane.c("Просмотрщик картинок",t.closer?"Клик по крестику галереи":"Показать всё"),Daria.ImageViewer.toggleGallery()}),ns.action.define("attachments.image-preview-select",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Daria.ImageViewer.select(Number(t.index)),Daria.ImageViewer.hideGallery()}),ns.action.define("attachments.image-preview-scroll",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Daria.ImageViewer.scrollGallery(Number(t.to))}),ns.action.define("attachments.image-preview-subject",function(e,t,s,n){n.preventDefault(),n.stopPropagation(),Jane.c("Просмотрщик картинок","Клик по теме"),Daria.Layer.close(),ns.page.go(s.hash)}),ns.action.define("attachments.image-preview-download",function(e,t,s,n){return n.stopPropagation(),Jane.c("Просмотрщик картинок",t.count),!0})},2031:function(e,t){ns.action.define("layer.close",function(){Daria.Layer.close()})},2032:function(e,t){ns.action.define("message.video-player-open",function(e,t){return Daria.VideoPlayer.open(t)}),ns.action.define("message.video-player-close",function(){return Daria.VideoPlayer.close()})},2033:function(e,t){ns.action.define("message.lists-add-from-message",function(e,t){Jane.Services.runModules(["setup.js"],function(){ns.action.run("filters.lists-add-from-message",t)})})},2034:function(e,t,s){!function(){var e={"thread-sidebar-wrap&":{},"message-head":function(){var e={"message-head-subject":{},"message-head-folder":{},"message-head-sender-name&":{},"message-head-recipient&":{},"message-head-recipient-count&":{},"message-head-dkim&":{},"important-toggleable-head":{},"message-head-sender-wrap":{},"message-head-labels":{},"message-head-date":{}};return Daria.showPriorityLabel()&&(e["priority-toggleable-head"]={}),e},"message-widget&":{},"message-body&":{},"attachments-widget-body&":{}};Daria.is3pane()||(e["message-quick-reply&"]={}),ns.layout.define("layout-message",{message:e});var t={"app right-box@":function(){var t={};return Daria.getPrevPageSearchContext()&&(t["messages-search-session"]={}),ns.View.infoLite("message-headline").methods.checkShow()?(t["message-headline"]={},t.message=e):t.message=e,t["message-fake-list"]={},Daria.is2pane()&&(t["message-prevnext"]={},t.footer={"footer-journal-link&":{},"footer-help-link":{}}),t}};ns.layout.define("message",t,"common+left+toolbar");var s={"message-head-eml":{"message-head-subject-eml":{"message-head-date-eml":{}},"message-head-sender-name-eml&":{},"message-head-recipient&":{},"message-head-recipient-count&":{}},"message-body":{},"attachments-widget-body":{}};ns.layout.define("attached-message-preview",{"attached-message":s}),ns.layout.define("map-up",{"map-up":{map:{"map-city-complaint":{}},"map-actions":{}}});var n={"app service-box@":{404:{}}};n["app "+Daria.getDirectBlockLayoutInfo("messages-direct").name]={},ns.layout.define("no-message",n,"common")}(),s(2035),s(2036),s(2037)},2035:function(e,t){ns.layout.define("layout-quick-reply-message",{"quick-reply-message":{message:{"message-head":{"message-head-sender-name&":{},"message-head-recipient&":{},"message-head-recipient-count&":{},"message-head-sender-wrap":{},"message-head-date":{},"message-head-labels":{}},"message-toolbar-fake":{},"message-body&":{}}}})},2036:function(e,t){ns.layout.define("message-head-sender-empty",{"message-head-sender@":{}}),ns.layout.define("message-head-sender-info",{"message-head-sender@":{"message-head-sender-info&":{}}})},2037:function(e,t){ns.layout.define("layout-thread-sidebar",{"thread-sidebar-box":{"message-prevnext":{},"thread-sidebar":{},"thread-sidebar-expand-button":{}}}),ns.layout.define("layout-thread-sidebar-item",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{}}}),ns.layout.define("layout-thread-sidebar-item-related",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-related&":{}}}),ns.layout.define("layout-thread-sidebar-item-attachments",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-attachments&":{}}}),ns.layout.define("layout-thread-sidebar-item-links",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-links&":{}}}),ns.layout.define("layout-thread-sidebar-item-same-author",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-same-author&":{}}})},2038:function(e,t,s){s(2039),s(2040),s(2041),s(2042),s(2043),s(2044),s(2045),s(2046),s(2047),s(2048),s(2049),s(2050),s(2051),s(2052),s(2053),s(2054),s(2055),s(2056),s(2057),s(2058),s(2059),s(2060),s(2061),s(2062),s(2063),s(2064),s(2065)},2039:function(e,t){ns.Model.define("do-send-promise-sms",{params:{phone:null,offset:null}})},2040:function(e,t){ns.Model.define("do-postmaster",{params:{from:null,mid:null,perc:null,readTime:null,time:null,yandexuid:null}})},2041:function(e,t){ns.Model.define("do-unsubscribe",{params:{ids:null}})},2042:function(e,t){ns.Model.define("get-event",{params:{data:null}})},2043:function(e,t){ns.Model.define("get-event-ics",{params:{ids:null,stid:null,inc_hid:null}},"base-calendar-event")},2044:function(e,t){ns.Model.define("get-event-by-ics",{params:{uid:null,icsUrl:null}})},2045:function(e,t){ns.Model.define("geo-coder",{params:{geocode:null,ll:null}})},2046:function(e,t){ns.Model.define("geo-ip",{methods:{getCoordinates:function(){var e=this.select(".get_coordinates_by_ip.latitude")[0],t=this.select(".get_coordinates_by_ip.longitude")[0];return e&&t?t+","+e:""}}})},2047:function(e,t){ns.Model.define("map-data",{params:{address:null}})},2048:function(e,t){ns.Model.define("message-in-reply-to-ng",{params:{message_id:null},methods:{_sortByDateDesc:function(e,t){return e.date>t.date?-1:e.date<t.date?1:0},getLastDraft:function(){if(!this.isValid())return null;var e=ns.Model.get("folders").getFolderBySymbol("draft");if(!e)return null;var t=null,s=e.fid;return this.getData().envelopes.sort(this._sortByDateDesc).some(function(e){return e.fid===s&&(t=e,!0)}),t}}})},2049:function(e,t){ns.Model.define("message-nearest",{params:{ids:null},methods:{preprocessData:function(e){return _.forEach(e.message,function(e){if(e.mid){var t=ns.Model.get("message",{ids:e.mid});t.isValid()||t.get(".current")||t.setData(e)}}),e},getNearestMessages:function(){var e={prev:null,current:null,next:null};return(this.get(".message")||[]).forEach(function(t){["next","prev","current"].forEach(function(s){t[s]&&(e[s]=t)})}),e},getNextMid:function(){return this.select(".message[.next].mid")[0]||null},canShowPrevNext:function(){var e=this.getNearestMessages();return e.prev||e.next},isNew:function(e){return ns.Model.get("message",{ids:e}).isNew()},getNearestMids:function(){return(this.get(".message")||[]).filter(function(e){return e.mid&&!e.current}).map(function(e){return e.mid})}}})},2050:function(e,t){ns.Model.define("message-toolbar",{events:{"ns-model-before-destroyed":"onBeforeDestroyed"},params:{ids:null},ctor:function(){this.recalculateButtons=this.recalculateButtons.bind(this)},methods:{toShowUnsubscribeButton:function(e,t,s){var n=s.hasListUnsubscribe(),i=s.hasFactUnsubscribe();return!e&&t>3&&(n||i)},SMART_BUTTON_ID_FALLBACK:Daria.Constants.TOOLBAR_BUTTONS.REPLY,onBeforeDestroyed:function(){this._unbindModelEvents()},request:function(){return ns.request(["message","message-body"],{ids:this.params.ids}).then(this._bindModelEvents,this)},_bindModelEvents:function(e){this.mMessage=_.find(e,"id","message"),this.mMessageBody=_.find(e,"id","message-body"),this.mMessage.on("ns-model-changed",this.recalculateButtons),this.recalculateButtons()},_unbindModelEvents:function(){this.mMessage.off("ns-model-changed",this.recalculateButtons)},recalculateButtons:function(){var e=this.mMessage,t=this.mMessageBody,s=Daria.Constants.TOOLBAR_BUTTONS,n=e.inFolderBySymbol("draft"),i=e.inFolderBySymbol("archive"),a=e.isSpam(),o=e.isPinned(),r=_.contains(e.getSOLabels(),"12"),u=t.allowedReplyAll(),d=this.toShowUnsubscribeButton(a,e.getTrustLevel(),t),l=e.isValidForPin(),c=!r&&!n,h=[{id:s.REPLY,condition:c&&!u},{id:s.REPLY_ALL,condition:c&&u},{id:s.FORWARD,condition:!n&&!r},{id:s.DELETE,condition:!0},{id:s.SPAM,condition:!n&&!a&&!r},{id:s.NOT_SPAM,condition:!n&&a},{id:s.REPLY,condition:c&&u},{id:s.UNSUBSCRIBE,condition:!n&&d},{id:s.ARCHIVE,condition:!n&&!i},{id:s.LABELS_ACTIONS,condition:!0},{id:s.FOLDERS_ACTIONS,condition:!0},{id:s.PIN,condition:l&&!o},{id:s.UNPIN,condition:l&&o}],g=n?s.DRAFT_FINISH:this.SMART_BUTTON_ID_FALLBACK;h.some(function(e){return e.id===g})||h.unshift({id:g,condition:!0});var m=ns.Model.get("all-toolbar-buttons"),f=h.filter(function(e){return e.condition}).map(function(e){return m.getButtonById(e.id)}).filter(function(e){return Boolean(e)}),p=Daria.is3pv()?3:4,b=f.length>p,v=f.splice(0,p);b&&v.push(m.getButtonById(s.MORE));var A={visibleButtons:v,moreButtons:f};this.setData(A)}}})},2051:function(e,t){ns.Model.define("message-thread-nearest",{events:{"ns-model-init":"_onInit"},params:{ids:null},methods:{_onInit:function(){this.setData({})},getNearestMessages:ns.Model.infoLite("message-nearest").methods.getNearestMessages}},ns.ModelStatic)},2052:function(e,t){ns.Model.define("message-widget-state",{params:{ids:null},events:{"ns-model-init":function(){this.setData({show:{"message-widget-translate":!1}})}},methods:{isViewUserClose:function(e){return Boolean(this.get("."+e+"-user-close"))},setViewUserClose:function(e){this.set("."+e+"-user-close",!0),this.setIfChanged(".show."+e,!1)},resetViewUserClose:function(e,t){this.set("."+e+"-user-close",!1,t),this.setIfChanged(".show."+e,!1,t)},show:function(e,t){this.set("."+e+"-user-close",!1),this.setIfChanged(".show."+e,!0,t)},isShow:function(e){return Boolean(this.get(".show."+e))}}},ns.ModelStatic)},2053:function(e,t){ns.Model.define("message-draft",{params:{ids:null},methods:{request:function(){return ns.request("message-body",this.params).then(this._requestMessageInReplyTo,this).then(this._requestDraftMessage,this).then(this._requestApplyData,this)},getDraftMid:function(){var e=this.get(".mid");if(e){var t=ns.Model.get("message",{ids:e});t.isValid()&&!t.isDraftLike()&&(e=void 0,this.setIfChanged(".mid",e))}return e},_requestMessageInReplyTo:function(e){var t=_.find(e,"id","message-body"),s=t.get(".info.message-id");return s?new vow.Promise(function(e){ns.forcedRequest("message-in-reply-to-ng",{message_id:s}).then(function(t){var s=t[0],n=s.getLastDraft(),i=n&&n.mid;e(i)},function(){e()})}):vow.Promise.resolve()},_requestDraftMessage:function(e){return e?new vow.Promise(function(t){ns.request(["message","message-body"],{ids:e}).then(function(s){var n=_.find(s,"id","message"),i=n.getFolderId();i&&ns.Model.get("folders").isFolder(i,["draft","outbox"])?t(e):t()},function(){t()})}):vow.Promise.resolve()},_requestApplyData:function(e){this.setData({mid:e})}}})},2054:function(e,t){Daria.InfiniteModelCollection=function(){},no.inherit(Daria.InfiniteModelCollection,ns.ModelCollection,{canLoadMore:function(){return Boolean(this.get(".details.canLoadMore"))},isEmpty:function(){return!this.models||!this.models.length},loadMore:function(){var e=0;this.isValid()?e=this.models.length:this.clear();var t=_.assign({},this.params,{first:e});return ns.request(this.id,t).then(function(e){var t=e[0];this.data&&this.isValid()||(this.data={},this.status=this.STATUS.OK);var s=t.get(".details")||{},n=this.get(".details")||{},i=t.models;return this.set(".details",_.merge(n,s),{silent:!0}),this.insert(i),ns.Model.destroy(t),i},this)}})},2055:function(e,t){ns.Model.define("thread-attachments-item",{model:{"thread-attachments-item":!0},params:{"url-key":null},methods:{preprocessData:function(e){var t=Daria.getExtensionInfo(e.name);return t.class&&(e.icon=t.class),e}}})},2056:function(e,t){ns.Model.define("thread-attachments",{params:{thread_id:null,first:null},split:{items:".attachments",params:{"url-key":".url-key"},model_id:"thread-attachments-item"}},Daria.InfiniteModelCollection)},2057:function(e,t){ns.Model.define("thread-sidebar-item",{params:{thread_id:null,id:null},methods:{getId:function(){return this.get(".id")}}})},2058:function(e,t){ns.Model.define("thread-sidebar",{events:{"ns-model-init":"_onInit"},params:{thread_id:null},split:{items:".items",params:{thread_id:".thread_id",id:".id"},model_id:"thread-sidebar-item"},methods:{_onInit:function(){this.setData({items:[]})}}},ns.ModelCollectionStatic)},2059:function(e,t){ns.Model.define("thread-sidebar-state",{events:{"ns-model-init":"_onInit"},ctor:function(){this.triggerUpdateDebounce=_.debounce(this.triggerUpdate.bind(this),50)},methods:{_onInit:function(){this.setData({activeItemId:1,flight:!1,body:{},relatedScrollTop:0,relatedScrollIntoView:!0,update:!1})},toggleItem:function(e){var t=this.get(".activeItemId");return t===e?(this.set(".activeItemId",null),!1):(null!==t&&(this.setIfChanged(".relatedScrollTop",0,{silent:!0}),this.setIfChanged(".relatedScrollIntoView",!0,{silent:!0})),this.set(".activeItemId",e),!0)},unsetActiveItem:function(){this.setIfChanged(".relatedScrollTop",0,{silent:!0}),this.setIfChanged(".relatedScrollIntoView",!0,{silent:!0}),this.setIfChanged(".activeItemId",1)},isActive:function(e){return this.get(".activeItemId")===e},isFlight:function(){return this.get(".flight")},shouldScrollRelatedIntoView:function(){return Boolean(this.get(".relatedScrollIntoView"))},disableScrollRelatedIntoViewFlag:function(){this.setIfChanged(".relatedScrollIntoView",!1,{silent:!0})},triggerUpdate:function(){this.set(".update",!0)},metrikaCount:function(){var e=Array.prototype.slice.call(arguments);e.unshift("Правая колонка",this.get(".flight")?"Плавающая правая колонка":"Статичная правая колонка"),Jane.c.apply(Jane,e)},metrikaBlockCount:function(e){Jane.c("Правая колонка","Блоки правых колонок",e)}}},ns.ModelStatic)},2060:function(e,t){ns.Model.define("messages-from",{params:{first:null,from:null},split:{items:".envelopes",model_id:"messages-from-item",params:{ids:".mid"}}},Daria.InfiniteModelCollection)},2061:function(e,t){ns.Model.define("messages-from-item",{params:{ids:null},methods:{preprocessData:function(e){return e.subject&&"No subject"!==e.subject||(e.subject=i18n("%Без_темы")),e.date.view=Daria.MessageTime.getFormattedTime(e.date.timestamp),e},hasRelativeTime:function(){return this.get(".date.view.isRelative")},updateTime:function(){var e=Daria.MessageTime.getFormattedTime(this.get(".date.timestamp"));this.set(".date.view",e)}}})},2062:function(e,t){ns.Model.define("messages-thread-link",{params:{id:null},methods:{preprocessData:function(e){return e.host=$.url(e.src).Host,e}}})},2063:function(e,t){ns.Model.define("messages-thread-links",{params:{thread_id:null,first:null},split:{items:".links",params:{id:".id"},model_id:"messages-thread-link"}},Daria.InfiniteModelCollection)},2064:function(e,t){ns.Model.define("message-widget",{events:{"ns-model-init":"_onInit"},params:{ids:null,type:null},methods:{_onInit:function(){this.setData({type:null})}}},ns.ModelStatic)},2065:function(e,t){ns.Model.define("message-widget-list",{isCollection:!0,events:{"ns-model-init":"_onInit"},params:{ids:null},methods:{_onInit:function(){this.setData({})},insertWidget:function(e){return this.insert(ns.Model.get("message-widget",_.extend({type:e},this.params)).setData({type:e}))}}},ns.ModelCollectionStatic)},2066:function(e,t,s){Daria.message={},s(2067),s(2070),s(2071),s(2072),s(2073),s(2074),s(2075),s(2076),s(2083),s(2084)},2067:function(e,t,s){!function(){var e={"audio-player":s(2068),"audio-player-large":s(2069)};Daria.message.audioPlayer={},Daria.message.audioPlayer.init=function(t){if(!swfobject.hasFlashPlayerVersion("9.0.0"))return void Daria.Dialog.open({title:"Flash",body:i18n("%Message_Audio_No_Flash")});var s,n=t.currentTarget,i=$(n),a=n.getAttribute("href")||n.getAttribute("data-href"),o=Boolean(n.getAttribute("data-large")),r=i.parent().find(".b-file__player"),u=r.children('[id ^= "attach-player-"]');if(u.length?s=u.attr("id"):(s="attach-player-"+Daria.getRandomNumber(),$("<span/>",{id:s}).appendTo(r)),this._players[s]||(this._players[s]={playLink:n}),this._players[s].url||(this._players[s].url=a),o?i.closest(".b-file").addClass("b-file_player"):i.hide(),$("#"+s).parent().removeClass("g-hidden"),!this._players[s].swf){this.pause();var d=e["audio-player"+(o?"-large":"")+".swf"];swfobject.embedSWF(d,s,o?80:160,o?96:20,"9.0.0",null,{player_id:s,audio_url:encodeURIComponent(this._players[s].url)},{wmode:"transparent",quality:"high",bgcolor:"#ffffff",allowScriptAccess:"always"},{id:s}),this._players[s].swf=!0,this.playerAction(s,"play")}},Daria.message.audioPlayer._players={},Daria.message.audioPlayer._activePlayer=null,Daria.message.audioPlayer.pause=function(){if(this._activePlayer)try{$("#"+this._activePlayer)[0].pausePlayer()}catch(e){}},Daria.message.audioPlayer.playerAction=window.playerAction=function(e,t){switch(t){case"play":e!==this._activePlayer&&this.pause(),this._players[e].status="playing",this._activePlayer=e;break;case"pause":this._players[e].status="paused";break;case"close":e===this._activePlayer&&this.pause(),$("#"+e).parent().addClass("g-hidden"),$(this._players[e].playLink).show()}},Daria.message.audioPlayer.reset=function(){for(var e in this._players)swfobject.removeSWF(e),$(this._players[e].playLink).show(),delete this._players[e]}}()},2068:function(e,t,s){e.exports=s.p+"_/b90101dc0b89f64a70383b1f7a81f7a7-audio-player.swf"},2069:function(e,t,s){e.exports=s.p+"_/a46524573a02d4ea8db5c9c5a3cc5af6-audio-player-large.swf"},2070:function(e,t){var s=new RegExp("(^|\\.)yandex\\.("+Daria.Config.domainZonesForReg+")$"),n=String(i18n("%Confirm_site_out_Yandex")).replace(/\s*\\n\s*/g,"\n"),i=String(i18n("%Form_submit_disallowed")).replace(/\s*\\n\s*/g,"\n");Daria.message.formWarning=function(e){var t=e.target,a=t.getAttribute("action");if(!/^https?:\/\//.test(a))return window.alert(i),!1;var o=t.action.split("/")[2];return!(!o||!s.test(o))||(Jane.ErrorLog.send({event:"formWarning",host:a}),window.confirm(n))}},2071:function(e,t){Daria.message.getLinkStaffByEmail=function(e){return Daria.email.isCorp(e)?Daria.Config["staff-host"]+"/"+e.split("@")[0]:""}},2072:function(e,t){var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Daria.ImageViewer={openImages:function(e,t){var s=this,n=$(window);$.isArray(e)?this.images=e:this.images=[],this.images.length&&(this.ppyrus=!1,this.images[0].mid||(this.ppyrus=!0),this.images=$.map(this.images,function(e){return s.getImageData(e)}),this.imgObjects={},this.$currentImage=null,this.$content=$(Jane.tt("message:image-viewer",{count:this.images.length,attachment:this.images})),this.$title=this.$content.find(".b-image-viewer__title"),this.$download=this.$content.find(".b-image-viewer__download"),this.$fullsize=this.$content.find(".b-image-viewer__fullsize"),this.$page=this.$content.find(".b-image-viewer__page"),this.$subject=this.$content.find(".b-image-viewer__subject"),this.$from=this.$content.find(".b-image-viewer__from"),this.$to=this.$content.find(".b-image-viewer__to"),this.$date=this.$content.find(".b-image-viewer__date"),this.$print=this.$content.find(".b-image-viewer__print"),this.$gallery=this.$content.find(".b-image-viewer__gallery-i"),this.ppyrus&&this.$content.find(".b-image-viewer__meta").hide(),this.originalScrollTop=n.scrollTop(),Daria.Layer.open({body:this.$content,onclose:function(){s.onclose()}}),1===this.images.length?this.$content.addClass("b-image-viewer_single"):Jane.c("Просмотрщик картинок","Показ стрелок"),this.$content.addClass("b-image-viewer_loading"),this.updateLayout(),n.on("resize",this.onresize),$(document).on("click",this.ondocumentclick),this.$gallery.on("mousewheel",this.onmousewheel),$.Shortcuts.modalListOn("image-viewer"),isNaN(t)||"number"!=typeof t?this.currentIndex=0:(this.currentIndex=t,this.select(t)))},showSavePopup:function(e){var t=this.images[this.currentIndex];ns.View.create("disk-widget-save-popup").open({mid:t.mid,hid:t.hid,popup:{where:e,withTail:!1,appendTo:".js-image-viewer"},countLocationName:"в просмотрщике картинок"}),Jane.c(["Вложения",'клик "сохранить на диск"',"в просмотрщике картинок"])},open:function(e,t,s,n){var i=this,a={ids:t};n&&(a.hid=n),ns.request(["message-body","message"],a).then(function(e){var n=[],a=0,o={mid:t,attachment:e[0].data.attachment||[]};$.each(o.attachment,function(){"image"===this.class&&this["browser-supports"]&&(o.mid===t&&this.hid===s&&(a=n.length),n.push(Object.assign({mid:o.mid},this)))}),i.openImages(n),i.select(a)})},onclose:function(){var e=$(window);e.off("resize",this.onresize),$(document).off("click",this.ondocumentclick),this.$gallery.off("mousewheel",this.onmousewheel),$.Shortcuts.modalListOff("image-viewer"),"originalScrollTop"in this&&(e.scrollTop(this.originalScrollTop),delete this.originalScrollTop),this.images=[],this.imgObjects={},this.$currentImage=null,Jane.c("Просмотрщик картинок","Закрытие")},onresize:function(){var e=Daria.ImageViewer;e.$content.find(".b-image-viewer__container, .b-image-viewer__arrow").css({width:"",height:""}),e.updateLayout()},ondocumentclick:function(e){var t=$(e.target);t.closest(".b-image-viewer__gallery").length||Daria.ImageViewer.hideGallery(),t.closest(".b-image-viewer").length||Daria.Layer.close();var s=t.closest(".js-show-save-popup");s.length&&(e.preventDefault(),e.stopPropagation(),Daria.ImageViewer.showSavePopup(s.get(0)))},onmousewheel:function(e){var t=e.originalEvent;Daria.ImageViewer.scrollGallery(-t.wheelDelta||t.detail,50,!0)},updateImage:function(){var e=this.images[this.currentIndex];this.$currentImage&&this.$currentImage.removeClass("b-image-viewer__image_current"),this.createImage(this.currentIndex),this.createImage(this.getNextIndex(this.currentIndex)),this.createImage(this.getPrevIndex(this.currentIndex)),this.$currentImage=this.imgObjects[this.currentIndex],this.$currentImage.addClass("b-image-viewer__image_current"),this.$currentImage[0].complete?this.$content.removeClass("b-image-viewer_loading"):this.$content.addClass("b-image-viewer_loading"),this.$title.html(e.name),this.$title.attr("title",e.name),this.$download.attr("href",e.downloadUrl),this.$page.html(this.currentIndex+1),this.$subject.html(e.subject),this.$subject.attr("href",e.emailUrl),this.$from.html(e.from),this.$to.html(e.to),this.$date.html(e.date),this.$content.find(".b-image-viewer__preview").removeClass("b-image-viewer__preview_current"),this.$content.find(".b-image-viewer__preview_"+this.currentIndex).addClass("b-image-viewer__preview_current"),e.fullSizeUrl?(this.$print.attr("data-params","src="+encodeURIComponent(e.fullSizeUrl)),this.$fullsize.attr("href",e.fullSizeUrl),this.$print.show(),this.$fullsize.show()):(this.$print.hide(),this.$fullsize.hide())},createImage:function(e){var t=this;if(!this.imgObjects[e]){this.$content.addClass("b-image-viewer_loading");var s=$('<img class="b-image-viewer__image">');s.appendTo(this.$content.find(".b-image-viewer__container")),s.one("load",function(){t.$currentImage&&t.$currentImage.length&&(t.$currentImage[0].complete?t.$content.removeClass("b-image-viewer_loading"):t.$content.addClass("b-image-viewer_loading"))});var n=this.images[e];n.fullSizeUrl?s.attr("src",n.fullSizeUrl):s.attr("src",n.downloadUrl),s.css({maxWidth:this.maxImageSize[0],maxHeight:this.maxImageSize[1]}),this.imgObjects[e]=s}},updateLayout:function(){var e=$(window),t=e.width()-185,s=e.height()-100;this.ppyrus||(s-=this.$content.find(".b-image-viewer__meta").height()),this.maxImageSize=[t,s];var n=t/3,i=2*n;this.$content.find(".b-image-viewer__content").css({width:e.width()-170}),this.$content.find(".b-image-viewer__container").css({width:t,lineHeight:s+"px"}),this.$content.find(".b-image-viewer__container, .b-image-viewer__arrow").css("height",s),this.$content.find(".b-image-viewer__image").css({maxWidth:t,maxHeight:s}),this.$content.find(".b-image-viewer__arrow_prev").css({width:n}),this.$content.find(".b-image-viewer__arrow_next").css({width:i,marginLeft:-i+"px",backgroundPosition:i-35+"px 50%"})},getImageData:function(e){var t,n,i,a,o,r,u,d;if("object"===(void 0===e?"undefined":s(e))&&e||(e={}),e.mid){var l=ns.Model.get("message",{ids:e.mid}),c=l.getEmails();t=Daria.url.attachment(e,e.mid),n=Daria.url.attachment(e,e.mid,{no_disposition:!0,exif_rotate:!0}),i=Daria.url.attachment(e,e.mid,{no_disposition:!0,thumb:!0,exif_rotate:!0}),a=c.from,o=c.to,r=_.escape(l.getSubject()),u="#message/"+e.mid,d=l.getDate()}else t=e.url,n=e.fullSizeUrl,i=e.thumbUrl,a=e.from||"",o=e.to||"",r=e.subject||"",u=e.emailUrl||"",d=e.date||"";return a=this.formatEmail(a),o=this.formatEmail(o),{name:_.escape(e.name),filename:_.escape(e.filename),downloadUrl:t,fullSizeUrl:n,thumbUrl:i,from:a,to:o,subject:r,emailUrl:u,date:d,mid:e.mid,hid:e.hid}},formatEmail:function(e){var t="";return e&&"object"==(void 0===e?"undefined":s(e))&&(t=_.escape(e.name||e.email),e.name&&e.email&&(t+=" &lt;"+_.escape(e.email)+"&gt;")),t},next:function(){this.currentIndex=this.getNextIndex(this.currentIndex),this.updateImage()},getNextIndex:function(e){var t=e+1;return t>=this.images.length&&(t=0),t},prev:function(){this.currentIndex=this.getPrevIndex(this.currentIndex),this.updateImage()},getPrevIndex:function(e){var t=e-1;return t<0&&(t=this.images.length-1),t},select:function(e){e>=0&&e<this.images.length&&(this.currentIndex=e,this.updateImage())},toggleGallery:function(){this.$content.toggleClass("b-image-viewer_gallery"),this.$gallery[0].scrollLeft=168*(this.currentIndex+1)-this.$gallery.width()/2,this.scrollGallery(1,1e-4,!0)},hideGallery:function(){this.$content.removeClass("b-image-viewer_gallery")},isGalleryOpen:function(){return this.$content.hasClass("b-image-viewer_gallery")},scrollGallery:function(e,t,s){t=t||800;var n=this.$gallery[0],i=n.scrollLeft+(e<0?-1:1)*t,a=this,o=function(){a.$content.find(".b-image-viewer__gallery-arrow").removeClass("b-image-viewer__gallery-arrow_disabled");var e=n.scrollLeft;0===e&&a.$content.find(".b-image-viewer__gallery-arrow_left").addClass("b-image-viewer__gallery-arrow_disabled"),e<i&&a.$content.find(".b-image-viewer__gallery-arrow_right").addClass("b-image-viewer__gallery-arrow_disabled")};s?n.scrollLeft=i:this.$gallery.animate({scrollLeft:i},500,"linear",o),o()}}},2073:function(e,t){Daria.Layer={init:function(){this.$el=$('<div class="b-layer"><div class="b-layer__overlay"></div><div class="b-layer__content-wrap"><div class="b-layer__close ns-action" data-click-action="layer.close"></div><div class="b-layer__content"></div></div></div>'),this.$el.appendTo(document.body),this.$content=this.$el.find(".b-layer__content"),this.$window=$(window);var e=this;this.$window.resize(function(){e.opened&&e.$el.css({width:e.$window.width(),height:e.$window.height()})}),ns.events.on("ns-page-before-changed",function(){Daria.Layer.close()})},open:function(e){this.opened&&this.close(),this.opened=!0,this.$el||this.init(),this.onclose=e.onclose,this.$el.css({width:this.$window.width(),height:this.$window.height()}),this.$content.empty().append(e.body),window.scrollTo(0,0),$(document.documentElement).addClass("b-page_layer")},close:function(){this.opened=!1,$(document.documentElement).removeClass("b-page_layer"),"function"==typeof this.onclose&&this.onclose()}}},2074:function(e,t){var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Daria.message.Location=function(e){if(!(e instanceof jQuery))throw new Error("Node should be a jQuery object");if(!e.get(0).childNodes)throw new Error("Malformed address node");if(this._$node=e,this._parsed=null,this._highlighted=!1,this._address=e.data("address"),!this._address)throw new Error("Passed node should have an address")},Daria.message.Location.prototype.getAddress=function(){return this._address},Daria.message.Location.prototype._getMapData=function(){return ns.Model.get("map-data",{address:this._address}).getData()},Daria.message.Location.prototype.findParsedMetadata=function(e){this._parsed=_.find(e,{geo_addr:this.getAddress()})},Daria.message.Location.prototype._needsHighlight=function(){return!!this.isKnownAddress()&&(!!this.inUserArea()||(this.hasCity()||this.isUnique()))},Daria.message.Location.prototype._doHighlight=function(){var e=this._$node.get(0),t=_.last(e.childNodes),s=t.textContent.lastIndexOf(" ");-1!==s?$(t.splitText(s+1)).wrap('<span class="mail-Message-Map-NoBreak"></span>').parent().append('<span class="mail-Message-Map-Link-Icon icon"></span>').parent().addClass("js-extracted-highlighted-address mail-Message-Map-Link"):this._$node.append('<span class="mail-Message-Map-Link-Icon icon"></span>').addClass("js-extracted-highlighted-address mail-Message-Map-Link")},Daria.message.Location.prototype.highlight=function(){this._needsHighlight()&&(this._doHighlight(),this._highlighted=!0)},Daria.message.Location.prototype.isHighlighted=function(){return this._highlighted},Daria.message.Location.prototype.isKnownAddress=function(){return Boolean(this._getMapData().addressLocation)},Daria.message.Location.prototype.inUserArea=function(){return this._getMapData().inUserArea},Daria.message.Location.prototype.isUnique=function(){return this.isKnownAddress()&&1===this._getMapData().addressLocation.precision},Daria.message.Location.prototype._checkHasMeta=function(){if("object"!==s(this._parsed))throw new Error("Set parsed address metadata from tomita using location.setParsedMeta()")},Daria.message.Location.prototype.hasCity=function(){return this._checkHasMeta(),Boolean(this._parsed.geo&&this._parsed.geo.city)},Daria.message.Location.prototype.hasStreet=function(){return this._checkHasMeta(),Boolean(this._parsed.addr&&this._parsed.addr.street)}},2075:function(e,t){Daria.VideoPlayer={flashPlayerVersion:swfobject.getFlashPlayerVersion().major,currentSWFOptions:{},currentHostingOptions:{},defaultSWFOptions:{width:425,height:355,flashvars:{}},SWFParams:{allowscriptaccess:"always",allowfullscreen:!0,quality:"high",bgcolor:"#000000"},expressInstallSWFUrl:"http://img.yandex.net/i/expressinstall.swf",hostingOptions:{youtube:{urlAddon:"&amp;enablejsapi=1&amp;playerapiid=ytplayer",pauseMethod:"pauseVideo"}},defaultHostingOptions:{flashPlayerVersion:8},open:function(e){if(e=$.extend({},this.defaultSWFOptions,e),!e.player_url||!e.hosting_name)return!0;var t=this.hostingOptions[e.hosting_name.toLowerCase().split(".")[0]];if(t=$.extend({},this.defaultHostingOptions,t),this.flashPlayerVersion<t.flashPlayerVersion)return!0;this.$popup||this.init(),e.width=parseInt(e.width,10),e.height=parseInt(e.height,10),e.player_url!==this.currentSWFOptions.player_url&&($(".b-movie-player").css({width:e.width+"px",height:e.height+"px"}),e.player_url=e.player_url.replace(/^https?:/,""),swfobject.embedSWF(e.player_url+(t.urlAddon||""),"movie-player",e.width,e.height,String(t.flashPlayerVersion),this.expressInstallSWFUrl,e.flashvars,this.SWFParams),this.currentSWFOptions=e,this.currentHostingOptions=t),this.$paranja.removeClass("g-hidden");var s=$(window),n=s.height(),i=s.scrollTop(),a=e.width+60,o=this.$popup.height(),r=o<n?(n-o)/2:0;this.$popup.css({width:a,"margin-right":-Math.round(a/2),top:i+Math.round(r)}),this.$popup.css("visibility","visible"),$("#movie-player").css("visibility","visible"),$.Shortcuts.modalListOn("video-player")},close:function(){this.$popup.css("visibility","hidden"),$("#movie-player").css("visibility","hidden"),this.$paranja.addClass("g-hidden"),$.Shortcuts.modalListOff();var e=this.currentHostingOptions.pauseMethod;if(e){var t=document.getElementById("movie-player");t[e]instanceof Function&&t[e]()}else swfobject.removeSWF("movie-player"),this.$popup.find(".b-movie-player").html('<div id="movie-player"></div>'),this.currentSWFOptions={},this.currentHostingOptions={}},init:function(){var e=Jane.tt("message:video-player");this.$popup=$(e),this.$popup.css("visibility","hidden").appendTo(document.body),this.$paranja=$('<div class="b-paranja b-paranja_mail"><iframe></iframe></div>').addClass("g-hidden").appendTo(document.body)}}},2076:function(e,t,s){!function(){"use strict";var e=Daria.MessageProcess={};s(2077),s(2078),s(2079),s(2080),e.QUOTES_CHUNK_SIZE=10,e.F_QUOTE={AUTHOR_NEXT:"an",AUTHOR_POSITION_SEARCH:"aps",BUBBLING_CONTENT:"bc",CONCAT:"cq",EXPANDED_ALL:"ea",FOUND_AUTHOR:"fa",LEVEL_FIRST:"lf",LEVEL_LAST:"ll",LEVEL_CENTER:"lc",SEARCH_AUTHOR:"sa",WRAP:"qw",WRAP_SEP:"qws"},e.BODY_PROCESS=null,e.getTopParent=function(t){return e.BODY_PROCESS||t},e.flagContains=function(e,t){return!!t&&(1===e.nodeType&&-1!==(" "+(e.getAttribute("data-processed")||"")+" ").indexOf(" "+t+" "))},e.flagAdd=function(e,t){if(1!==e.nodeType)return!1;var s=Array.prototype.slice.call(arguments);s.shift();var n=e.getAttribute("data-processed");n=n?" "+n+" ":" ";for(var i,a=!1,o=0;i=s[o++];)-1===n.indexOf(" "+i+" ")&&(n+=i+" ",a=!0);return!!a&&(e.setAttribute("data-processed",n.trim()),!0)},e.flagRemove=function(e,t){if(1!==e.nodeType)return!1;var s=Array.prototype.slice.call(arguments);s.shift();var n=e.getAttribute("data-processed");n=n?" "+n+" ":"";for(var i,a=!1,o=0;i=s[o++];)for(;-1!==n.indexOf(" "+i+" ");)n=n.replace(" "+i+" "," "),a=!0;return!!a&&(e.setAttribute("data-processed",n.trim()),!0)},e.getQuotesByLevel=function(t,s){return s?t.querySelectorAll?t.querySelectorAll('blockquote[data-level="'+s+'"]'):(s=Number(s),Array.prototype.filter.call(t.getElementsByTagName("blockquote"),function(t){return e.getQuoteLevel(t)===s})):t.getElementsByTagName("blockquote")},e.getQuoteLevel=function(e){return Number(e.getAttribute("data-level")||0)},e._findQuoteFirstLine=function(t){if(!t.hasChildNodes())return"";var s,n,i=/\n/g,a=0;if(Jane.DOM.eachInnerFollowingText(t,function(e,t){return!Jane.DOM.isBlockquote(e)&&(t=Jane.String.removeNonLetterString(t.trim()),n=t.match(i),!((n=n?n.length:0)!==a&&t.length>100)&&(s=t,void(a=n)))}),!s)return"";var o=!1;if(s=s.split("\n").filter(function(e){return!o&&!Jane.String.REG.NONLETTER_STR.test(e)||(o=!0,!1)}),!s.length)return"";for(var r=s.length,u="",d=-1;r--;)u=s[r]+u,e.Author.parseAuthorText(u)&&(d=r);return-1!==d&&(s=s.slice(0,d)),s.length?s=Jane.String.substrWord(s.join(" "),0,200):""},e._removeEmptyNodeCheck=function(e){return!Jane.DOM.isBlockquote(e)&&(-1===["IMG","HR"].indexOf(e.nodeName)&&(!Jane.DOM.hasAttribute(e,"style")&&!Jane.DOM.classContains(e,"icon")))},e._quoteWrapSeparator=function(t){if(!e.flagContains(t,e.F_QUOTE.WRAP_SEP)){e.flagAdd(t,e.F_QUOTE.WRAP_SEP);var s=t.parentNode;Jane.DOM.removeEmptyNodeBefore(t,e._removeEmptyNodeCheck,s),Jane.DOM.removeEmptyNodeAfter(t,e._removeEmptyNodeCheck,s),Jane.DOM.eachBefore(t,function(e){return Jane.DOM.classContains(e,"js-quote-ignore")?"next":!Jane.DOM.isBlockquote(e)&&(!!Jane.DOM.isEmptyText($.text(e))||(Jane.DOM.classAdd(t,"b-quote__t_sep"),!1))},s),Jane.DOM.eachAfter(t,function(e){return Jane.DOM.classContains(e,"js-quote-ignore")?"next":!Jane.DOM.isBlockquote(e)&&(!!Jane.DOM.isEmptyText($.text(e))||(Jane.DOM.classAdd(t,"b-quote__b_sep"),!1))},s)}},e._quoteWrapSeparatorInner=function(e){Jane.DOM.eachInnerPrevious(e,function(t){return 3!==t.nodeType||Jane.DOM.isEmptyTextNode(t)?(!Jane.DOM.isBlockNode(t)||t===e)&&void 0:(Jane.DOM.classAdd(e,"b-quote__cb_sep"),!1)}),Jane.DOM.eachInnerFollowing(e,function(t){return 3!==t.nodeType||Jane.DOM.isEmptyTextNode(t)?(!Jane.DOM.isBlockNode(t)||t===e)&&void 0:(Jane.DOM.classAdd(e,"b-quote__ct_sep"),!1)})},e._bubblingQuoteContentCheckNode=function(e){return!Jane.DOM.hasAttribute(e,"style")},e._bubblingQuoteContent=function(t,s){if(!t.hasChildNodes())return t;for(var n=e.getQuotesByLevel(t,s),i=0,a=n.length;i<a;i++)e.flagContains(n[i],e.F_QUOTE.BUBBLING_CONTENT)||(Jane.DOM.bubblingDivContent(n[i],e._bubblingQuoteContentCheckNode),e.flagAdd(n[i],e.F_QUOTE.BUBBLING_CONTENT));return t},e._concatQuotes=function(t,s){if(!t.hasChildNodes())return t;var n,i,a,o,r=e.getQuotesByLevel(t,s),u=!s;for(a=0,o=r.length;a<o;a++)(n=r[a])&&(i=n.parentNode)&&e._concatChildQuotes(i,u);return t},e._concatChildQuotesIsEmptyNode=function(e){return Jane.DOM.isBr(e)||Jane.DOM.isEmptyTextNode(e)||Jane.DOM.isEmptyPreNode(e)},e._concatChildQuotes=function(t,s){for(var n,i,a,o,r,u,d=[t],l=[],c=t.ownerDocument.createElement("br");o=d.shift();)if(o.hasChildNodes()&&!e.flagContains(o,e.F_QUOTE.CONCAT)){for(i=o.firstChild,a=Jane.DOM.isBlockquote(i)?i:null;n=i.nextSibling;){if(Jane.DOM.isBlockquote(n)){if(a){if(l.length){for(u=!0,r=0;r<l.length;r++)u&&!Jane.DOM.isEmptyTextNode(l[r])&&(u=!1),a.appendChild(l[r]);l=[],u&&a.appendChild(c.cloneNode(!1))}else a.lastChild&&n.firstChild&&!Jane.DOM.isNewlineNode(a.lastChild)&&!Jane.DOM.isNewlineNode(n.firstChild)&&a.appendChild(c.cloneNode(!1));for(;n.firstChild;)a.appendChild(n.firstChild);i=n.previousSibling,n.parentNode.removeChild(n),s&&-1===d.indexOf(a)&&e.getQuotesByLevel(a).length>0&&d.push(a);continue}a=n}else a&&e._concatChildQuotesIsEmptyNode(n)?l.push(n):(l=[],a=null,s&&Jane.DOM.isBlockNode(i)&&-1===d.indexOf(i)&&e.getQuotesByLevel(i).length>0&&d.push(i));i=n}e.flagAdd(o,e.F_QUOTE.CONCAT)}return c=null,t},e.fixQuotesSync=function(t,s,n){e._bubblingQuoteContent(t,s),e._concatQuotes(t,s),e.Author.findAndRemoveQuoteAuthorSync(t,s,n)},e.fixQuotes=function(t,s,n){e._bubblingQuoteContent(t,s),e._concatQuotes(t,s),e.Author.findAndRemoveQuoteAuthor(t,s,n)},e.wrapQuote=function(t,s){if(e.flagContains(t,e.F_QUOTE.WRAP))return!1;e.flagAdd(t,e.F_QUOTE.WRAP),s=s||{};var n=e.Author.getQuoteAuthor(t);e.Author.removeQuoteAuthorData(t);var i=e._findQuoteFirstLine(t);e._quoteWrapSeparator(t),e._quoteWrapSeparatorInner(t);var a=t.cloneNode(!0);e._expandSmallQuotes(a);var o=$(a);o.wrapInner('<div class="b-quote_content js-quote_content"/>');var r=o.find("> .b-quote_content");r.contents().wrapAll('<div class="b-quote__i js-quote-content"/>'),r.prepend(Jane.tt("message:js-message-body-quote-ctrls",{ids:s.ids})),i&&r.prepend(Jane.tt("message:js-message-body-quote-firstline",{firstline:i})),n&&(n.mid=s.ids,r.prepend(Jane.tt("message:js-message-body-quote-author",n)));var u=$(Jane.tt("message:js-message-body-quote-toggler"));return r.after(u),t.parentNode.replaceChild(a,t),e.flagContains(a,e.F_QUOTE.EXPANDED_ALL)&&(e.flagRemove(a,e.F_QUOTE.EXPANDED_ALL),e.wrapQuotesSync(a,!1,function(e){Jane.DOM.classAdd(e,"b-quote_expanded")},s),Jane.DOM.classAdd(a,"b-quote_expanded")),!0},e.wrapQuotesSync=function(t,s,n,i,a){n=n||$.noop,e.fixQuotesSync(t,s,a);for(var o=e.getQuotesByLevel(t,s),r=0,u=o.length;r<u;r++)e.wrapQuote(o[r],i),n(o[r])},e.wrapQuotes=function(t,s,n){var i=$({});i.queue(function(s){e.fixQuotes(t,null,s)}),i.queue(function(s){var i=e.getQuotesByLevel(t),a=Math.ceil(i.length/e.QUOTES_CHUNK_SIZE),o=a;if(!a)return void s();for(var r=0;r<a;r++)Daria.setZeroTimeout(function(t){return function(){for(var a=t*e.QUOTES_CHUNK_SIZE,r=0;r<e.QUOTES_CHUNK_SIZE;r++){var u=i[a+r];u&&e.wrapQuote(u,n)}0===--o&&s()}}(r))}),i.queue(s)},e.quoteExpandToggle=function(t,s,n,i){var a=Jane.DOM.classContains(t,"b-quote_expanded"),o=void 0===s;if(!1===s||o&&a)return void Jane.DOM.classRemove(t,"b-quote_expanded");if(!0===s||o&&!a){var r=e.getQuoteLevel(t)+1;e.wrapQuotesSync(t,r,null,n,i),Jane.DOM.classAdd(t,"b-quote_expanded")}},e.quoteExpandAll=function(t,s,n){s=s||$.noop;var i=$(t).closest(".b-quote_lt").get(0);e.wrapQuotes(i,function(){s();for(var n=e.getQuotesByLevel(i),a=n.length;a--;)n[a]&&Jane.DOM.classAdd(n[a],"b-quote_expanded");i===t&&Jane.DOM.classAdd(i,"b-quote_expanded")},n)},e.processBody=function(t,s){var n,i,a,o,r=document.createElement("div");e.BODY_PROCESS=r;try{for(n=0,i=e.BODY_TRANSFORMERS.regs.length;n<i;n++)a=e.BODY_TRANSFORMERS.regs[n],(o=a[2])&&!o(s.ids)||(t=t.replace(a[0],a[1]));for(r.innerHTML=t,n=0,i=e.BODY_TRANSFORMERS.dom.length;n<i;n++)(a=e.BODY_TRANSFORMERS.dom[n])(r,s)}catch(e){Jane.ErrorLog.sendException("PROCESS_BODY_ERROR",e)}return e.BODY_PROCESS=null,r},e.initQuotesByPage=function(t){$(".js-quote-mini > * > .js-quote-content",t).each(function(){if(!(this.offsetHeight<160)){var t=this.parentNode.parentNode,s=!1;e.flagContains(t,e.F_QUOTE.LEVEL_LAST)?(s=!0,e.quoteExpandToggle(t,!1)):e.flagContains(t,e.F_QUOTE.LEVEL_FIRST)?Jane.DOM.classAdd(t,"b-quote_minimized","b-quote_minimized_first"):Jane.DOM.classAdd(t,"b-quote_minimized","b-quote_minimized_center"),s||setTimeout(function(){this.scrollTop=this.scrollHeight}.bind(this),50)}})},e._expandSmallQuotes=function(t){Jane.DOM.classContains(t,"b-quote_expanded")||$.text(t).length>200||e.getQuotesByLevel(t).length||Jane.DOM.classAdd(t,"b-quote_expanded")}}()},2077:function(e,t){!function(){"use strict";Daria.MessageProcess.Actions={},Daria.MessageProcess.Actions.quoteExpand=function(e){var t=$(e.target);if(t.closest("a,.js-quote-control-expand").length)return!0;var s=t.data(),n=t.closest(".b-quote").get(0);return Daria.MessageProcess.quoteExpandToggle(n,!0,s,this.node),!0},Daria.MessageProcess.Actions.quoteExpandAll=function(e){var t=$(e.currentTarget),s=t.closest(".b-quote"),n=t.data();return s.addClass("b-quote_loading"),t.removeClass("ns-action"),Daria.MessageProcess.quoteExpandAll(s[0],function(){s.removeClass("b-quote_loading"),t.addClass("ns-action")},n),!0},Daria.MessageProcess.Actions.quoteExpandToggle=function(e){var t=$(e.currentTarget),s=t.closest(".b-quote").get(0);return Daria.MessageProcess.quoteExpandToggle(s),!0},Daria.MessageProcess.Actions.quoteMaximize=function(e){$(e.currentTarget).closest(".b-quote").removeClass("b-quote_minimized b-quote_minimized_first b-quote_minimized_center b-quote_minimized_last")},Daria.MessageProcess.Actions.toggleQuote=function(e){this.quoteExpand(e);var t=$(e.target);t.prev(".js-quote_content").removeClass("is-hidden"),t.addClass("is-hidden")}}()},2078:function(e,t){!function(e){function t(e){var t=e.nameGroup,s=e.emailGroup;return function(e){var n={weight:0},i=t&&e[t]?e[t].trim():null;i&&"*"!==i&&"."!==i&&(n.name=i,n.weight+=30);var a=s&&e[s]?Jane.FormValidation.getEmailFromString(e[s].trim()):null;return a&&(n.email=a,n.weight+=30),e[3]&&(n.weight+=5),n}}var s=e.Author={};s.AUTHOR_CHUNK_SIZE=10,s.REG_AUTHOR_PART_CONTEXT=/^(?:\)?>)\s?(?:wrote|пишет|пише|піша|написав|напісаў|yazdı|yazıyor|написал(?:\(а\)))?\s?:/,s.PARSE_AUTHOR_FORMATS=[["?prefix","namefirst","?date","?time"],["?prefix","?date","?time","namelast"]],s.PARSE_AUTHOR_PARTS={prefix:[[/^Sent from my (?:iPad|iPhone|iPod)/i,function(){return{weight:5}}]],date:[[/^(?:on\s)?(\d\d)\/(\d\d)\/(\d\d(?:\d\d)?)\s(?:at\s)?(\d{1,2}:\d\d(?::\d\d)?\s?(?:am|pm))/i,function(e){var t=Number(e[3]);t<100&&(t=2e3+t);var s=Date.UTC(t,Number(e[1])-1,Number(e[2]));return{weight:5,datetime:{date:e[2]+"."+e[1]+"."+e[3],ts:s,time:e[4]}}}],[/^\[?(?:on\s)?(\d\d)[\.\/\-](\d\d)[\.\/\-](\d\d(?:\d\d)?)\]?/i,function(e){var t=Number(e[3]);t<100&&(t=2e3+t);var s=Date.UTC(t,Number(e[2])-1,Number(e[1]));return{weight:5,datetime:{date:e[1]+"."+e[2]+"."+e[3],ts:!isNaN(s)&&s}}}],[/^\[?(?:on\s)?(\d{4})[\/\.\-](\d{2})[\/\.\-](\d{2})\]?/i,function(e){var t=Date.UTC(Number(e[1]),Number(e[2])-1,Number(e[3]));return{weight:5,datetime:{date:e[3]+"."+e[2]+"."+e[1],ts:!isNaN(t)&&t}}}],[/^\[?(?:on\s)?[^\s\d]*?\s?(\d{1,2})\s([^\s\d]+?)\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,s=Jane.Date.getMonthByName(e[2]);return-1!==s&&(t=Date.UTC(Number(e[3]),s,Number(e[1]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}],[/^\[?(?:on\s)?[^\s\d]*?\s?([^\s\d]+?)\s(\d{1,2})\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,s=Jane.Date.getMonthByName(e[1]);return-1!==s&&(t=Date.UTC(Number(e[3]),s,Number(e[2]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}],[/^\[?(?:on\s)?([^\s\d]+?)\s(\d{1,2})\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,s=Jane.Date.getMonthByName(e[1]);return-1!==s&&(t=Date.UTC(Number(e[3]),s,Number(e[2]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}]],time:[[/^\[?(?:at\s|в\s)?(\d{1,2}:\d\d(?::\d\d)?\s?(?:am|pm)?\s?(?:(?:[A-Z]{3})?[+-]\d\d:?(?:\d\d)?)?)\]?/i,function(e){return{weight:5,datetime:{time:$.trim(e[1])}}}]],namefirst:[[/^\*\s(?:от\s|пользователь\s)?(?:"|\\")?([^"\\\[\]<>]*)(?:"|\\")?\s?(?:<([^<>]+)>)?/i,function(e){var t={weight:0},s=$.trim(e[1]);s&&(t.name=s,t.weight=t.weight+30);var n=Jane.FormValidation.getEmailFromString($.trim(e[2]));return n&&(t.email=n,t.weight=t.weight+30),t}]],namelast:[[/^(?:от\s|пользователь\s|from\s|user\s|ад\s|від\s|карыстальнік\s|користувач\s|kullanıcı\s)(?:"|\\")?([^\:]*?)(?:"|\\")?\s?(?:<([^<>]+)>)?(?:\s?"?:)?$/i,t({nameGroup:1,emailGroup:2})],[/^(?:"|\\")?([^\:]*?)(?:"|\\")?\s?(?:<([^<>]+)>)?\s?(wrote|пишет|пише|піша|написав|напісаў|yazdı|yazıyor|написал(?:\(а\))?)(?:\s?"?:)?$/i,t({nameGroup:1,emailGroup:2})],[/^(?:"|\\")?([^\:]*?)(?:"|\\")?\s?(?:<([^<>]+)>)(?:\s?"?:)?$/i,t({nameGroup:1,emailGroup:2})],[/^(?:"|\\")(?:<([^<>]+)>)(?:"|\\"):$/i,t({nameGroup:1,emailGroup:1})]]},s.getQuoteAuthor=function(e){var t=e.getAttribute("data-author");if(!t)return null;try{t=JSON.parse(decodeURIComponent(t)),t.email&&(t.href=Daria.message.getLinkStaffByEmail(t.email))}catch(e){return null}return t},s.removeQuoteAuthorData=function(e){e.removeAttribute("data-author")},s.parseAuthorText=function(e){e=e.replace(/[,\n]/g," ").replace(/\s+/g," ").trim();for(var t,n,i,a,o,r,u,d,l,c,h,g,m=s.PARSE_AUTHOR_FORMATS,f=s.PARSE_AUTHOR_PARTS,p=0;t=m[p++];){for(i=0,c=0,h={},g=e;n=t[i++];){for(a="?"!==n.charAt(0),a||(n=n.substr(1)),l=null,d=null,o=f[n],u=0;r=o[u++];)if(d=g.match(r[0])){l=r[1](d);break}if(l)c+=l.weight,$.extend(!0,h,l);else if(a)break;d&&d[0]&&(g=g.substr(d[0].length).trim())}if(c>30)break}return h.weight=c,h.weight>30?h:null},s.findAndRemoveQuoteAuthorSync=function(e,t,n){for(var i,a=s._getQuotesAuthorNotProcessed(e,t),o=0;i=a[o++];)s._findAndRemoveQuoteAuthor(i);s._compareQuoteAuthorPosition(t,n)},s.findAndRemoveQuoteAuthor=function(e,t,n){n=n||$.noop;var i=s._getQuotesAuthorNotProcessed(e,t),a=i.length,o=Math.ceil(a/s.AUTHOR_CHUNK_SIZE),r=o;if(!o)return void n();for(var u=0;u<o;u++)Daria.setZeroTimeout(function(e){return function(){for(var a,o=e*s.AUTHOR_CHUNK_SIZE,u=0;u<s.AUTHOR_CHUNK_SIZE;u++)(a=i[o+u])&&s._findAndRemoveQuoteAuthor(a);0===--r&&(s._compareQuoteAuthorPosition(t),n())}}(u))},s._findQuoteAuthorContentCheck=function(e,t,n,i){if(Jane.DOM.isBlockquote(e))return!1;var a=Jane.DOM.isBlockNode(e);if(n.author&&a)return!1;if(i&&!n.author&&a&&(n.firstBlockNode=!0),3!==e.nodeType)return!0;var o=Jane.String.countLines(t);if(o>4)return!1;if(o!==Jane.String.countActualLines(t))return!1;!n.firstNode&&t.length>0&&(n.firstNode=e);var r=s.parseAuthorText(t);if(r){if(n.author&&n.author.weight>r.weight)return!1;n.authorStr=t,n.author=r,n.lastNode=e,delete n.firstBlockNode}else{if(n.firstBlockNode)return!1;if(i&&!n.author&&n.tmpNode&&e.nodeValue){var u=e.nodeValue.match(s.REG_AUTHOR_PART_CONTEXT);if(u){var d=u[0];if(t=n.authorStr+d,r=s.parseAuthorText(t))return n.author=r,n.tmpNode&&(n.lastNode=n.tmpNode,delete n.tmpNode),")"===d[0]&&(n.lastNode.nodeValue+=")"),e.nodeValue=e.nodeValue.substr(d.length),!1}}n.tmpNode=e,n.authorStr=t}return!0},s._findQuoteAuthorCreateRange=function(e,t){var s;try{s=document.createRange(),e===t?s.selectNode(e):(s.setStartBefore(e),s.setEndAfter(t))}catch(n){s=[e,t]}return s},s._findQuoteAuthorInner=function(e){var t={};if(Jane.DOM.eachInnerFollowingText(e,function(e,n){return s._findQuoteAuthorContentCheck(e,Jane.String.ltrim(n),t,!0)}),!t.author||!t.lastNode||!t.firstNode)return null;var n=!1;return Jane.DOM.eachAfter(t.lastNode,function(e){return 3!==e.nodeType||Jane.DOM.isEmptyTextNode(e)?!Jane.DOM.isBlockquote(e)&&void 0:(n=!0,!1)},e),n?{range:s._findQuoteAuthorCreateRange(t.firstNode,t.lastNode),author:t.author}:null},s._findQuoteAuthor=function(e){var t={};return Jane.DOM.eachBeforeText(e,function(e,n){return s._findQuoteAuthorContentCheck(e,Jane.String.rtrim(n),t,!1)},e.parentNode),t.author&&t.lastNode&&t.firstNode?{range:s._findQuoteAuthorCreateRange(t.lastNode,t.firstNode),author:t.author}:null},s.__findAndRemoveQuoteAuthor=function(e){var t=s._findQuoteAuthor(e)||s._findQuoteAuthorInner(e);return t?(Array.isArray(t.range)?Jane.DOM.deleteRangeContents(t.range[0],t.range[1]):(t.range.deleteContents(),t.range.detach()),t.author):null},s._findAndRemoveQuoteAuthor=function(t){e.flagAdd(t,e.F_QUOTE.SEARCH_AUTHOR);var n=s.__findAndRemoveQuoteAuthor(t);return!!n&&(Jane.DOM.classAdd(t,"b-quote_a"),e.flagAdd(t,e.F_QUOTE.FOUND_AUTHOR),t.setAttribute("data-author",encodeURIComponent(JSON.stringify(n))),!0)},s.__getQuotesAuthorNotProcessed=function(t){return!e.flagContains(t,e.F_QUOTE.SEARCH_AUTHOR)},s._getQuotesAuthorNotProcessed=function(t,n){return Array.prototype.filter.call(e.getQuotesByLevel(t,n),s.__getQuotesAuthorNotProcessed)},s._compareQuoteAuthorPosition=function(t,s){var n=e.getTopParent(s);if(n)for(var i,a,o=e.getQuotesByLevel(n,t),r={},u=0;i=o[u++];)e.flagContains(i,e.F_QUOTE.AUTHOR_POSITION_SEARCH)||(a=e.getQuoteLevel(i),r[a]?(Jane.DOM.classAdd(i,"b-quote_an"),e.flagAdd(i,e.F_QUOTE.AUTHOR_NEXT,e.F_QUOTE.AUTHOR_POSITION_SEARCH)):(e.flagContains(i,e.F_QUOTE.FOUND_AUTHOR)&&(r[a]=!0),e.flagAdd(i,e.F_QUOTE.AUTHOR_POSITION_SEARCH)))}}(Daria.MessageProcess)},2079:function(e,t){!function(){var e="message-body.transformers.location-facts",t=/\s/g,s={traverse:function(){var t=function e(t,s,n){s(t)&&(n(t),t.childNodes.length>0&&(t.normalize(),_.forEach(t.childNodes,function(t){e(t,s,n)})))};return function(s,n,i){Daria.assert(s instanceof Node,"Top node should be an instance of Node",e),Daria.assert("function"==typeof n,"Criterion should be a function",e),Daria.assert("function"==typeof i,"Action should be a function",e),t.apply(null,arguments)}}(),contains:function(){var t=function e(t,s,n){return s===t||null!==s.parentNode&&s!==n&&e(t,s.parentNode,n)};return function(s,n,i){return Daria.assert(s instanceof Node&&n instanceof Node&&i instanceof Node,"All arguments should be nodes",e),t(s,n,i)}}(),getSmallestContainingNodes:function(t,n){Daria.assert(t instanceof Node,"TopNode should be a Node",e),Daria.assert(n instanceof RegExp,"Regexp should be a RegExp",e);var i=[],a=function(e){var t=n.test(e);return n.lastIndex=0,t};return s.traverse(t,function(e){return a(e.textContent)},function(e){i.push(e)}),_.filter(i,function(e){return 0===e.childNodes.length||!i.some(function(n){return!(n===e||!s.contains(e,n,t))&&!a(e.textContent.replace(n.textContent))})})}},n=function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},i=function(e,t,s){this._char=e,this._position=t,this._node=s};i.prototype={getChar:function(){return this._char},getPosition:function(){return this._position},getNode:function(){return this._node}};var a=function(){this._stack=[]};a.prototype={push:function(e){this._stack.push(e)},getStart:function(){return this._stack[0]},getEnd:function(){return this._stack[this._stack.length-1]},getSize:function(){return this._stack.length},isEmpty:function(){return 0===this.getSize()},shift:function(){this._stack.shift()},pop:function(){this._stack.pop()},toString:function(){return _.map(this._stack,function(e){return e.getChar()?e.getChar():e.getNode().toString()}).join("")}};var o=function(e){this._fact=e,this._parsedAddress=e.geo_addr,this._reset()};o.prototype={_reset:function(){this._parts=[],this._parsedPosition=0,this._matched=!1,this._prevsiousChar=""},getCurrentPart:function(){return 0===this._parts.length&&this.addPart(),this._parts[this._parts.length-1]},addPart:function(){this._parts.push(new a)},getExpectedChar:function(){return this._parsedAddress.charAt(this._parsedPosition)},shiftExpectedChar:function(){return this._parsedPosition++,this.getExpectedChar()},isSkippableNode:function(e){return 0===e.childNodes.length&&["br","wbr"].indexOf(e.nodeName.toLowerCase())>-1},spaceRe:/\s/,match:function(e){var t=this.getCurrentPart().isEmpty(),s=!1;if(t?this._previousSymbol&&(s=e.getNode()!==this._previousSymbol.getNode()):s=e.getNode()!==this.getCurrentPart().getEnd().getNode(),e.getChar()===this.getExpectedChar())!s||t||this.isSkippableNode(this.getCurrentPart().getEnd().getNode())||this.addPart(),this.getCurrentPart().push(e),this.shiftExpectedChar(),this._previousSymbol=e;else if(this.anyMatched()&&this.isSkippableNode(e.getNode()))this.getCurrentPart().push(e);else if(this.spaceRe.test(e.getChar())){if(" "!==this.getExpectedChar())return;this.getCurrentPart().push(e),this.shiftExpectedChar()}else" "===this.getExpectedChar()?(this.shiftExpectedChar(),this.match(e)):s&&!e.getChar()?this.addPart():1===this.numMatched()&&this._previousSymbol.getChar()&&e.getChar()===this._previousSymbol.getChar()?(this._reset(),this.match(e)):this._reset();this._matched=this.numMatched()===this._parsedAddress.length},anyMatched:function(){return this.numMatched()>0},numMatched:function(){return this._parsedPosition},matches:function(){return this._matched},getAnchor:function(){var e=this._fact.addr,t=null;return["street","quarter","km","metro","numbers"].some(function(s){return s in e&&(t=e[s].toLowerCase(),!0)}),t},partToRange:function(e){if(this.normalizePart(e),e.isEmpty())return null;var t=document.createRange();return t.setStart(e.getStart().getNode(),e.getStart().getPosition()),t.setEnd(e.getEnd().getNode(),e.getEnd().getPosition()+1),t},normalizePart:function(e){for(;!e.isEmpty()&&(u.test(e.getStart().getChar())||this.isSkippableNode(e.getStart().getNode()));)e.shift();for(;!e.isEmpty()&&(d.test(e.getEnd().getChar())||this.isSkippableNode(e.getEnd().getNode()));)e.pop()},selectPart:function(){if(this._parts.forEach(function(e){this.normalizePart(e)},this),this._parts=this._parts.filter(function(e){return!e.isEmpty()}),1===this._parts.length)return this.getCurrentPart();var e,t=this.getAnchor();return t&&this._parts.some(function(s){var n=this.partToRange(s);return!!(n&&n.toString().toLowerCase().indexOf(t)>-1)&&(e=s,!0)},this)?e:_.max(this._parts,function(e){return e.toString().length})},wrap:function(e){var t=this.partToRange(this.selectPart());if(t&&0===$(t.commonAncestorContainer).closest("a, .js-extracted-address").size()){var s=document.createElement("span");s.setAttribute("class","js-extracted-address"),s.setAttribute("data-address",this._parsedAddress),s.setAttribute("data-ids",e);var n=t.extractContents();t.insertNode(s),s.appendChild(n),t.commonAncestorContainer.normalize()}}};var r=function(e,t){this._topNode=e,this._addressFact=t,this._currentNode=null,this._currentPositionInsideNode=-1,this._nodesQueue=[],this.buildQueue()};r.prototype={start:function(e){for(var t,s=this.getNewAddress(),n=[];t=this.shiftSymbol();)s.match(t),s.matches()&&(n.push(s),s=this.getNewAddress());n.reverse().forEach(function(t){t.wrap(e)})},getNewAddress:function(){return new o(this._addressFact)},_getCharAtPosition:function(e,t){return 3===e.nodeType&&t<e.textContent.length?new i(e.textContent.charAt(t),t,e):null},shiftSymbol:function(){var e=this.getCurrentNode();this._currentPositionInsideNode+=1;var t=this._getCharAtPosition(e,this._currentPositionInsideNode);return t||((e=this.shiftNode())?(this._currentPositionInsideNode=0,(t=this._getCharAtPosition(e,this._currentPositionInsideNode))||(s.contains(this._topNode,e,this._topNode)?new i(null,this._currentPositionInsideNode,e):null)):null)},getCurrentNode:function(){return this._currentNode||this.shiftNode()},shiftNode:function(){if(!this._currentNode)return this._currentNode=this._nodesQueue[0],this._currentNode;var e=this._nodesQueue.indexOf(this._currentNode);return this._nodesQueue.length>e?(this._currentNode=this._nodesQueue[e+1],this._currentNode):null},buildQueue:function(){var e=this._nodesQueue;3===this._topNode.nodeType?e.push(this._topNode):s.traverse(this._topNode,function(){return!0},function(t){e.push(t)})}};var u=/^[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\d\u0022\u0027\u00AB\u00BB\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2039\u203A\u300C\u300D\u300E\u300F\u301D\u301E\u301F\uFE41\uFE42\uFE43\uFE44\uFF02\uFF07\uFF62\uFF63\u0028\u0029\u005B\u005D\u2045\u2046\u003C\u003E\u007B\u007D\u00AB\u00BB\u2039\u203A\u2308\u2309\u230A\u230B\u231C\u231D\u231E\u231F\u239B\u239C\u239D\u239E\u239F\u23A0\u23A1\u23A2\u23A3\u23A4\u23A5\u23A6\u23A7\u23A8\u23A9\u23AB\u23AC\u23AD\u23AA\u23B0\u23B1\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u2E22\u2E23\u2E24\u2E25\u2329\u232A\uFF62\uFF63\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\uFF08\uFF09\uFF3B\uFF3D\uFF1C\uFF1E\uFF5B\uFF5D]+/,d=/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\d\u0022\u0027\u00AB\u00BB\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2039\u203A\u300C\u300D\u300E\u300F\u301D\u301E\u301F\uFE41\uFE42\uFE43\uFE44\uFF02\uFF07\uFF62\uFF63\u0028\u0029\u005B\u005D\u2045\u2046\u003C\u003E\u007B\u007D\u00AB\u00BB\u2039\u203A\u2308\u2309\u230A\u230B\u231C\u231D\u231E\u231F\u239B\u239C\u239D\u239E\u239F\u23A0\u23A1\u23A2\u23A3\u23A4\u23A5\u23A6\u23A7\u23A8\u23A9\u23AB\u23AC\u23AD\u23AA\u23B0\u23B1\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u2E22\u2E23\u2E24\u2E25\u2329\u232A\uFF62\uFF63\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\uFF08\uFF09\uFF3B\uFF3D\uFF1C\uFF1E\uFF5B\uFF5D\.,?!]+$/,l=function(e){return e.replace(u,"").replace(d,"")},c=function(e,i){var a=ns.Model.get("message-body",{ids:i.ids}).getLocations();a=_.uniq(a,function(e){return e.geo_addr}),_.forEach(a,function(e){e.geo_addr=l(e.geo_addr)}),_.sortBy(a,function(e){return-e.geo_addr.length}),_.forEach(a,function(a){var o=new RegExp(n(a.geo_addr).replace(t,"\\s*"),"g");s.getSmallestContainingNodes(e,o).forEach(function(e){new r(e,a).start(i.ids)})})};Daria.Transformers||(Daria.Transformers={}),Daria.Transformers.AddressTransformer=_.extend(c,{transformerName:"location-facts",debugMode:e,trimPunctuation:l,escapeRegExp:n,Nodes:s,Symbol:i,Stack:a,Address:o,Parser:r})}()},2080:function(e,t,s){!function(e){function t(e){var t=e.getAttribute("background");t&&(e.style.backgroundImage='url("'+t+'")'),e.removeAttribute("background")}var n=s(273),i=s(2081),a=s(2082),o="/re.jsx?uid="+Daria.uid+"&c=LIZA&cv="+Daria.Config.version+"&",r='<a href="{url}" target="_blank" rel="noopener noreferrer" class="ns-action"data-click-action="message.video-player-open" data-params="{params}"><img src="'+i+'" class="b-mail-icon b-mail-icon_video-link" alt="" title="'+i18n("%Message_Video_Link")+'"/></a><a href="{url}" target="_blank" rel="noopener noreferrer">{url}</a>',u="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000";e.REG_ATTACHMENTS_STOP_WORDS=new RegExp("(^|.*?["+u+"]+)("+a.join("|")+")($|["+u+"]+)","im"),e.REG_ATTACHMENTS_STOP_WORDS_LIGHT=new RegExp("("+a.join("|")+")","im"),e._checkParentAttachmentsSelect=function(e){var t=e.tagName;return"A"!==t&&"BLOCKQUOTE"!==t},e.attachmentsSelect=function(t){for(var s,n=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,function(s){return e.REG_ATTACHMENTS_STOP_WORDS_LIGHT.test(s.data)&&e.REG_ATTACHMENTS_STOP_WORDS.test(s.data)&&Jane.DOM.passByParents(s,e._checkParentAttachmentsSelect,t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),i=[];s=n.nextNode();)i.push(s);var a=document.createElement("span");a.className="b-pseudo-link b-pseudo-link_attach js-attachments-scroll";for(var o,r,u,d,l,c=0;(s=i.shift())&&(!(r=s.data.match(e.REG_ATTACHMENTS_STOP_WORDS))||(u=r.index+r[1].length,d=u+r[2].length,u>=d||(o=document.createRange(),o.setStart(s,u),o.setEnd(s,d),o.surroundContents(a.cloneNode(!0)),o.detach(),l=s.nextSibling&&s.nextSibling.nextSibling,l&&l.nodeType===Node.TEXT_NODE&&l.data.length>0&&i.unshift(l),c++,Jane.c("Аттачи в тексте письма","Показ ссылки"),!(c>4)))););c&&Jane.c("Аттачи в тексте письма","Количество открытий писем с подсвеченными ссылками")},e.BODY_TRANSFORMERS={regs:[[/(<img[\s\S]*?)src="([^"]*?)"([\s\S]*?\/?>)/gm,function(e,t,s,n){return t+'data-fake-img-src="'+s+'"'+n}]],dom:[Daria.Transformers.AddressTransformer,function(e){for(var s=$(e).find("*[background]"),n=s.length;n--;){t(s[n])}t(e)},function(e,t){for(var s=ns.Model.get("message",t),n=ns.Model.get("message-body",t).getData(),i=n["is-spam"],a=t.forceShowHrefs,r=n["is-support"],u=!1,d=e.getElementsByTagName("a"),l=d.length,c=o+"mid="+t.ids+"&";l--;){var h=d[l],g=h.getAttribute("href");if(g&&-1!==g.indexOf("/re.jsx?")){var m,f=g.slice(g.indexOf("&l=")+3);s.hasType(38)&&(m=$(h).data("livemail")),f&&(m?(g="//"+m.host+"/?ui=ext&spec="+encodeURIComponent(m.spec+m.inv),f=g):f=Daria.base64UrlDecode(f),h.setAttribute("data-vdir-href",g.replace("/re.jsx?",c)),h.setAttribute("data-orig-href",f),h.setAttribute("href",f))}if(g&&0===g.indexOf("mailto:")){var p=g.substr(7).split("?"),_=p.shift(),b=ns.parseQuery(p.shift()||""),v=Daria.lowerifyObjectKeys(b);v.mailto=_,Jane.DOM.classAdd(h,"ns-action"),h.setAttribute("data-click-action","common.go"),h.setAttribute("data-params","new_window&url="+encodeURIComponent(ns.router.generateUrl("compose2",v)))}else a||!i||r?(u=!0,Jane.DOM.classAdd(h,"daria-goto-anchor"),h.setAttribute("target","_blank"),h.setAttribute("rel","noopener noreferrer")):(u=!0,h.setAttribute("h_href",h.getAttribute("href")),h.removeAttribute("href"),Jane.DOM.classAdd(h,"ya-hidden-link"))}n["has-links"]=u},function(e,t){for(var s=t.forceShowImages,i=ns.Model.get("message-body",t).getData(),a=!1,o=i["hide-imgs"],r=i["has-links"],u=e.getElementsByTagName("img"),d=u.length;d--;){var l=u[d];if(a=!0,o&&!s){for(var c=l.attributes,h=document.createElement("img"),g=0,m=c.length;g<m;g++){var f=c[g],p=f.nodeName,_=f.nodeValue;"data-fake-img-src"===p?h.setAttribute("h_src",_):h.setAttribute("h_"+p,_)}h.setAttribute("src",n),h.setAttribute("class","ya-hidden-image"+(r?" ya-without-notice":"")),l.parentNode.replaceChild(h,l)}else{var b=l.getAttribute("data-fake-img-src");null!==b&&(l.removeAttribute("data-fake-img-src"),l.setAttribute("src",b))}}i["has-img"]=a},function(e){var t=e.getElementsByTagName("object"),s=t.length;if(!s)return e;var n=document.createElement("param");for(n.setAttribute("name","wmode"),n.setAttribute("value","opaque");s--;)t[s].appendChild(n.cloneNode(!1));n=null},function(e){for(var t=e.getElementsByTagName("embed"),s=t.length;s--;)t[s].setAttribute("wmode","opaque")},function(e){for(var t,s=e.getElementsByTagName("form"),n=s.length;n--;)t=s[n],t.className+=" js-message-form",t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"),t.removeAttribute("formaction")},function(e){for(var t=e.getElementsByTagName("area"),s=t.length;s--;)t[s].setAttribute("target","_blank"),t[s].setAttribute("rel","noopener noreferrer")},function(e){$("span.wmi-video-link",e).each(function(){var e=$(this);e.replaceWith(Daria.supplant(r,{url:e.text(),params:this.getAttribute("params")}))})},function(t){for(var s,n,i=e.getQuotesByLevel(t),a=i.length,o=0,r={};o<a;o++){s=i[o];for(var u=s,d=0;u=u.parentNode;)if(Jane.DOM.isBlockquote(u)){d=e.getQuoteLevel(u);break}var l=d+1,c=(r[l]||0)+1;s.setAttribute("type","cite"),s.setAttribute("data-level",String(l)),s.removeAttribute("style"),n="b-quote",0===d&&(n+=" b-quote_lt"),n+=l%2?" b-quote_odd":" b-quote_even",s.className=n,r[l]=c}},function(t){e.fixQuotesSync(t,1)},function(t){for(var s,n,i=e.getQuotesByLevel(t),a=i.length,o=0,r={};o<a;o++)s=i[o],n=e.getQuoteLevel(s),r[n]?(Jane.DOM.classAdd(s,"b-quote_lc"),e.flagAdd(s,e.F_QUOTE.LEVEL_CENTER)):(Jane.DOM.classAdd(s,"b-quote_lf"),e.flagAdd(s,e.F_QUOTE.LEVEL_FIRST)),r[n]=s;for(var u in r)s=r[u],Jane.DOM.classAdd(s,"b-quote_ll"),Jane.DOM.classRemove(s,"b-quote_lc"),e.flagAdd(s,e.F_QUOTE.LEVEL_LAST),e.flagRemove(s,e.F_QUOTE.LEVEL_CENTER);r=null},function(t,s){for(var n,i=e.getQuotesByLevel(t,1),a=i.length,o=0,r=ns.Model.get("message",{ids:s.ids}).isBodyAutoExpand(),u=a>1;o<a;o++)n=i[o],e.flagContains(n,e.F_QUOTE.LEVEL_LAST)||(r||u)&&(e.flagAdd(n,e.F_QUOTE.EXPANDED_ALL),u&&Jane.DOM.classAdd(n,"js-quote-mini"))},function(t,s){for(var n=e.getQuotesByLevel(t,1),i=n.length,a=0;a<i;a++)e.wrapQuote(n[a],s)},function(e,t){var s=Daria.MessageProcess.getQuotesByLevel(e,1);if(1===s.length&&!ns.Model.get("message",{ids:t.ids}).isForward()){var n=s[0],i=n.querySelector(".js-quote_content"),a=n.querySelector(".js-mail-Quote-Toggler");i&&a&&(Jane.DOM.classAdd(i,"is-hidden"),Jane.DOM.classRemove(a,"is-hidden"))}}]}}(Daria.MessageProcess)},2081:function(e,t,s){e.exports=s.p+"_/7a4dd71dafbb1404bfd494dae3fe02fd-b-mail-icon_video-link.gif"},2082:function(e,t){e.exports=["attach","аттач","прилагается","приложил","прикладываю","прикрепляю","приложенный","приложенном","вложил","вложение","вложенном","вложенный","вкладываю","прилагаю","см. файл","см.файл","лови файл","прикрепил","во вложении","в приложении","attachment","attachments","attached"]},2083:function(e,t){!function(e){var t=function(t,s){this._$main=e(t),this._onViewScrollBinded=e.proxy(this._onViewScroll,this),this._$blocks=this._$main.on("scroll.fixedscroll",_.debounce(this.recalc.bind(this),50)).find(s).on("scroll.fixedscroll",this._onViewScrollBinded),this.recalc()};t.prototype={addBlock:function(e){return this._$blocks=this._$blocks.add(e),e.on("scroll.fixedscroll",this._onViewScrollBinded),this},destroy:function(){this._$main.off(".fixedscroll"),this._$blocks.off(".fixedscroll"),this._$scroller&&(this._$scroller.off(".fixedscroll").remove(),delete this._$scroller)},_getCustomScroller:function(t){return this._$scroller||t||(this._$scroller=e('<div class="jquery-fixedscroll" style="display: none;"><div class="jquery-fixedscroll__i"></div></div>').on("scroll.fixedscroll",e.proxy(this._onCustomScroll,this)).appendTo(this._$main)),this._$scroller},_onCustomScroll:function(e){this._curBlock&&(this._curBlock.scrollLeft=e.currentTarget.scrollLeft)},_onViewScroll:function(e){var t=e.currentTarget;this._curBlock&&this._curBlock===t&&this._getCustomScroller().scrollLeft(t.scrollLeft)},recalc:function(){for(var t=0,s=this._$blocks.length;t<s;t++){var n=this._$blocks[t];if(n.scrollWidth>n.offsetWidth){var i=e(n),a=this._$main.offset(),o=this._$main[0].scrollTop,r=i.offset(),u=r.top-a.top+o,d=u+n.offsetHeight,l=o+this._$main[0].offsetHeight,c=o<=u&&u<=l,h=o<=d&&d<=l,g=o>=u&&d>=l;if((c||g)&&!h){this._setScroller(n);continue}}this._resetScroller(n)}},_setScroller:function(e){if(e!=this._curBlock||e.offsetWidth!=this._curBlockWidth){var t=this._getCustomScroller();this._curBlock=e,this._curBlockWidth=e.offsetWidth,t.width(this._curBlockWidth),t.find(":first").width(e.scrollWidth),t.show(),t.scrollLeft(e.scrollLeft)}},_resetScroller:function(e){if(e==this._curBlock){var t=this._getCustomScroller(!0);t&&t.hide(),delete this._curBlockWidth,delete this._curBlock}}},e.fn.fixedScroll=function(e){return new t(this,e)}}(jQuery)},2084:function(e,t){var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){!function(e){function t(t){return e.isFunction(t)||"object"==(void 0===t?"undefined":s(t))?t:{top:t,left:t}}var n=e.scrollTo=function(t,s,n){return e(window).scrollTo(t,s,n)};n.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(t){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this;if(t.nodeName&&-1==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]))return t;var s=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==s.compatMode?s.body:s.documentElement})},e.fn.scrollTo=function(i,a,o){return"object"==(void 0===a?"undefined":s(a))&&(o=a,a=0),"function"==typeof o&&(o={onAfter:o}),"max"==i&&(i=9e9),o=e.extend({},n.defaults,o),a=a||o.duration,o.queue=o.queue&&o.axis.length>1,o.queue&&(a/=2),o.offset=t(o.offset),o.over=t(o.over),this._scrollable().each(function(){function r(e){l.animate(h,a,o.easing,e&&function(){e.call(this,c,o)})}if(null!=i){var u,d=this,l=e(d),c=i,h={},g=l.is("html,body");switch(void 0===c?"undefined":s(c)){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(c)){c=t(c);break}if(c=g?e(c):e(c,this),!c.length)return;case"object":(c.is||c.style)&&(u=(c=e(c)).offset())}var m=e.isFunction(o.offset)&&o.offset(d,c)||o.offset;e.each(o.axis.split(""),function(e,t){var s="x"==t?"Left":"Top",i=s.toLowerCase(),a="scroll"+s,f=d[a],p=n.max(d,t);if(u)h[a]=u[i]+(g?0:f-l.offset()[i]),o.margin&&(h[a]-=parseInt(c.css("margin"+s))||0,h[a]-=parseInt(c.css("border"+s+"Width"))||0),h[a]+=m[i]||0,o.over[i]&&(h[a]+=c["x"==t?"width":"height"]()*o.over[i]);else{var _=c[i];h[a]=_.slice&&"%"==_.slice(-1)?parseFloat(_)/100*p:_}o.limit&&/^\d+$/.test(h[a])&&(h[a]=h[a]<=0?0:Math.min(h[a],p)),!e&&o.queue&&(f!=h[a]&&r(o.onAfterFirst),delete h[a])}),r(o.onAfter)}}).end()},n.max=function(t,s){var n="x"==s?"Width":"Height",i="scroll"+n;if(!e(t).is("html,body"))return t[i]-e(t)[n.toLowerCase()]();var a="client"+n,o=t.ownerDocument.documentElement,r=t.ownerDocument.body;return Math.max(o[i],r[i])-Math.min(o[a],r[a])}}(jQuery)}()},2085:function(e,t,s){s(2086),s(2087),s(2088),s(2089),s(2090),s(2091),s(2092),s(2093),s(2094),s(2095),s(2096),s(2097),s(2098),s(2099),s(2100),s(2101),s(2102),s(2103),s(2104),s(2105),s(2106),s(2107),s(2108),s(2109),s(2110),s(2111),s(2112),s(2113),s(2114),s(2115),s(2116),s(2117),s(2118),s(2119),s(2120),s(2121),s(2122),s(2123),s(2124),s(2125),s(2126),s(2127),s(2128),s(2129),s(2130),s(2131),s(2132),s(2133),s(2134),s(2135),s(2136),s(2137),s(2138),s(2139),s(2140),s(2141),s(2142)},2086:function(e,t){ns.View.define("attached-message",{events:{"ns-view-show":"onShow","click .js-attachments-scroll":"scrollToAttachments"},models:{message:!1,"message-body":!1},params:{ids:null,hid:null,subj:null},yateModule:"message",methods:{onShow:function(){ns.events.trigger("daria:vApp:changeAppWidth")},scrollToAttachments:function(){Jane.DOM.scrollIntoView(this.$node.find(".js-attachments-snippet")[0]),Jane.c("Аттачи в тексте письма","Клик")}}})},2087:function(e,t){ns.View.define("attached-message-popup",{models:{dimensions:{"ns-model-changed":"keepValid",resize:"_updatePosition"}},events:{"ns-view-destroyed":"_onDestroyed","wheel window":"onWheel"},params:{ids:null,hid:null,subj:null},yateModule:"message",ctor:function(){["_destroyContent","_onOpenedPopup","_onClosedPopup","_onDestroyedPopup","_onContentSetPopup","_updatePosition"].forEach(function(e){this[e]=this[e].bind(this)},this),this._nbPopup=null,this._vContent=null,this._contentNode=null},methods:{open:function(e){this._destroyContent();var t=this.getPopup();t.isOpen()?this._resetContentPopup():(this._show(),t.open(e))},close:function(){this.getPopup().close()},getPopup:function(){return this._nbPopup?this._nbPopup:(this._nbPopup=nb.find("attached-message-popup-"+this.params.ids+"-"+this.params.hid),this._nbPopup||(this._nbPopup=nb.block(ns.renderNode(this.params,"js-attached-message-popup","message"))),this._nbPopup.on("nb-opened",this._onOpenedPopup),this._nbPopup.on("nb-closed",this._onClosedPopup),this._nbPopup.on("nb-destroyed",this._onDestroyedPopup),this._nbPopup.on("nb-content-set",this._onContentSetPopup),this._nbPopup)},_resetContentPopup:function(){this._contentNode=ns.renderNode({},"js-attached-message-popup-loader","message"),this.getPopup().setContent(this._contentNode)},_destroyContent:function(){this._vContent&&(this._vContent.destroy(),this._vContent=null),this._contentNode=null},_destroyPopup:function(){this._nbPopup&&(this._nbPopup.$node.off("click",this._updatePosition),this._nbPopup.destroy(),this._nbPopup=null),this.hideAndUnbindEvents()},_updatePosition:function(){var e=this;setTimeout(function(){e._nbPopup&&e._nbPopup.$node&&e._nbPopup.$node.position({at:"center",of:window})},100)},_onContentSetPopup:function(){this._vContent=ns.View.create("attached-message",this.params),this._vContent._setNode(this._contentNode),this._vContent.invalidate(),this._vContent.updateByLayout("attached-message-preview",this.params,{execFlag:ns.U.EXEC.PARALLEL}).then(function(){var e=this.getPopup().$node,t=e.find("._nb-popup-content");if(Modernizr.ie10||Modernizr.ie11){var s=e.cssUnit("max-height"),n=e.find("._nb-popup-title"),i=s[0]-n.outerHeight();t.css("max-height",i+"px")}e.position({at:"center",of:window}),t.attr("tabindex","1").focus(),ns.events.trigger("daria:vApp:changeAppWidth")},this)},_onOpenedPopup:function(){this._resetContentPopup();var e=this.getPopup();e.$node.on("click",this._updatePosition),e.node.widget.option("beforeClose",this._onClosedPopup.bind(this))},_onClosedPopup:function(){setTimeout(function(){this.trigger("closed"),this._destroyPopup()}.bind(this),0)},_onDestroyedPopup:function(){this._destroyContent()},_onDestroyed:function(){this._destroyPopup()},getScrollContent:function(e){return $(e.target).parents("._nb-popup-content")[0]}}},"prevent-scroll-propagation-mixin",ns.View)},2088:function(e,t){ns.View.define("3pane-scroller",{events:{"ns-view-show":"onShow"},params:function(e){return{ids:e.thread_id||e.ids}},yateModule:"message",methods:{onShow:function(){this.$node.closest(".js-message-scroll-area").scrollTop(0)}}})},2089:function(e,t){!function(){ns.View.define("map",{models:{"map-data":!1},ctor:function(){this._map=null,this.initMap=this.initMap.bind(this),this.destroyMap=this.destroyMap.bind(this)},events:{"ns-view-htmlinit":"onhtmlinit"},yateModule:"message",methods:{onhtmlinit:function(){this.$frame=this.$node.find(".js-mail-message-map-frame"),ns.events.on("daria:vMap:initMap",this.initMap),ns.events.on("daria:vMap:closeMap",this.destroyMap)},initMap:function(){var e=this;Daria.Libs("Ya.Maps",function(){ymaps.ready(function(){var t=e.getModel("map-data").getData(),s=t.addressLocation,n=new ymaps.Map(e.$frame.get(0),{center:[s.lat,s.lon],behaviors:["default","scrollZoom"],zoom:15,type:"yandex#map",controls:["zoomControl","geolocationControl"]},{copyrightLogoVisible:!1,copyrightProvidersVisible:!1,copyrightUaVisible:!1,suppressMapOpenBlock:!0});n.controls.add(new ymaps.control.RulerControl({options:{position:{bottom:10,right:10}}})),n.controls.add("trafficControl",{float:"left",size:"small"});var i=new ymaps.Placemark([s.lat,s.lon],{},{preset:"islands#redDotIcon"});n.geoObjects.add(i),e._map=n})})},destroyMap:function(){this._map&&(ns.events.off("daria:vMap:initMap",this.initMap),ns.events.off("daria:vMap:closeMap",this.destroyMap),this._map.destroy(),this._map=null)}}})}()},2090:function(e,t){ns.View.define("map-actions",{yateModule:"message",models:{"map-data":!1}})},2091:function(e,t){!function(){ns.View.define("map-up",{params:{ids:null,address:null},yateModule:"message",methods:{open:function(){var e=this,t=ns.layout.page("map-up",this.params);return new ns.Update(this,t,this.params).render().then(function(){var t=Jane.tt("message:map-up"),s=nb.block(t);s.setContent(e.node),s.open({where:$("body").get(0),autoclose:!0,width:684,height:500});var n=function(e){e.keyCode===Jane.Common.keyCode.ESC&&(s.trigger("nb-closed"),e.preventDefault(),e.stopPropagation())},i=_.once(function(){window.removeEventListener("keydown",n,!0),_.defer(function(){ns.events.trigger("daria:vMap:closeMap"),s.destroy(),s=null})});s.on("nb-closed",i),window.addEventListener("keydown",n,!0),ns.events.trigger("daria:vMap:initMap"),Jane.c("Карты в письмах","Показ попапа с картой")})}}})}()},2092:function(e,t){ns.View.define("map-city-complaint",{models:{"message-body":!1,"map-data":!1},events:{"ns-view-htmlinit":"_onNsViewHtmlinit","ns-view-destroyed":"_onNsViewDestroyed","click .js-next":"_onClickNext","click .js-prev":"_onClickPrev","submit@show .js-form":"_onClickSubmit"},ctor:function(){this.slides=[]},yateModule:"message",methods:{_onNsViewHtmlinit:function(){this.slides=[".js-slide1",".js-slide2",".js-slide3"].map(function(e){return this.$node.find(e)},this),_.defer(this._initMapCityComplaint.bind(this))},_onNsViewDestroyed:function(){clearTimeout(this._errorTimeout);var e=nb.$block(".js-city",this.node);e&&e.hideError(),this.slides=[]},_onClickNext:function(){this._animateSlide(1,!0),this._animateSlide(2,!1)},_onClickPrev:function(e){e.stopPropagation(),this._animateSlide(1,!1),this._animateSlide(2,!0)},_onClickSubmit:function(e){e&&e.preventDefault(),this._sendMapCityComplaint()&&this._closeMapCityComplaint()},_initMapCityComplaint:function(){var e=this,t=ns.Model.get("account-information");(t.getDataKey("home")||t.hasSid(669))&&(e._getSlide(1).removeClass("js-init"),e._getSlide(2).css({bottom:-500}).each(function(){e._toggleSlide(2,!1,$(this))}).each(function(){var e=$(this);e.css({bottom:-1*e.outerHeight()})}).each(function(){e._toggleSlide(2,!0,$(this))}))},_getSlide:function(e){var t=$();return e>=1&&e<=this.slides.length&&(t=this.slides[e-1]),t},_toggleSlide:function(e,t,s){return s=s||this._getSlide(e),s.toggleClass("js-init",t)},_animateSlide:function(e,t,s){var n=this;return s=s||n._getSlide(e),t||(s=n._toggleSlide(e,t,s)),_.contains([1,3],e)?_.defer(function(){s=s.toggleClass("js-hide",t)}):2===e&&(t&&nb.$block(".js-city",s).hideError().blur(),_.defer(function(){var e=t?-1*s.outerHeight():"";s.css({bottom:e})}),t||s.afterTransition(function(){nb.$block(".js-city",s).focus()})),t&&(s=s.afterTransition(function(){n._toggleSlide(e,t,s)})),s},_closeMapCityComplaint:function(){var e=this,t=Daria.timify({seconds:2});e._animateSlide(2,!0);var s=e._animateSlide(3,!1).afterTransition(function(){setTimeout(function(){e._animateSlide(3,!0,s)},t)})},_serializeMessage:function(e){return _(e).map(function(e,t){return[t,JSON.stringify(e)]}).invoke("join",":\n").join("\n\n")},_sendMapCityComplaint:function(){var e=this._getSlide(2).find(".js-form")[0],t=$.trim(e.city.value);if(!t.length){clearTimeout(this._errorTimeout);var s=nb.$block(".js-city",this.node);return s.showError().focus(),this._errorTimeout=setTimeout(function(){s.hideError().focus()},1e3),!1}var n={"Корректировка пользователя":t,"Подчеркнули":this.params.address,"Факты":this.getModel("message-body").get(".facts")},i={ttype:"plain",to:Daria.Config.mapComplaintEmail,nosave:"yes",subj:"Неправильный город",send:this._serializeMessage(n)};return e.attach.checked&&(i.ign_overwrite="yes",i.ids=this.params.ids),Daria.SendMail.send({params:i}),!0}}})},2093:function(e,t){ns.View.edefine("message",{models:{"account-information":!1,labels:!1,message:{"ns-model-changed":function(e,t){if(!this.isVisible())return void this.invalidate();var s=this.getModel("message");if(".lid"===t||".new"===t){var n;switch(n=this.$node.hasClass("b-message")?this.$node:this.$node.find(".b-message"),t){case".lid":n.toggleClass("b-message_important",s.isImportant());break;case".new":var i=s.isNew();n.toggleClass("b-message_unread",i),n.toggleClass("is-unread",i),n.toggleClass("b-message_read",!i)}}}},"messages-checked":!1,"module-compose":!1,"module-message":!1,"scroller-message":!1,settings:!1,"state-message-thread-item":{"ns-model-changed":!1,"ns-model-changed.shouldBeInViewport":"placeInViewport","ns-model-destroyed":"keepValid"}},events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-touch":"ontouch","ns-view-hide":"onhide","ns-view-htmldestroy":"onhtmldestroy","daria:vMessage:message-body-loaded":function(){this.$node.addClass("b-message_loaded"),nb.init(this.node),this._initAttachments()},"daria:vToolbarButton:label":"_onLabelToolbarButton","daria:vToolbarButton:unlabel":"_onUnlabelToolbarButton","daria:vToolbarButton:mark":"_onToolbarButton","daria:vToolbarButton:unmark":"_onUnmarkToolbarButton","daria:vToolbarButton:move":"_onMoveToolbarButton","daria:vToolbarButton:remove":"_onRemoveToolbarButton","daria:vToolbarButton:tospam":"_onTospamToolbarButton","daria:vToolbarButton:notspam":"_onNotspamToolbarButton","daria:vToolbarButton:archive":"_onArchiveToolbarButton","daria:vToolbarButton:infolder":"_onInfolderToolbarButton","daria:vToolbarButton:unsubscribe":"_onToolbarButton","daria:vToolbarButton:reply":"_onReplyToolbarButton","daria:vToolbarButton:reply-all":"_onReplyAllToolbarButton","daria:vToolbarButton:reply-tmpl":"_replyHelper","daria:vToolbarButton:sendon":"_replyHelper","dragndrop.drop@show":"_onDrop","hotkeys.print":"print","hotkeys.alignOpenMessage":"onAlignOpenMessage","daria:folder-remove-done@show":"_onFolderRemove","daria:MOPS:action-complete@show":"_onActionComplete","click .js-attachments-scroll":"scrollToAttachments","click .js-message-close-button":"onCloseMessage","daria:vScrollerMessage:scroll@show":"onScroll","daria:layout-changed@show":"onScroll","folder.cleared@show":"onFolderCleared","resize@show window":"onResizeDebounce"},yateModule:"message",ctor:function(){this.onResizeDebounce=_.debounce(this.onResize.bind(this),50,{maxWait:50}),this._fixedToolbar=_.throttle(this._fixedToolbar.bind(this),20,{trailing:!0,leading:!0})},methods:{oninit:function(){this.mMessagesChecked=ns.Model.get("messages-checked",{mid:this.params.ids}),this.mMessagesChecked.on("run-action",this._runAction.bind(this))},onshow:function(){this.onResize(),this.placeInViewport();var e=this.params;ns.events.trigger("user.action.log",{action:"show",eventObject:{params:e,ids:{ids:[e.ids],mids:[e.ids]}}});var t=this.getModel("message");this.mMessagesChecked.check(t,!0),Daria.isMessagePage()?Jane.c("Просмотр письма",Daria.is2pane()?"2pane":"3pane","Показ Письма на отдельной странице"):Jane.c("Просмотр письма",Daria.is2pane()?"2pane":"3pane","Показ Письма в списке писем"),this.writeToUserJournal("startReading"),Daria.is3pane()&&Daria.lom.save(ns.page.current.params),Daria.setZeroTimeout(function(){ns.events.trigger("quick-reply:open-last-draft")}),ns.events.trigger("search.blur-input"),Daria.isMessagePage()||this.getModel("scroller-message").init()},onScroll:function(){this._fixedToolbar()},ontouch:function(){this._reSetMessagesChecked()},_reSetMessagesChecked:function(){this.mMessagesChecked.touch()},onhide:function(){this.mMessagesChecked.check(this.getModel("message"),!1,{silent:!0}),this._fixedToolbar.cancel(),this.getModel("scroller-message").clean(),this.resetFixedToolbar()},scrollToAttachments:function(){var e=this.getModel("scroller-message"),t=e.getScrollOffset(),s=Daria.is2pane()?this.$node.offset().top:this.node.offsetTop;e.setScrollTop(s-t,!0),Jane.c("Аттачи в тексте письма","Клик")},getMessageBodyBlock:function(){return this.getBlockByName("message-body-box").getActive()},getMessageBlock:function(){return this},onhtmldestroy:function(){$(window).off(".b-message")},_initAttachments:function(){var e=this.$node.find("#message-attachments-"+this.params.ids);if(e.length){var t=this.$node,s=t.find(".b-message-head"),n=this.attachments={blocks:{head:s.find(".b-message-head__field_attachments-expand"),body:e},shrinked:{head:!1,body:!1},view:{head:null,body:null}};this.attachments.buttons={head:s.find(".js-attachments-view"),body:n.blocks.body.find(".js-attachments-view")};t.find(".b-file__actions").each(function(){var e=$(".b-mail-button_light",this);e.length>1&&(e.eq(0).addClass("b-mail-button_first"),e.slice(1,-1).addClass("b-mail-button_middle"),e.eq(-1).addClass("b-mail-button_last"))}),$.each(n.blocks,function(e,t){t.find(".js-attachments-view-btn").attr("data-params",function(t,s){return(s?s+"&":"")+"metrika=attach:"+e+":viewfile"}).end().find(".js-attachments-get-btn").attr("data-params",function(t,s){return(s?s+"&":"")+"metrika=attach:"+e+":loadfile"})}),n.blocks.head.length||(Jane.c("attach","onefile","show"),s.find(".js-attachments-view-btn").attr("data-params","metrika=attach:head:viewone").end().find(".js-attachments-get-btn").attr("data-params","metrika=attach:head:loadone"))}},_onMoveMopsFulfilled:function(){ns.events.trigger("daria:vToolbarButton:loader:end"),this.invalidate()},_moveHelper:function(e,t){t=t||{};var s=_.last(e.split(":")),n=_.clone(t);n=_.extend({ids:this.mMessagesChecked.getIds()},n),$(document).trigger("b-mail-dropdown-closeall");var i=Daria.messages.whereToGoAfterMove(s,this.mMessagesChecked,n);return Daria.MOPS[s](this.mMessagesChecked,_.extend(t,i)).then(function(){this._onMoveMopsFulfilled()},this)},_onArchiveToolbarButton:function(e,t){return this._moveHelper("archive",t)},_onMoveToolbarButton:function(e,t){return this._moveHelper("move",t)},_onInfolderToolbarButton:function(e,t){return this._moveHelper("infolder",t)},_onRemoveToolbarButton:function(){return this._moveHelper("remove")},_onTospamToolbarButton:function(){return this._moveHelper("tospam")},_onNotspamToolbarButton:function(){return this._moveHelper("notspam")},_onMarkToolbarButton:function(e,t){return this._onToolbarButton("mark",t)},_onUnmarkToolbarButton:function(e,t){return this._onToolbarButton("unmark",t)},_onLabelToolbarButton:function(){var e=["daria:vToolbarButton:label"];return Array.prototype.push.apply(e,Array.prototype.slice.call(arguments,1)),this._onToolbarButton.apply(this,e)},_onUnlabelToolbarButton:function(){var e=["daria:vToolbarButton:unlabel"];return Array.prototype.push.apply(e,Array.prototype.slice.call(arguments,1)),this._onToolbarButton.apply(this,e)},_onReplyToolbarButton:function(e,t){return this._replyHelper("reply",t)},_onToolbarButton:function(e,t){if(t=t||{},t._viewKey&&t._viewKey!==this.key)return Vow.reject();var s=this,n=_.last(e.split(":"));$(document).trigger("b-mail-dropdown-closeall");var i;return i=-1===["label","mark","unlabel"].indexOf(n),Daria.MOPS.updateHelper(n,this.mMessagesChecked,t).then(function(){if(ns.events.trigger("daria:vToolbarButton:loader:end"),"unmark"===n&&!Daria.is3pane()||"unsubscribe"===n){var e=s.getModel("message").getFolderId();ns.page.go(ns.router.generateUrl("messages",{current_folder:e}))}else i&&s.update(ns.page.current.params)})},getMessagesCheckedInstance:function(){return this.mMessagesChecked},_onCloseDropdown:function(){$(".js-message-toolbar-dropdown",this.node).filter(function(){return nb.block(this).isOpen()}).each(function(){nb.block(this).close()})},markUnread:function(){this._onToolbarButton("daria:vToolbarButton:mark")},_runAction:function(e,t){if(this.isVisible()){var s="_on"+Daria.capitalize(t.action)+"ToolbarButton";_.isFunction(this[s])&&this[s](e,t.params)}},_onFolderRemove:function(e,t){var s=this.getModel("message");this.getModel("message").getFolderId()===t&&s.invalidate()},placeInViewport:function(){this.getModel("state-message-thread-item").get(".shouldBeInViewport")&&Jane.DOM.placeInViewport(this.node)},_onActionComplete:function(e,t){var s,n=Daria.isMessagePage()&&Daria.is2pane()||_.has(t,".whereToGo.updateRequired");switch(t.action){case"delete":case"unmark":case"move":case"tospam":case"notspam":"delete"===t.action&&this.invalidate(),n&&(s=_.get(t,".whereToGo.where"),s||(s=Daria.messages.whereToGoAfterMove(t.action,this.mMessagesChecked,t).where),_.delay(ns.page.go,60,s))}},onAlignOpenMessage:function(e,t){ns.page.current.params.ids===this.params.ids&&t.scroller.scrollIntoView(this.node,t.alignOptions)},getFocusableChildren:function(){return[this]},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":ns.page.go(Daria.Page.generateUrl.closeMessage());break;case"print":this.print()}},print:function(){Daria.Printer.printMessage(this.params.ids)},toggleCheck:function(){var e=this.getModel("message");this.getModel("messages-checked").toggleCheck(e)},focusOn:function(){"message"!==ns.page.current.page&&this.$node.addClass("is-focused")},focusOff:function(){this.$node.removeClass("is-focused")},onCloseMessage:function(){ns.page.go("#inbox")},isOpen:function(){var e=ns.page.current.params;return Boolean(e.thread_id||e.ids)},onFolderCleared:function(e,t){this.isOpen()&&this.getModel("message").getFolderId()===t&&ns.page.go(ns.router.generateUrl("messages",{current_folder:t}))},onResize:function(){Daria.isMessagePage()&&this.$node.toggleClass("mail-Message_wide",this.$node.width()<1e3)}}},"message-dimensions-mixin","fixed-message-toolbar-mixin","journal-log-mixin","message-actions")},2094:function(e,t){ns.View.define("message-body",{models:{settings:{"ns-model-changed":!1,"ns-model-changed.use_monospace_in_text":"forceUpdate"},message:!1,"message-body":{"ns-model-changed":!1,"daria:mMessageBody:moved":"_onMessageMove","daria:vMessageWidgetTranslate:translate":"_onMessageWidgetTranslateTranslate","daria:vMessageWidgetTranslate:revert":"_onMessageWidgetTranslateRevert"}},ctor:function(){this.anyLocationsHighlighted=!1,this.fireResizeBodyDebounce=_.debounce(this.fireResizeBody.bind(this),50)},events:{"ns-view-async":"_onNsViewAsync","ns-view-htmlinit":"_onNsViewHtmlinit","ns-view-show":"_onNsViewShow","ns-view-hide":"_onNsViewHide","ns-view-htmldestroy":"_onNsViewHtmldestroy","daria:vThreadSidebarBox:flight@show":"onThreadSidebarFlight","daria:vMessageWidgetSpam:showContent@show":"_onMessageWidgetSpamShowContent","click .daria-goto-anchor":"changeLinkHref","mousedown@show .daria-goto-anchor":"changeLinkHref","mousemove@show .daria-goto-anchor":"resetLinkHref","mouseleave@show .daria-goto-anchor":"resetLinkHref","daria:vMessageBody:showLocations@show":"showLocations","messages-thread.open-body":"onMessagesThreadOpenBody","click .js-attachments-switch-view":"onSwitchAttachmentsView","click .js-extracted-highlighted-address":"_onClickExtractedAddress","click .js-message-audio-play":"_onClickMessageAudioPlay","click .js-quote-expand":Daria.MessageProcess.Actions.quoteExpand,"click .js-quote-expand-all":Daria.MessageProcess.Actions.quoteExpandAll,"click .js-quote-maximize":Daria.MessageProcess.Actions.quoteMaximize,"click .js-quote-expand-toggle":Daria.MessageProcess.Actions.quoteExpandToggle,"click .js-mail-Quote-Toggler":"toggleQuote","submit .js-message-form":Daria.message.formWarning,'click [mailcollectorson="1"]':"collectorsRambler","resize@show window":"fireResizeBodyDebounce"},yateModule:"message",methods:{BODY_LOADING_TIMEOUT:200,MESSAGE_HEAD_HEIGHT:51,MESSAGE_TOOLBAR_HEIGHT:28,MAIL_TOOLBAR_HEIGHT:59,CLASS_MESSAGE_SCROLL_AREA:"js-message-scroll-area",_timerOpenLoader:0,_translating:!1,_onMessageMove:function(){delete this.forceShowImages,delete this.forceShowHrefs,this.invalidate()},_onNsViewAsync:function(){var e=this.$node;this._timerOpenLoader=setTimeout(function(){e.find(".js-body-loading").removeClass("g-hidden")},this.BODY_LOADING_TIMEOUT)},_onNsViewHtmlinit:function(e,t){clearTimeout(this._timerOpenLoader),this._timerOpenLoader=null;var s=this.getModel("message-body").getHTML(_.extend({},t,{forceShowImages:this.forceShowImages,forceShowHrefs:this.forceShowHrefs}));this.$node.append(s),ns.events.trigger("daria:vMessage:message-body-loaded");var n=this.$node.find("#message-attachments-"+t.ids);if(n.length){var i=this.$node.closest(".b-message"),a=i.find(".b-message-head"),o=this.attachments={blocks:{head:a.find(".b-message-head__field_attachments-expand"),body:n},shrinked:{head:!1,body:!1},view:{head:null,body:null}};this.attachments.buttons={head:a.find(".js-attachments-view"),body:o.blocks.body.find(".js-attachments-view")};this.$node.find(".b-file__actions").each(function(){var e=$(".b-mail-button_light",this);e.length>1&&(e.eq(0).addClass("b-mail-button_first"),e.slice(1,-1).addClass("b-mail-button_middle"),e.eq(-1).addClass("b-mail-button_last"))}),$.each(o.blocks,function(e,t){t.find(".js-attachments-view-btn").attr("data-params",function(t,s){return(s?s+"&":"")+"metrika=attach:"+e+":viewfile"}),t.find(".js-attachments-get-btn").attr("data-params",function(t,s){return(s?s+"&":"")+"metrika=attach:"+e+":loadfile"})}),o.blocks.head.length||(Jane.c("attach","onefile","show"),a.find(".js-attachments-view-btn").attr("data-params","metrika=attach:head:viewone"),a.find(".js-attachments-get-btn").attr("data-params","metrika=attach:head:loadone"))}Daria.MessageProcess.initQuotesByPage(this.node),this.waitForImages(t),this._timerColumnSizeRecalculate=setTimeout(function(){this._timerColumnSizeRecalculate=null,s&&this.getModel("message-body").getAttachments().length&&this.$node.closest(".js-message-wrap").find(".js-attachments-snippet").length&&Daria.MessageProcess.attachmentsSelect(s),ns.events.trigger("daria:vMessageThreadList:checkVisible"),this.fireResizeBodyDebounce()}.bind(this),300),this.showLocations()},initFixedScroll:function(){this._fixedScroll=this.$node.closest(".js-message-scroll-area").fixedScroll(this.$node),this._fixedScrollRecalc=_.debounce(this._fixedScroll.recalc.bind(this._fixedScroll),50),this.__bindFixedScrollEvents()},destroyFixedScroll:function(){this.__unbindFixedScrollEvents(),this._fixedScroll&&(this._fixedScroll.destroy(),this._fixedScroll=null,delete this._fixedScrollRecalc)},changeLinkHref:function(e){var t=e.currentTarget,s=t.getAttribute("data-vdir-href");s&&t.href!==s&&("click"===e.type||2===e.which||e.ctrlKey)&&(t.href=s);var n=t.href.replace(/^[^#]*(.*)$/,"$1");if(Daria.isInnerMailLinkHostname(t.hostname)&&n){var i=this.$node.find(n+', a[name="'+n.substr(1)+'"]')[0];if(i){var a=Daria.isMessagePage()?this.MAIL_TOOLBAR_HEIGHT:this.MESSAGE_HEAD_HEIGHT+this.MESSAGE_TOOLBAR_HEIGHT,o=Daria.isMessagePage()?window:this.$node.closest("."+this.CLASS_MESSAGE_SCROLL_AREA)[0];return Jane.DOM.placeInViewport(i,{top:a},{nodePositionBelow:"top",nodePositionAbove:"top"},o),!1}}return!0},resetLinkHref:function(e){var t=e.currentTarget,s=t.getAttribute("data-orig-href");s&&t.href!==s&&(t.href=s)},collectorsRambler:function(){if(-1!==this.getModel("message").type.indexOf(12))return ns.page.go("#setup/collectors"),!1},waitForImages:function(){var e=this.$node.find("img"),t=0,s=[],n=this;e.each(function(){s.push($.Deferred())}),e.one("load",function(){s[t++].resolve()}).one("error",function(){s[t++].reject();var e=this.src;e&&e.indexOf("cache.mail.yandex.net")>-1&&Jane.ErrorLog.send({event:"imgNotLoaded",src:e})}),$.when.apply($,s).then(function(){n.fireResizeBodyDebounce()})},__bindFixedScrollEvents:function(){!this._eventsBinded&&this._fixedScroll&&(this._eventsBinded=!0,$(window).on("resize.b-message-body",this._fixedScrollRecalc),ns.events.on("layout-ratio-change",this._fixedScrollRecalc))},__unbindFixedScrollEvents:function(){this._eventsBinded&&this._fixedScroll&&(this._eventsBinded=!1,$(window).off(".b-message-body"),ns.events.off("layout-ratio-change",this._fixedScrollRecalc))},_onNsViewShow:function(e,t,s){this.logTimings(s);try{this.sendOpenPGPEvent()}catch(e){Jane.ErrorLog.sendException("Daria.vMessageBody.sendOpenPGPEvent",e)}var n=this;this.attachments&&(Jane.c("attach","show"),this.switchAttachmentsViewEverywhere()),this.initFixedScroll();var i=this.getModel("message");if(Daria.is2pane()&&!i.hasLabelWithSymbolicName("seen_label")&&i.hasLabelWithSymbolicName("postmaster_label")){var a=_.debounce(function(){this.postmaster.scroll<window.scrollY&&(this.postmaster.scroll=window.scrollY)}.bind(this),50);$(window).on("scroll",a),this.postmaster={time:$.now(),scroll:window.scrollY,unload:function(){$(window).off("scroll",a),ns.events.off("ns-page-before-load",n.postmaster.unload);var e=n.$node;if(e){var t=e.offset().top,s=e.height(),i=n.postmaster.scroll-t+$(window).height(),o=i>s?100:Math.floor(i/s*100);o=o||0;var r=$.now()-n.postmaster.time;ns.forcedRequest(["do-postmaster"],{time:(n.getModel("message-body").get(".info.date.timestamp")||0)/1e3,readTime:Math.floor(r/1e3),perc:o,mid:n.params.ids,from:n.getModel("message").getFromEmail(),yandexuid:Daria.getCookie("yandexuid")})}}},ns.events.on("ns-page-before-load",this.postmaster.unload)}this.anyLocationsHighlighted&&Jane.c("Карты в письмах","Открыто писем с подсвеченным адресом"),this.fireResizeBodyDebounce()},_onNsViewHide:function(){this._timerOpenLoader&&(clearTimeout(this._timerOpenLoader),this._timerOpenLoader=null),this._timerColumnSizeRecalculate&&(clearTimeout(this._timerColumnSizeRecalculate),this._timerColumnSizeRecalculate=null),this.fireResizeBodyDebounce.cancel(),this._onMessageWidgetTranslateRevert(),this._onMessageWidgetTranslateResetVisibility(),Daria.message.audioPlayer.reset(),this.destroyFixedScroll(),this.sendHidePGPEvent()},_onNsViewHtmldestroy:function(){$("#att-buttons").appendTo($(".b-layout")).addClass("g-hidden")},onSwitchAttachmentsView:function(e){var t=e.currentTarget.getAttribute("data-where"),s=e.currentTarget.getAttribute("data-view");this.switchAttachmentsView(t,s),Jane.c("attach",t,s+"view")},onMessagesThreadOpenBody:function(){this.switchAttachmentsViewEverywhere()},switchAttachmentsViewEverywhere:function(){$.each(["head","body"],function(e,t){this.switchAttachmentsView(t)}.bind(this))},switchAttachmentsView:function(e,t){var s=this.attachments;if(s&&s.view[e]!==t){var n=s.buttons[e],i=s.blocks[e],a="attach-"+e+"-view",o=["icons","list"];t=t||Daria.getCookie(a),-1===$.inArray(t,o)&&(t=o[0]),s.view[e]=t,$.each(o,function(e,s){var a=t===s;n.find(".js-attachments-"+s).toggleClass("b-mail-button_light-selected",a);var o=i.find(".js-attachments-"+s+"-view").toggleClass("g-hidden",!a);a||o.find("object").attr("id",function(e,t){Daria.message.audioPlayer.playerAction(t,"close")})}),t===o[0]&&this.shrinkAttachmentsNames(e),Daria.setCookie(a,t,90)}"body"===e&&this.$node.find(".b-file__pic:visible").length&&Jane.c("Просмотрщик картинок","Показ превью")},shrinkAttachmentsNames:function(e){var t=this.attachments.shrinked;if(!t[e]){var s=this.attachments.blocks[e].find(".js-attachments-icons-view");s.is(":visible")&&(t[e]=!0,s.find(".b-shrinker").each(function(){var e=$(this),t=e.find(".b-shrinker__right").width();e.css("margin-right",t)}))}},_onMessageWidgetSpamShowContent:function(){this.forceShowImages=!0,this.forceShowHrefs=!0,this.invalidate(),this.update({is_spam:!1}).then(function(){Jane.c("Сообщение о непоказе картинок и ссылок в спаме","Клик по Включить")})},sendOpenPGPEvent:function(){var e=this.getModel("message-body"),t=this.params.ids;e.hasPGP()&&e.getPGP().then(function(e){window.postMessage({mid:t,data:e,type:"PGP_MESSAGE_SHOWN"},"*")})},sendHidePGPEvent:function(){window.postMessage({mid:this.params.ids,type:"PGP_MESSAGE_HIDDEN"},"*")},parseLocations:function(e,t){return _.map(e.find(".js-extracted-address").get(),function(e){var s=new Daria.message.Location($(e));return s.findParsedMetadata(t),s})},showLocations:function(){var e=this,t=this.$node,s=this.getModel("message-body").getLocations(),n=this.parseLocations(t,s),i=n.map(function(e){return{id:"map-data",params:{address:e.getAddress()}}}),a=this.getModel("message-body").getInvalidLocations(),o=s.concat(a),r=function(e){return e.geo&&e.geo.city},u=function(e){return e.addr&&e.addr.street},d=function(e,t){var s=_.filter(n,function(e){return t(e)}).length;s&&Jane.c("Карты в письмах","Города",e,s)};_.find(o,function(e){return r(e)&&!u(e)})&&Jane.c("Карты в письмах","Города","адреса, в которых город указан отдельно от улицы",_.filter(o,function(e){return!r(e)&&u(e)}).length),i.length>0?(Daria.Libs("Ya.Maps"),ns.request(i).then(function(){n.forEach(function(e){e.highlight()});var t=_.filter(n,function(e){return e.isHighlighted()}).length;Jane.c("Карты в письмах","Адреса","подсветили "+t,"томита прислала валидных "+s.length),d("Адреса с городом",function(e){return e.hasCity()}),d("Адреса, в которых есть улица, но не указан город",function(e){return e.hasStreet()&&!e.hasCity()}),d("Адреса, в которых есть улица, но не указан город, и они находятся в городе пользователя",function(e){return e.hasStreet()&&!e.hasCity()&&e.inUserArea()}),t>0&&(e.anyLocationsHighlighted=!0,Jane.c("Карты в письмах","Открыто писем с подсвеченным адресом"))})):s.length>0&&Jane.c("Карты в письмах","Адреса","подсветили 0","томита прислала валидных "+s.length)},_onClickMessageAudioPlay:function(e){Daria.message.audioPlayer.init(e),e.preventDefault()},_onClickExtractedAddress:function(e){var t=$(e.currentTarget),s=t.data("address"),n=t.data("ids");if(s&&n){ns.View.create("map-up",{address:s,ids:n}).open()}},_onMessageWidgetTranslateTranslate:function(e,t){if(!this._translating){this._translating=!0;var s=this.$node.html(),n=this.getModel("message").getSubject(),i=Date.now(),a=this,o=this.getModel("message-body");o.trigger("daria:vMessageBody:startTranslate"),Daria.Translate.translate(t.langFrom,t.langTo,[{value:n,format:"text"},{value:s,format:"html"}]).then(function(e){a._translating=!1;var r=a.params.ids;Jane.ErrorLog.send({event:"translate",duration:(Date.now()-i)/1e3,langs:t.langFrom+"-"+t.langTo,mid:r}),ns.events.trigger("daria:vMessageBody:setSubject",e[0]),a.$node.html(e[1]),Daria.Translate.getCache(r)||Daria.Translate.setCache(r,[n,s]),o.trigger("daria:vMessageBody:stopTranslate",!0)},function(){a._translating=!1,Daria.Dialog.notice({body:i18n("%Translate_Fail"),width:350}),Jane.ErrorLog.send({errorType:"translateError",mid:a.params.ids}),Jane.c(71105,"msg.click.error"),o.trigger("daria:vMessageBody:stopTranslate",!1)}),Jane.c(71105,"msg.click.go")}},_onMessageWidgetTranslateRevert:function(){var e=Daria.Translate.getCache(this.params.ids);e&&(ns.events.trigger("daria:vMessageBody:setSubject",e[0]),this.$node.html(e[1]),Daria.Translate.clearCache(this.params.ids)),Jane.c(71105,"msg.click.cancel"),this.getModel("message-body").trigger("daria:vMessageBody:revertTranslate")},_onMessageWidgetTranslateResetVisibility:function(){this.getModel("message-body").trigger("daria:vMessageBody:resetTranslateWidgetVisibility")},toggleQuote:function(e){Daria.MessageProcess.Actions.toggleQuote(e)},fireResizeBody:function(){if(this.node&&this.node.firstChild){var e=this.node.firstChild,t={scrollWidth:e.scrollWidth,clientWidth:e.clientWidth};ns.Model.get("thread-sidebar-state").set(".body",t),ns.events.trigger("message-body-full-load",this.$node.width())}},onThreadSidebarFlight:function(e,t){this.$node.children().css("margin-right",t||"")}}})},2095:function(e,t){ns.View.define("message-close-button",{yateModule:"message"})},2096:function(e,t){ns.View.define("message-head-date-eml",{models:{"message-body":{"ns-model-changed":!1,"ns-model-changed.info.date.view":"updateSelf"}},yateModule:"message",methods:{updateSelf:function(){this.invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})}}})},2097:function(e,t){ns.View.define("message-head-date",{models:{message:{"ns-model-changed":!1,"ns-model-changed.date.view":"forceUpdate"}},yateModule:"message"})},2098:function(e,t){ns.View.define("message-head-go-to-thread",{models:{message:!1},methods:{getGoToThreadLink:function(){var e=this.getModel("message"),t=e.getThreadId();return ns.router.generateUrl("messages",{current_folder:e.get(".fid"),thread_id:t})}},yateModule:"message"})},2099:function(e,t){ns.View.define("message-headline",{events:{"ns-view-touch":"_onTouch"},yateModule:"message",methods:{checkShow:function(){return Boolean(Daria.getPrevPageSearchContext())},_onTouch:function(){var e=Daria.getPrevPageSearchContext(),t="";e&&(e.request&&(t+=i18n("%Message_Headline_Query",e.url,_.escape(e.request))+" "),t+=i18n("%Message_Headline_Back_To_Search",e.url),this.$node.html(t))}}})},2100:function(e,t){ns.View.define("message-head-dkim",{params:{ids:null},models:{message:"keepValid","message-body":"keepValid"},events:{"ns-view-show":"onShow",click:"onClick"},yateModule:"message",methods:{getTitle:function(){switch(this.getModel("message").getTrustLevel()){case 1:return i18n("%TrustButtonTooltip_level_1");case 2:return i18n("%TrustButtonTooltip_level_2");case 3:return i18n("%TrustButtonTooltip_level_3",this.getSenderDomain());case 4:return i18n("%TrustButtonTooltip_level_4");case 5:return i18n("%TrustButtonTooltip_level_5");case 6:return i18n("%TrustButtonTooltip_level_6")}},getPopupContent:function(){return{collectorEmail:this.getCollectorEmail(),description:this.getDescription(),encryption:this.getEncryption(),senderDomain:this.getSenderDomain(),sign:this.getSign(),spam:this.getSpam()}},getCollectorEmail:function(){var e=this.getModel("message-body").get(".info.collectedRpopEmail");return e||(this.isCollected()?i18n("%CollectedEmail"):void 0)},getDescription:function(){switch(this.getModel("message").getTrustLevel()){case 1:return i18n("%TrustPopupDescription_level_1");case 2:return i18n("%TrustPopupDescription_level_2");case 3:return i18n("%TrustPopupDescription_level_3",this.getSenderDomain());case 4:return i18n("%TrustPopupDescription_level_4");case 5:return i18n("%TrustPopupDescription_level_5");case 6:return i18n("%TrustPopupDescription_level_6")}},getEncryption:function(){return this.getModel("message-body").get(".info.encrypted")?i18n("%Да"):i18n("%Нет")},isCollected:function(){return Boolean(this.getModel("message-body").get(".info.collectedRpopId"))},getSenderDomain:function(){return this.getModel("message-body").get(".info.senderDomain")},getSign:function(){var e=this.getModel("message-body").get(".info.dkimStatus"),t=this.getModel("message-body").get(".info.signedBy");return"string"==typeof e?"pass"===e?t:"fail"===e?i18n("%СhangedАfterSending"):i18n("%Нет"):t||i18n("%Нет")},getSpam:function(){return this.getModel("message-body").get(".info.isSpam")?i18n("%Да"):null},sendMetric:function(e){var t=this.getModel("message").getTrustLevel();Jane.c("Медальки (DKIM)","Медалька тип "+t,e)},onShow:function(){this.getModel("message").getTrustLevel()?this.sendMetric("Показ"):Jane.c("Медальки (DKIM)","Нет данных для показа")},onClick:function(e){e.preventDefault(),e.stopPropagation();var t=nb.find(this.key);t&&t.open({where:this.$node.find(".js-dkim-icon"),how:{at:"bottom",my:"top"}}),this.sendMetric("Клик в медальку (показ поп-апа)")}}})},2101:function(e,t){ns.View.define("message-head-eml",{events:{"click .js-mail-Message-Head-Recievers_more":"toggleMoreRecievers"},models:{message:!1,"message-head-state":!1,"message-body":!1},params:function(e){return e},yateModule:"message",methods:{toggleMoreRecievers:function(){var e,t=this.$node.find(".js-mail-Message-Head-Recievers");e=t.hasClass("with-tooManyRecipients")?t.hasClass("is-folded"):this.getModel("message-head-state").toggleRecieversOpened(),t.toggleClass("is-folded",!e)}}})},2102:function(e,t){ns.View.define("message-head-folder",{params:{ids:null},models:{message:{"ns-model-changed":"keepValid","ns-model-changed.fid":"forceUpdate"}},yateModule:"message",methods:{_viewCheckHide:function(){var e=ns.page.current.params||{},t=e.current_folder;if(!t)return!0;var s=this.getModel("message").getFolderId();return!s||t===s}}})},2103:function(e,t){ns.View.define("message-head",{models:{folders:!1,settings:!1,"message-head-state":!1,message:!1},events:{"daria:vMessageBody:setSubject@show":"_onMessageBodySetSubject","click .js-toggle-message-head":"_onClickToggleMessageHead"},yateModule:"message",methods:{_viewSenderFolded:function(){return this.getModel("message-head-state").get(".sender-closed")},_onClickToggleMessageHead:function(){var e=this.getModel("message-head-state").toggleSenderOpened();this.$node.toggleClass("is-folded",e)},_onMessageBodySetSubject:function(e,t){this.$node.find(".js-subject-content").text(t)},_onReadUnreadMessage:function(){this.getModel("message").toggleMark()},_selfUpdate:function(){this.update()},onAttachesWidgetShow:function(){this.$node.addClass("mail-Message-Head_with-attachments")}}})},2104:function(e,t){ns.View.define("message-head-labels",{models:{message:{"ns-model-changed":!1,"ns-model-changed.lid":"forceUpdate"}},yateModule:"message"})},2105:function(e,t){ns.View.define("message-head-recipient-count",{events:{"ns-view-htmlinit":"_checkCorpMaillists",click:"toggleMoreRecievers"},models:{message:!1,"message-body":!1,"message-head-state":!1},yateModule:"message",methods:{toggleMoreRecievers:function(){this.getModel("message-head-state").toggleRecieversOpened()},patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("message"),s=this.getModel("message-body"),n=s.isValid()?s:t;return e.isRecipient=n.isRecipient(),e},_maillistsCount:-1,getMaillistsCount:function(){return this._maillistsCount},_checkCorpMaillists:function(){if(-1===this._maillistsCount){var e=this.getModel("message-body"),t=_(e.getRecipients(!0,!0)).values().flatten().pluck("email").compact().uniq().value(),s=t.slice(0,35);ns.request("abook-contacts",{emails:s.join(",")});var n=this;if(Daria.IS_CORP){var i=t.filter(Daria.email.isCorp);i.length&&ns.Model.get("get-maillists-static").getMaillists(i).then(function(e){n.setMaillists(e),n.forceUpdate()})}}},setMaillists:function(e){this._maillistsCount=e.length}}})},2106:function(e,t){ns.View.define("message-head-recipient",{params:function(e){return e},models:{message:!1,"message-body":!1,"message-head-state":{"ns-model-changed":!1,"ns-model-changed.recievers-opened":"onRecieversOpenedToggled"},settings:!1},events:{"ns-view-show":"onViewShow","ns-view-hide":"onViewHide","click .js-contact-actions-dropdown":"_onClickContactActionsDropdown","click .js-mail-Message-Head-Recievers_more":"toggleMoreRecievers"},yateModule:"message",ctor:function(){this.onCopyEmails=this.onCopyEmails.bind(this)},methods:{onViewShow:function(){this.$node.on("copy",this.onCopyEmails),this.getModel("message-body").hasTooManyRecipients()&&this.getModel("message-head-state").setRecieversOpened(!1)},onViewHide:function(){this.$node.off("copy",this.onCopyEmails)},toggleMoreRecievers:function(){this.getModel("message-head-state").toggleRecieversOpened()},onRecieversOpenedToggled:function(){var e=!this.getModel("message-head-state").getRecieversOpened();this.$node.toggleClass("is-folded",e)},_dropdownTarget:null,_onClickContactActionsDropdown:function(e){var t=e.currentTarget;if(t!==this._dropdownTarget){var s=ns.parseQuery($(t).data("params")),n=ns.View.create("contact-actions",s);this._dropdownTarget=t,n.on("ns-view-destroyed",function(){t===this._dropdownTarget&&(this._dropdownTarget=null)}.bind(this)),n.open({where:t,how:{autoclose:!0,at:"center bottom",my:"center top"}})}},onCopyEmails:function(e){e.stopPropagation(),e.preventDefault();var t=window.getSelection(),s=t.getRangeAt(0),n=$(s.startContainer),i=$(s.endContainer),a=n.closest(".js-email").data("index"),o=n.hasClass(".js-email")?n.data("index"):a,r="number"==typeof o,u=r?o:0,d=i.closest(".js-email").data("index"),l=i.hasClass(".js-email")?i.data("index"):d,c="number"==typeof l,h=this.$node.find("[data-email]").length-1,g=c?l:h;c&&0===i.closest(".js-user-name").length&&g>u&&g--;var m=this.extractEmails(u,g);this.copyTextToClipboardAndResetSelection(m,t,s)},extractEmails:function(e,t){return this.$node.find(".js-email").filter(function(s){return s>=e&&s<=t}).map(function(e,t){return $(t).data("email")}).toArray().join(", ")},copyTextToClipboardAndResetSelection:function(e,t,s){var n=document.createElement("textarea");n.className="mail-Message-Head-Recievers-TempTextarea",n.value=e,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(n),t.removeAllRanges(),t.addRange(s)}}})},2107:function(e,t){ns.View.define("message-head-sender-info",{params:function(e){var t=ns.Model.get("message",{ids:e.ids}),s=t.getEmailInfoParams()||{};return{email:s.email,ref:s.ref,ids:e.ids}},models:{message:!1,"email-info":!0,settings:!1},events:{"ns-view-htmlinit":"_onInit","click .js-social-button":"_onClickSocialButton","click .js-call-staff":"_onClickCallStaff"},yateModule:"message",methods:{CLASS_PHONE_DISABLED:"is-disabled",TIME_PHONE_DISABLED:5e3,_onInit:function(){this.$node.children().length&&this.$node.closest(".mail-Message-Head-Content").find(".js-toggle-message-head").addClass("mail-ui-HoverLink")},_onClickCallStaff:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget);if(!t.hasClass(this.CLASS_PHONE_DISABLED)){var s=this.getModel("email-info").get(".staff.phones.work"),n=this;s&&((new Image).src=Daria.Config["staff-host"]+"/api/call/"+encodeURIComponent(s)),t.addClass(this.CLASS_PHONE_DISABLED),_.delay(function(){t.removeClass(n.CLASS_PHONE_DISABLED)},this.TIME_PHONE_DISABLED)}},_onClickSocialButton:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).closest(".nb-button");if("enable-social"===t.data("value"))this.getModel("settings").setSettingOn("show_socnet_avatars");else{var s=t.find("a"),n=window.open(s.attr("href"),s.attr("target"));n&&n.focus()}}}})},2108:function(e,t){var s=["startrek","wiki"];ns.View.define("message-head-sender-name",{models:{message:!1},events:{click:"showPersonPopup"},yateModule:"message",methods:{isCorpService:function(){var e=this.getAbookContactParams(),t=Daria.email.getLogin(e.email||"");return-1!==s.indexOf(t)},showPersonPopup:function(){if(this.vPopup&&this.vPopup.isValid())return this.vPopup.close(),void(this.vPopup=null);Daria.IS_CORP&&this.isCorpService()||Jane.Services.run("#contacts",function(){this.vPopup=ns.View.create("abook-person-popup");var e=this.getAbookContactParams();ns.request("abook-contact",{email:e.email}).then(function(t){var s=t[0],n=s.get(".cid");n&&(e.cid=n),this.vPopup.open(this.getPopupOptions(),e)},function(){this.vPopup.open(this.getPopupOptions(),e)},this),Daria.vAbook.Metrika.c("Карточка контакта","В Почте","показ карточки (клик на имейл)")}.bind(this))},getAbookContactParams:function(){var e=this.getFieldFrom()||{};return _.extend({email:e.email,ref:e.ref},this.params)},getFieldFrom:function(){return this.getModel("message").getFieldsByType("from")[0]},getPopupOptions:function(){return Daria.is2pane()?{where:this.$node,how:{my:"left top",at:"left-52 top"}}:{where:$(window),how:{my:"center",at:"center"}}}}})},2109:function(e,t){ns.View.define("message-head-sender-name-eml",{events:{click:"showPersonPopup"},models:{"message-body":!1},yateModule:"message",methods:{getFieldFrom:function(){return this.getModel("message-body").getFieldsByType("from")[0]}}},"message-head-sender-name")},2110:function(e,t){ns.View.define("message-head-sender-wrap",{models:{folders:!1,message:!1,settings:{"ns-model-changed":!1,"ns-model-changed.show_socnet_avatars":"forceUpdate"}},yateModule:"message",methods:{patchLayout:function(){return this._patchLayoutCheckSenderInfo()?"message-head-sender-info":"message-head-sender-empty"},_patchLayoutCheckSenderInfo:function(){var e=this.getModel("message");return!!e.isValid()&&(!e.hasSocialLabels()&&(!this.getModel("folders").isFolder(e.getFolderId(),["spam","trash"])&&(!!this.getModel("settings").isSet("show_avatars")&&!!e.getEmailInfoParams())))}}})},2111:function(e,t){ns.View.edefine("message-head-subject-eml",{events:{"daria:vApp:changeAppWidth@show":"onShow","click .js-toggle-title":"_onClickToggleTitle"},models:{message:!1},params:function(e){return e},yateModule:"message",methods:{onShow:function(){this._toggleTitleToggler()},CLASS_LONG_TITLE:"mail-Message-Toolbar_longTitle",_onClickToggleTitle:function(){return this.$node.find(".js-thread-toolbar").toggleClass("is-folded"),!1},_toggleTitleToggler:function(){var e=this.$node,t=e.find(".js-thread-toolbar");if(t.hasClass("is-folded")){var s=e.find(".js-toolbar-subject")[0],n=s.scrollWidth,i=!n||s.offsetWidth>=n-1;i&&t.addClass("is-folded"),t.toggleClass(this.CLASS_LONG_TITLE,!i)}}}})},2112:function(e,t){ns.View.edefine("message-head-subject",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmlinit":"onInit","resize@show window":"_toggleTitleTogglerLazy","mouseenter .js-toolbar-subject":"onHoverSubjectOn","mouseleave .js-toolbar-subject":"onHoverSubjectOff"},ctor:function(){this._toggleTitleTogglerLazy=_.throttle(this._toggleTitleToggler.bind(this),20),this.recalculateHeaderFixedState=_.throttle(this.recalculateHeaderFixedState.bind(this),20,{trailing:!0,leading:!0})},models:{message:{"ns-model-changed":!1,"ns-model-changed.subject":"invalidate","ns-model-changed.subject_prefix":"invalidate"},settings:{"ns-model-changed":"keepValid","ns-model-changed.liza_minified":"lazyFixedRecalc","ns-model-changed.liza_minified_header":"lazyFixedRecalc"},"scroller-message":!1},yateModule:"message",methods:{CLASS_LONG_TITLE:"mail-Message-Toolbar_longTitle",onInit:function(){this._$toolbar=this.$node.find(".js-thread-toolbar"),this._$toolbarSubject=this.$node.find(".js-toolbar-subject")},onHoverSubjectOn:function(){this.$node.find(".js-mail-Message-Toolbar").addClass("with-subject-hovered")},onHoverSubjectOff:function(){this.$node.find(".js-mail-Message-Toolbar").removeClass("with-subject-hovered")},_toggleTitleToggler:function(){var e=this.initialHeight||this._$toolbarSubject[0].offsetHeight,t=this._$toolbarSubject[0].scrollHeight<=e;t||this.initialHeight||(this.initialHeight=this._$toolbarSubject[0].offsetHeight),this._$toolbarSubject.css("max-height",t?"":this._$toolbarSubject[0].scrollHeight),this._$toolbar.toggleClass(this.CLASS_LONG_TITLE,!t)},onShow:function(){this.onShowMarkAsRead(),this.fixedElementStart(),this._toggleTitleToggler()},onHide:function(){this.fixedElementStop(),this.recalculateHeaderFixedState.cancel(),this._toggleTitleTogglerLazy.cancel()},onShowMarkAsRead:function(){var e=this.getModel("message"),t=ns.Model.get("messages-checked",{mid:e.get(".mid")});t.check(e,!0),Daria.MOPS.updateHelper("mark",t,{})}}},"fixed-element-in-message-mixin")},2113:function(e,t){ns.View.define("message-toolbar-fake",{params:{ids:null},yateModule:"message"})},2114:function(e,t){ns.View.define("message-toolbar",{params:{ids:null},models:{"message-toolbar":!0,message:!1,settings:!1},events:{"ns-view-show":"onShow","click .js-toolbar-item-reply":"_onReplyToolbarButton","click .js-toolbar-item-reply-all":"_onReplyAllToolbarButton","click .js-toolbar-item-forward":"_onForwardToolbarButton","click .js-toolbar-item-delete":"_onRemoveToolbarButton","click .js-toolbar-item-spam":"_onTospamToolbarButton","click .js-toolbar-item-not-spam":"_onNotspamToolbarButton","click .js-toolbar-item-unsubscribe":"_onUnsubscribeToolbarButton","click .js-toolbar-item-archive":"_onArchiveToolbarButton","click .js-toolbar-item-draft-finish":"_onDraftFinishToolbarButton","click .js-toolbar-item-labels-actions":"_openLabelsDropdown","click .js-toolbar-item-folders-actions":"_openFoldersDropdown","click .js-toolbar-item-pin":"_onPinToolbarButton","click .js-toolbar-item-unpin":"_onUnpinToolbarButton","click .js-toolbar-item-more":"_onMoreToolbarButton","daria:vMessageToolbar:reply":"onReplyHotkey"},yateModule:"message",methods:{onShow:function(){ns.events.atrigger("daria:vMessageToolbar:toolbar-didRendered")},_onReplyToolbarButton:function(){Jane.ToolbarMetric.messageToolbar("ответить"),this.showQuickReply(!1),this.closePopup()},_onReplyAllToolbarButton:function(){Jane.ToolbarMetric.messageToolbar("ответить всем"),this.showQuickReply(!0),this.closePopup()},_onDraftFinishToolbarButton:function(){ns.page.go(ns.router.generateUrl("compose2",{ids:this.params.ids}))},_onLabelToolbarButton:function(e,t){return this._onToolbarButton("label",t)},_onUnlabelToolbarButton:function(e,t){return this._onToolbarButton("unlabel",t)},_onMoveToolbarButton:function(e,t){return this._onToolbarButton("move",t)},_onRemoveToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("удалить"),this._onToolbarButton("remove",{ignoreUnsavedDraft:!0})},_onTospamToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("спам"),this._onToolbarButton("tospam")},_onNotspamToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("не спам"),this._onToolbarButton("notspam")},_onUnsubscribeToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("отписаться"),this._onToolbarButton("unsubscribe")},_onArchiveToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("архивировать"),this._onToolbarButton("archive")},_onPinToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("закрепить"),this._onToolbarButton("pin")},_onUnpinToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("открепить"),this._onToolbarButton("unpin")},_onToolbarButton:function(e,t){t=t||{},Daria.DEBUG&&console.log(e),this.closePopup();var s=t.mMessagesChecked||this.getMessagesCheckedInstance();return Daria.MOPS[e](s,t)},getMessagesCheckedInstance:function(){return this._mMessagesChecked=ns.Model.get("messages-checked",{mid:this.params.ids}).checkByMidInParams(),this._mMessagesChecked},_openLabelsDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"label",this.getModel("message")),this._openDropdown("labels",e)},_openFoldersDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"move",this.getModel("message")),this._openDropdown("folders",e)},_openDropdown:function(e,t){var s=$(t.currentTarget);if(!s.hasClass("js-open-dropdown")){var n=ns.View.create(e+"-actions"),i=ns.Model.get("messages-checked",{mid:this.params.ids}).checkByMidInParams();n.open(t.currentTarget,i,{isInDropdown:!0,isInMore:!0}).then(function(){s.addClass("js-open-dropdown"),n.nbPopup.on("nb-closed",function(){s.removeClass("js-open-dropdown")})})}},_onMoreToolbarButton:function(e){if(this.vPopup&&this.vPopup.isValid())return this.vPopup.closePopup(),void(this.vPopup=null);this.vPopup=ns.View.create("message-toolbar-popup",this.params),this.vPopup.open({where:e.currentTarget})},closePopup:function(){this.vPopup&&this.vPopup.closePopup()}}},"message-actions")},2115:function(e,t){ns.View.edefine("message-toolbar-popup",{params:{ids:null},models:{"message-toolbar":!0,"message-body":!0,message:!0},events:{"click .js-toolbar-item-reply":"_onReplyToolbarButton","click .js-toolbar-item-reply-all":"_onReplyAllToolbarButton","click .js-toolbar-item-forward":"_onForwardToolbarButton","click .js-toolbar-item-delete":"_onRemoveToolbarButton","click .js-toolbar-item-spam":"_onTospamToolbarButton","click .js-toolbar-item-not-spam":"_onNotspamToolbarButton","click .js-toolbar-item-unsubscribe":"_onUnsubscribeToolbarButton","click .js-toolbar-item-archive":"_onArchiveToolbarButton","click .js-toolbar-item-draft-finish":"_onDraftFinishToolbarButton","click .js-toolbar-item-labels-actions":"_openLabelsDropdown","click .js-toolbar-item-folders-actions":"_openFoldersDropdown","click .js-toolbar-item-pin":"_onPinToolbarButton","click .js-toolbar-item-unpin":"_onUnpinToolbarButton","click .js-toolbar-item-message-properties":"_onClickMessageProperties","click .js-toolbar-item-filters-create":"_onClickFiltersCreate","click .js-kbd-print":"_onPrintToolbarButton"},yateModule:"message",methods:{open:function(e){this.update({},{execFlag:ns.U.EXEC.PARALLEL}).then(function(){this.nbPopup=nb.block(this.node),this.nbPopup.open(e),this.nbPopup.on("nb-closed",this.destroySelf.bind(this))},this)},closePopup:function(){this.nbPopup&&this.nbPopup.close()},_onClickMessageProperties:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"message-source",this.getModel("message")),this.closePopup()},destroySelf:function(){var e=this;_.defer(function(){e.nbPopup&&(e.nbPopup.destroy(),e.nbPopup=null),e.destroy()})},_onPrintToolbarButton:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"print",this.getModel("message"))},_onClickFiltersCreate:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"filters-create",this.getModel("message"))}}},"message-toolbar")},2116:function(e,t){ns.View.define("message-widget-common",{methods:{_onNsViewDestroyed:function(){this.destroyed||this.getModel("message-widget-state").setViewUserClose(this.id)}}})},2117:function(e,t){ns.View.define("message-widget-download-full",{params:{ids:null},models:{"message-body":!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","ns-view-destroyed":"_onNsViewDestroyed"},yateModule:"message",methods:{_onNsViewShow:function(){Jane.c("Скачать письмо целиком","показ"),Jane.ErrorLog.send({event:"message.trimmed",stid:this.getModel("message-body").getSTID()})}}},"message-widget-common")},2118:function(e,t){ns.View.define("message-widget-ignore-thread",{params:{ids:null},models:{settings:!1,message:!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","ns-view-destroyed":"_onNsViewDestroyed","click .js-unignore":"_onClickUnignore"},yateModule:"message",methods:{_onNsViewShow:function(){Jane.c("Статуслайн игнорирования треда","Показ в письме")},_onClickUnignore:function(){var e=this.getModel("message").getThreadId();Daria.MOPS.unignore({tids:e}),this.destroy()}}},"message-widget-common")},2119:function(e,t){ns.View.define("message-widget-imap-deleted",{params:{ids:null},models:{settings:!1,"message-widget-state":!1},events:{"ns-view-destroyed":"_onNsViewDestroyed","click .js-close":"_onClickClose"},yateModule:"message",methods:{_onClickClose:function(){this.getModel("settings").setSettingOn("hide-imap-deleted"),this.destroy()}}},"message-widget-common")},2120:function(e,t){ns.View.define("message-widget-noreply",{params:{ids:null},models:{message:!1,labels:!1,"message-widget-state":!1},events:{"ns-view-destroyed":"_onNsViewDestroyed","click .js-stop-waitreply":"_onClickStopWaitreply"},yateModule:"message",methods:{_onClickStopWaitreply:function(){var e=this.getModel("labels").getWaitingForReplyLabel(),t=e&&e.lid;t&&ns.events.trigger("daria:vToolbarButton:unlabel",{lid:t}),this.destroy()}}},"message-widget-common")},2121:function(e,t){ns.View.define("message-widget-translate",{params:{ids:null},models:{message:!1,"message-body":{"ns-model-changed":!1,"daria:vMessageBody:startTranslate":"onMessageBodyStartTranslate","daria:vMessageBody:stopTranslate":"onMessageBodyStopTranslate","daria:vMessageBody:revertTranslate":"onMessageBodyRevertTranslate","daria:vMessageBody:resetTranslateWidgetVisibility":"onMessageBodyResetWidgetVisibility"},"message-widget-state":!1,"translate-langs":!1},events:{"ns-view-show":"onShow","ns-view-destroyed":"_onNsViewDestroyed","click .js-open-translate-menu":"onClickOpenTranslateMenu","click .js-translate":"onClickTranslate","click .js-revert":"onClickRevert","click .js-reply-using-translator":"onReplyUsingTranslator","click .js-send-help-click-metric":"sendHelpClickMetric","click .js-close":"onClickClose"},yateModule:"message",ctor:function(){this._langTo=null,this._langFrom=null,this._isLoaded=!1,this._isTranslated=!1},methods:{onShow:function(){this.sendMetric("Показ")},getLangFromDefault:function(){return Daria.Translate.getLangByMid(this.params.ids)||Daria.Translate.defineLanguage(this.getModel("message-body").getComposeHTML())},getLangFrom:function(){return this._langFrom||this.getLangFromDefault()},getLangTo:function(){return this._langTo||Daria.Translate.getDefaultLangTo(this.getLangFrom())},isLoaded:function(){return this._isLoaded},isTranslated:function(){return this._isTranslated},onClickOpenTranslateMenu:function(e){var t=this,s=ns.parseQuery($(e.currentTarget).data("params")),n=s.dir,i="_popupTranslateSelectLang_"+n,a=this[i],o="to"===n?'Клик на "Перевести на"':'Клик на "Язык письма"';if(a)return void a.close();t.sendMetric(o,"Открытие попапа"),a=ns.View.create("translate-select-lang",{currentLang:s.lang}),a.on("selected",function(e,s){if(this.close(),"to"===n){var i=t.getLangTo();t.getLangFrom()===s&&(t._langFrom=i),t.sendMetric(o,i+" -> "+s),t._langTo=s}else{var a=t.getLangFrom();t.getLangTo()===s&&(t._langTo=a),t.sendMetric(o,a+" -> "+s),t._langFrom=s}t.forceUpdate()}),a.on("closed",function(){delete t[i]}),a.open({where:e.currentTarget}),this[i]=a,Jane.c(71105,"msg.click.select"+n)},onClickTranslate:function(){this.getModel("message-body").trigger("daria:vMessageWidgetTranslate:translate",{langFrom:this.getLangFrom(),langTo:this.getLangTo()}),this.sendMetric('Клик на "Перевести"',this.getLangFrom()+" -> "+this.getLangTo())},onClickRevert:function(){this.getModel("message-body").trigger("daria:vMessageWidgetTranslate:revert"),this.sendMetric('Клик на "Вернуть"')},onReplyUsingTranslator:function(){this.sendMetric('Клик на "Ответить с переводчиком"')},sendHelpClickMetric:function(){this.sendMetric('Клик на "i"')},onMessageBodyStartTranslate:function(){this._isLoaded=!0,this.forceUpdate()},onMessageBodyStopTranslate:function(e,t){this._isTranslated=t,this._isLoaded=!1,this.forceUpdate()},onMessageBodyRevertTranslate:function(){this._isTranslated&&(this._isTranslated=!1,this._isLoaded=!1,this.forceUpdate())},onMessageBodyResetWidgetVisibility:function(){this.getModel("message-widget-state").resetViewUserClose(this.id)},onClickClose:function(){this.getModel("message-widget-state").setViewUserClose(this.id),this.sendMetric("Клик на крестик"),Jane.c(71105,"msg.click.close")},sendMetric:function(){for(var e,t=arguments.length,s=Array(t),n=0;n<t;n++)s[n]=arguments[n];(e=Jane).c.apply(e,["Просмотр письма","Плашка переводчика",Daria.is2pane()?"2pane":"3pane"].concat(s))}}},"message-widget-common")},2122:function(e,t){ns.View.define("message-widget-spam",{params:{ids:null},models:{message:!1,"message-body":!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","click .js-show-content":"_onClickShowContent","click .js-delete":"_onClickDelete"},yateModule:"message",methods:{patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("message-body");return e.isPhishing=this._checkPhishing(),e.hasImg=t.get(".has-img"),e.hasLinks=t.get(".has-links"),e},_checkPhishing:function(){return this.getModel("message-body").hasPhishingBody()},_onNsViewShow:function(){this._checkPhishing()&&Jane.c("Просмотр письма","показ плашки про фишинг")},_onClickDelete:function(){ns.events.trigger("daria:vToolbarButton:remove"),this.getModel("message-widget-state").setViewUserClose(this.id)},_onClickShowContent:function(){ns.events.trigger("daria:vMessageWidgetSpam:showContent"),this.getModel("message-widget-state").setViewUserClose(this.id)}}})},2123:function(e,t){ns.ViewCollection.define("message-widget",{params:{ids:null},models:{message:!1,"message-body":!1,"message-widget-list":!1,"message-widget-state":{"ns-model-changed":!1,"ns-model-changed.show":"onChangeStateShow"}},events:{"ns-view-show":"onShow"},split:{byModel:"message-widget-list",intoViews:function(e){return e.get(".type")}},yateModule:"message",methods:{onShow:function(){this.updateListOfWidgets()},onChangeStateShow:function(){this.updateListOfWidgets()},updateListOfWidgets:function(){var e=this.getModel("message-widget-list");e.clear(),Daria.MessageWidget.creatingListOfWidgets(e),_.defer(function(){this.isVisible()&&this.update(this.params,{execFlag:ns.U.EXEC.PARALLEL})}.bind(this))}}})},2124:function(e,t){ns.View.define("no-message",{events:{"ns-view-hide":"onhide","ns-view-show":"onshow","click .js-goto-inbox":"onClick"},yateModule:"message",methods:{onhide:function(){$(".ns-view-app").removeClass("g-hidden").append(this.node)},onshow:function(){ns.Model.invalidate("message"),ns.Model.invalidate("messages"),ns.Model.invalidate("messages-item-state"),$(".ns-view-app").addClass("g-hidden").before(this.node),Jane.c({"Переход к недоступному письму":"Показ плашки"}),Jane.ErrorLog.send({errorType:"no_such_message",pageType:ns.page.current.page||"",pageReferrer:Daria.Page.referrer||"",pagePrevious:ns.page.history.getPrevious()||"",params:Daria.Page.params2query(ns.page.current.params)})},onClick:function(){Jane.c({"Переход к недоступному письму":"клик по 'Вернуться в почту'"})}}})},2125:function(e,t){ns.View.define("message-fake-list",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmldestroy":"onHtmlDestroy"},models:{message:!1},params:function(e){return{ids:e.thread_id||e.ids}},ctor:function(){this.forceUpdate=_.debounce(this.forceUpdate.bind(this),50)},yateModule:"message",methods:{onShow:function(){this.getMessages().on("ns-model-insert",this.forceUpdate)},onHide:function(){this.getMessages().off("ns-model-insert",this.forceUpdate)},onHtmlDestroy:function(){this.$node.children().each(this._childrenIterate)},getMessages:function(){var e=this.getModel("message").getThreadId();return ns.Model.get("messages",{thread_id:e})},_childrenIterate:function(){this._nsView?this._nsView.destroy():$(this).remove()}}})},2126:function(e,t){Daria.InfiniteViewCollection=function(){},no.inherit(Daria.InfiniteViewCollection,ns.ViewCollection,{fillList:function(){!this.__lockLoadMore&&this.canLoadMore()&&this.isVisible()&&(this.node.scrollHeight-this.node.offsetHeight>44||(this.__lockLoadMore=!0,_.method("loadMoreStart")(this),this.loadMore().then(function(){return this.update()},this).then(function(){this.setFullyLoadedStateIfNeeded(),this.__lockLoadMore=!1,_.method("loadMoreStop")(this)},this).then(function(){_.delay(this.fillList.bind(this),50)},this)))},loadMoreByScrolling:_.debounce(function(){!this.__lockLoadMore&&this.canLoadMore()&&(this.node.scrollHeight-this.node.scrollTop-this.node.clientHeight>54||(this.__lockLoadMore=!0,_.method("loadMoreStart")(this),this.loadMore().then(function(){return this.update()},this).then(function(){this.setFullyLoadedStateIfNeeded(),this.__lockLoadMore=!1,_.method("loadMoreStop")(this)},this)))},50),setFullyLoadedStateIfNeeded:function(){this.$node.toggleClass("mail-ThreadSidebar-Item-FullyLoaded",!this.canLoadMore())}})},2127:function(e,t){ns.View.define("thread-sidebar-wrap",{models:{message:!1,"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"onChangeFlightDebounce","ns-model-changed.update":"update"}},params:{ids:null},yateModule:"message",events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},ctor:function(){this.onChangeFlightDebounce=_.debounce(this.onChangeFlight.bind(this),0)},methods:{onShow:function(){if(this.checkShow()){var e=this.getModel("message"),t=e.getThreadId(),s=this.getMenuItems();ns.Model.get("thread-sidebar",{thread_id:t}).setData({items:s});var n=this.updateParams(),i=this.node.appendChild(this.node.ownerDocument.createElement("div"));this.vThreadSidebar=ns.View.create("thread-sidebar-box",n),this.vThreadSidebar._setNode(i),this.vThreadSidebar.invalidate(),this.vThreadSidebar.updateByLayout("layout-thread-sidebar",n,{execFlag:ns.U.EXEC.PARALLEL}).then(this.onChangeFlight,this)}},update:function(){this.vThreadSidebar&&this.vThreadSidebar.update(this.updateParams(),{execFlag:ns.U.EXEC.PARALLEL})},onHide:function(){this.onChangeFlightDebounce.cancel(),this.vThreadSidebar&&(this.vThreadSidebar.destroy(),this.vThreadSidebar=null)},updateParams:function(){var e=this.getModel("message");return{thread_id:e.getThreadId(),ids:this.params.ids,mid:e.get(".mid"),from:e.get('.field[.type=="from"].email')[0]}},checkShow:function(){return!this.getModel("message").inFolderBySymbol(["trash","spam"])},onChangeFlight:function(){var e=this.getModel("thread-sidebar-state"),t="";e.isFlight()&&(t=this.$node.closest(".js-message-wrap").find(".js-message-heads").height(),t-=1),this.$node.css("min-height",t),ns.events.trigger("daria:vApp:changeRightColumSize")},getMenuItems:function(){var e=this.getModel("message"),t=e.getThreadId(),s=[{id:1,layout:"layout-thread-sidebar-item-related",thread_id:t,title:i18n("%Thread_Sidebar_Related_Title"),metrika_onshow_title:"Показ Писем на тему",className:"qa-thread-sidebar-related"}];return e.hasSocialLabels()||s.push({id:2,layout:"layout-thread-sidebar-item-attachments",thread_id:t,title:i18n("%Thread_Sidebar_Attachments_Title"),metrika_onshow_title:"Показ Вложения",className:"qa-thread-sidebar-attachments"},{id:3,layout:"layout-thread-sidebar-item-links",thread_id:t,title:i18n("%Thread_Sidebar_Links_Title"),metrika_onshow_title:"Показ Ссылки",className:"qa-thread-sidebar-links"}),s.push({id:4,layout:"layout-thread-sidebar-item-same-author",thread_id:t,title:i18n("%Thread_Sidebar_Same_Author_Title",e.get('.field[.type=="from"].name')[0]),metrika_onshow_title:"Показ Письма от",className:"qa-thread-sidebar-same-author"}),s}}})},2128:function(e,t){ns.ViewCollection.define("thread-sidebar",{events:{"ns-page-before-load@show":"onPageBeforeLoad","ns-view-show":"toggleExpand"},models:{"thread-sidebar":!1,"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.activeItemId":"onStateChange","ns-model-changed.update":"onStateChange","ns-model-changed.flight":"toggleExpand"},settings:{"ns-model-changed":!1,"ns-model-changed.right_column_expanded":"toggleExpand"}},params:{thread_id:null,ids:null,mid:null,from:null},split:{byModel:"thread-sidebar",intoViews:"thread-sidebar-item"},yateModule:"message",methods:{isColumnFlight:function(){return this.getModel("thread-sidebar-state").isFlight()},toggleExpand:function(){var e=this.getModel("settings").getSign("right_column_expanded");this.$node.toggleClass("is-collapsed",this.isColumnFlight()&&!e)},onStateChange:function(){this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},onPageBeforeLoad:function(e,t){var s=this.getModel("thread-sidebar-state");_.get(t[0],".page")!==_.get(t[1],".page")?s.unsetActiveItem():s.trigger("daria:thread-sidebar:save-scroll-in-related")}}})},2129:function(e,t){ns.View.define("thread-sidebar-box",{events:{"ns-view-show":"onShow"},models:{"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"onChangeFlight","ns-model-changed.body":"checkFlight"}},yateModule:"message",methods:{onShow:function(){this.checkFlight(),this.getModel("thread-sidebar-state").metrikaCount("Показ")},onChangeFlight:function(){var e=this.getModel("thread-sidebar-state");this.$node.toggleClass("is-flight",e.isFlight()),this.getModel("thread-sidebar-state").metrikaCount("Показ")},checkFlight:function(){var e=this.getModel("thread-sidebar-state"),t=e.get(".body");if(!_.isEmpty(t)){var s=t.scrollWidth-t.clientWidth>20;s?ns.events.trigger("daria:vThreadSidebarBox:flight",this.$node.outerWidth(!0)):ns.events.trigger("daria:vThreadSidebarBox:flight",0),e.setIfChanged(".flight",s)}}}})},2130:function(e,t){ns.View.define("thread-sidebar-item",{models:{"thread-sidebar-item":!1,"thread-sidebar-state":!1},params:{thread_id:null,ids:null,mid:null,from:null,id:null},yateModule:"message",methods:{patchLayout:function(){return this.getModel("thread-sidebar-state").get(".activeItemId")===this.params.id?this.getModel("thread-sidebar-item").get(".layout"):"layout-thread-sidebar-item"}}})},2131:function(e,t){ns.View.define("thread-sidebar-item-save-scroll",{methods:{scrollInit:function(){ns.assert(this.getModel("thread-sidebar-state"),"Daria.vThreadSidebarItemSaveScroll","требует наличия модели thread-sidebar-state в зависимостях"),_.bindAll(this,["_saveScrollTopPosition"])},scrollStart:function(){var e=this.getModel("thread-sidebar-state");e.shouldScrollRelatedIntoView()?(e.disableScrollRelatedIntoViewFlag(),this._scrollCurrentLetterIntoView()):this._restoreScrollTopPosition(),this.getModel("thread-sidebar-state").on("daria:thread-sidebar:save-scroll-in-related",this._saveScrollTopPosition)},scrollStop:function(){this.getModel("thread-sidebar-state").off("daria:thread-sidebar:save-scroll-in-related",this._saveScrollTopPosition)},_saveScrollTopPosition:function(){this.getModel("thread-sidebar-state").set(".relatedScrollTop",this.$node.scrollTop(),{silent:!0})},_scrollCurrentLetterIntoView:function(){var e=this.$node.find(".mail-ThreadSidebar-List-Item.is-selected")[0];e&&(this.node.scrollTop=e.offsetTop-(this.node.offsetHeight-e.offsetHeight)/2)},_restoreScrollTopPosition:function(){var e=this.getModel("thread-sidebar-state");this.$node.scrollTop(e.get(".relatedScrollTop"))}}})},2132:function(e,t){ns.View.define("thread-sidebar-item-title",{events:{click:"toggleItem"},models:{"thread-sidebar-item":!1,"thread-sidebar-state":{"ns-model-changed":"keepValid","ns-model-changed.activeItemId":"onActiveChanged"}},params:{thread_id:null,id:null},yateModule:"message",methods:{toggleItem:function(){var e=this.getModel("thread-sidebar-state"),t=this.getModel("thread-sidebar-item");e.toggleItem(t.getId())&&e.metrikaBlockCount(t.get(".metrika_onshow_title"))},onActiveChanged:function(){var e=this.getModel("thread-sidebar-state"),t=this.getModel("thread-sidebar-item");this.$node.toggleClass("mail-ThreadSidebar-Item_title_active",e.isActive(t.getId()))}}})},2133:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-related",{models:{messages:!1,"thread-sidebar-state":!1},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},params:function(e){return{thread_id:e.thread_id,prevent_update:!0}},split:{byModel:"messages",intoViews:"thread-sidebar-item-related-item"},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart(),this.fillList()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages").canLoadMore()},loadMore:function(){return this.getModel("messages").loadMore()}}},"async-view-loading-fix-mixin","thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},2134:function(e,t){ns.View.define("thread-sidebar-item-related-item",{models:{message:{"ns-model-changed":!1,"ns-model-changed.date.view":"onDateChange"}},yateModule:"message",methods:{onDateChange:function(){this.invalidate(),ns.Model.get("thread-sidebar-state").triggerUpdateDebounce()}}})},2135:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-attachments",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},models:{"thread-attachments":!0,"thread-sidebar-state":!1},split:{byModel:"thread-attachments",intoViews:"thread-sidebar-item-attachments-item"},params:{thread_id:null},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("thread-attachments").canLoadMore()},loadMore:function(){return this.getModel("thread-attachments").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},2136:function(e,t){ns.View.defineNg("thread-sidebar-item-attachments-item",{models:{"thread-attachments-item":!0},events:{"click .js-image-preview":"previewImage","click .js-docviewer-preview":"onDocviewerPreviewClick","click .js-download-attach":"attachmentDownloadMetrika"},params:{"url-key":null},yateModule:"message",methods:{attachmentDownloadMetrika:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Скачивание вложения"])},onDocviewerPreviewClick:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Показ вложения"])},previewImage:function(e){var t=Daria.parseQuery($(e.currentTarget).data("params")),s=t.mid||this.params.ids,n=t.hid,i=this.params.hid;Daria.ImageViewer.open("",s,n,i),Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Показ вложения"]),e.preventDefault()},countSaveToDisk:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Сохранить на Диск"])}}},"save-to-disk-mixin","count-attachments-ops-mixin",ns.View)},2137:function(e,t){ns.View.define("thread-sidebar-item-link",{models:{"messages-thread-link":!0},yateModule:"message"})},2138:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-links",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},models:{"messages-thread-links":!1,"thread-sidebar-state":!1},split:{byModel:"messages-thread-links",intoViews:"thread-sidebar-item-link"},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages-thread-links").canLoadMore()},loadMore:function(){return this.getModel("messages-thread-links").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},2139:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-same-author",{models:{"messages-from":!1,"thread-sidebar-state":!1},yateModule:"message",split:{byModel:"messages-from",intoViews:"thread-sidebar-item-same-author-item"},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages-from").canLoadMore()},loadMore:function(){return this.getModel("messages-from").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},2140:function(e,t){ns.View.define("thread-sidebar-item-same-author-item",{models:{"messages-from-item":{"ns-model-changed":!1,"ns-model-changed.date.view":"onDateChange"},message:!1},yateModule:"message",methods:{onDateChange:function(){this.invalidate(),ns.Model.get("thread-sidebar-state").triggerUpdateDebounce()}}})},2141:function(e,t){ns.View.define("thread-sidebar-expand-button",{events:{"click@show":"onClick"},yateModule:"message",models:{"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"_update"},settings:{"ns-model-changed":!1,"ns-model-changed.right_column_expanded":"_update"}},methods:{_update:function(){this.invalidate(),this.getModel("thread-sidebar-state").triggerUpdate()},onClick:function(){var e=this.getModel("settings").getSign("right_column_expanded"),t=e?'Клик в "Свернуть"':'Клик в "Развернуть"';Jane.c("Правая колонка","Плавающая правая колонка",t),this.getModel("settings").setSettings({right_column_expanded:!e})}}})},2142:function(e,t){ns.View.define("message-prevnext",{events:{"daria:vMessagePrevNextInMessage:changeMessage@show":"onChangeMessage","ns-view-show":"onShow","ns-view-hide":"onHide"},models:{"message-nearest":!1,folders:!0},yateModule:"message",ctor:function(){this._update=this._update.bind(this)},methods:{onChangeMessage:function(e,t){if(t.direction){var s,n=this.getModel("message-nearest").getNearestMessages(),i=n[t.direction];i&&(s=i.mid),s&&ns.page.go(ns.router.generateUrl("message",{ids:s}))}},onShow:function(){var e=this;this.getModel("message-nearest").getNearestMids().forEach(function(t){return ns.Model.get("message",{ids:t}).on("ns-model-changed.new",e._update)})},onHide:function(){var e=this;this.getModel("message-nearest").getNearestMids().forEach(function(t){return ns.Model.get("message",{ids:t}).off("ns-model-changed.new",e._update)}),this.invalidate()},_update:function(){this.isVisible()&&this.forceUpdate()}}})},2143:function(e,t){yr.externals["event-pretty-date"]=function(e){var t=Jane.Common.n,s=[],n=new Date(e),i=new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),u=n.getHours(),d=n.getMinutes(),l=i.getFullYear(),c=i.getMonth(),h=i.getDate();return l===a&&c===o&&h===r?s.push(i18n("%Сегодня")):new Date(a,o,r)-new Date(l,c,h)==864e5&&s.push(i18n("%Завтра")),s.push(Jane.Date.format("%Date_dBY_year",n)),s.push(' <input class="b-calendar-event__time__input" type="text" value="'+t(u)+":"+t(d)+'" maxlength="5">'),s.join(", ")},yr.externals.lang2index=function(e){var t=Daria.Translate.langs.all.s.indexOf(e);return t>-1?t:0},yr.externals["remove-http-protocol"]=function(e){return e.replace(/^https?:\/\/(www\.)?/,"")}},273:function(e,t,s){e.exports=s.p+"_/325472601571f31e1bf00674c368d335-b-ico.gif"}});